!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var a=t();for(var n in a)("object"==typeof exports?exports:e)[n]=a[n]}}(window,(function(){return function(e){function t(t){for(var n,i,o=t[0],l=t[1],c=t[2],m=0,f=[];m<o.length;m++)i=o[m],Object.prototype.hasOwnProperty.call(s,i)&&s[i]&&f.push(s[i][0]),s[i]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);for(u&&u(t);f.length;)f.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],n=!0,o=1;o<a.length;o++){var l=a[o];0!==s[l]&&(n=!1)}n&&(r.splice(t--,1),e=i(i.s=a[0]))}return e}var n={},s={4:0},r=[];function i(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=n,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;return r.push([26,0,5]),a()}({12:function(e,t,a){"use strict";var n=a(0),s=a.n(n),r=a(1);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=u(e);if(t){var s=u(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?c(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={title:e.title,message:e.message,cb:e.callback},n.closeModal=n.closeModal.bind(c(n)),n}return function(e,t,a){t&&o(e.prototype,t)}(a,[{key:"componentWillReceiveProps",value:function(e){this.setState({title:e.title,message:e.message,cb:e.callback})}},{key:"closeModal",value:function(e,t){this.state.cb&&this.state.cb(t)}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"modal fade on-top",id:"confirmModal",tabIndex:"-1",role:"dialog","aria-labelledby":"confirmModalLabel","aria-hidden":"true"},s.a.createElement("div",{className:"modal-dialog",role:"document"},s.a.createElement("div",{className:"modal-content"},s.a.createElement("div",{className:"modal-header"},s.a.createElement("h5",{className:"modal-title",id:"confirmModalLabel"},this.state.title),s.a.createElement("button",{type:"button",className:"close","aria-label":r.a.t("modal.close"),onClick:function(t){return e.closeModal(t,!1)}},s.a.createElement("span",{"aria-hidden":"true"},"Ã—"))),s.a.createElement("div",{className:"modal-body"},this.state.message),s.a.createElement("div",{className:"modal-footer"},s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return e.closeModal(t,!1)}},r.a.t("modal.close")),s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(t){return e.closeModal(t,!0)}},r.a.t("modal.ok"))))))}}]),a}();t.a=m},2:function(e,t,a){"use strict";function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.subscriberList={}}return function(e,t,a){t&&n(e.prototype,t)}(e,[{key:"subscribe",value:function(e,t){this.subscriberList[e]=t}},{key:"sendMessage",value:function(e,t){if(Array.isArray(e)||(e=[e]),"broadcast"===e[0])this.subscriberList.forEach((function(e,a){e({type:"broadcast",message:t})}));else for(var a in this.subscriberList)e.indexOf(a)>=0&&this.subscriberList[a](t)}}]),e}());t.a=s},26:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(5),i=a.n(r),o=a(1),l=a(10),c=a(11),u=a(3),m=a(2),f=a(4);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function g(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=y(e);if(t){var s=y(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?b(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,curNav:"profile",loggedIn:e.loggedIn,schemeList:e.schemeList,profileList:e.profileList,dataHighlight:e.dataHighlight,schemeHighlight:e.schemeHighlight,registering:e.registering},n.navigate=n.navigate.bind(b(n)),n.toggleLogin=n.toggleLogin.bind(b(n)),n.changeLang=n.changeLang.bind(b(n)),n.changeProfile=n.changeProfile.bind(b(n)),n.gotoManageUsers=n.gotoManageUsers.bind(b(n)),m.a.subscribe("Nav",(function(e){"profile"===e.type?n.navigate(!1,"profile",null):n.navigate(!1,e.page,e.type)})),n}return function(e,t,a){t&&g(e.prototype,t)}(a,[{key:"componentWillReceiveProps",value:function(e){this.setState({loggedIn:e.loggedIn,schemeList:e.schemeList,profileList:e.profileList,dataHighlight:e.dataHighlight,schemeHighlight:e.schemeHighlight,registering:e.registering})}},{key:"navigate",value:function(e,t,a){e&&e.preventDefault(),m.a.sendMessage("App",{type:"nav",page:t,module:a}),this.setState({curNav:t})}},{key:"toggleLogin",value:function(){if(this.state.loggedIn)u.a.glewlwydRequest("/auth/?username="+encodeURIComponent(this.state.profileList[0].username),"DELETE").then((function(){m.a.sendMessage("Notification",{type:"info",message:o.a.t("login.success-delete-session")}),m.a.sendMessage("App",{type:"loggedIn",loggedIn:!1})})).fail((function(e){401!==e.status&&m.a.sendMessage("Notification",{type:"danger",message:o.a.t("login.error-delete-session")}),m.a.sendMessage("App",{type:"loggedIn",loggedIn:!1})}));else{var e=!1;this.state.config.sessionSchemes.forEach((function(t){t.scheme_default&&t.scheme_default.forEach((function(a){"profile"===a&&(e=t.scheme_name)}))})),document.location.href=this.state.config.LoginUrl+"?callback_url="+encodeURIComponent([location.protocol,"//",location.host,location.pathname].join(""))+"&scope="+encodeURIComponent(this.state.config.profile_scope)+(e?"&scheme="+encodeURIComponent(e):"")}}},{key:"changeLang",value:function(e,t){var a=this;o.a.changeLanguage(t).then((function(){a.setState({lang:t}),m.a.sendMessage("App",{type:"lang"})}))}},{key:"changeProfile",value:function(e,t){if(t)u.a.glewlwydRequest("/auth/","POST",{username:t.username}).then((function(){m.a.sendMessage("App",{type:"profile"})})).fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("login.error-login")})}));else{var a=!1;this.state.config.sessionSchemes.forEach((function(e){e.scheme_default&&e.scheme_default.forEach((function(t){"admin"===t&&(a=e.scheme_name)}))})),document.location.href=this.state.config.LoginUrl+"?callback_url="+encodeURIComponent([location.protocol,"//",location.host,location.pathname].join(""))+"&scope="+encodeURIComponent(this.state.config.profile_scope)+(a?"&scheme="+encodeURIComponent(a):"")+"&prompt=login"}}},{key:"gotoManageUsers",value:function(e){e.preventDefault(),document.location.href=this.state.config.LoginUrl+"?callback_url="+encodeURIComponent([location.protocol,"//",location.host,location.pathname].join(""))+"&scope="+encodeURIComponent(this.state.config.profile_scope)+"&prompt=select_account"}},{key:"userHasScope",value:function(e,t){var a=!1;return t&&e.scope&&e.scope.length&&t.split(" ").forEach((function(t){e.scope.indexOf(t)>-1&&(a=!0)})),a}},{key:"render",value:function(){var e,t,a,n,r,i,l,c=this,u=[],m=[],f=[],d="",g="",h=!0;if(this.state.config.lang.forEach((function(e,t){e===o.a.language?u.push(s.a.createElement("a",{className:"dropdown-item active",href:"#",key:t},e)):u.push(s.a.createElement("a",{className:"dropdown-item",href:"#",onClick:function(t){return c.changeLang(t,e)},key:t},e))})),this.state.schemeList.forEach((function(e,t){var a="";c.state.schemeHighlight[e.name]&&(h=!1,a=" required-field"),"retype-password"!==e.module&&"email"!==e.module&&m.push(s.a.createElement("li",{className:"nav-item"+(c.state.curNav===e.name?" active":""),key:t},s.a.createElement("a",{className:"nav-link"+a,href:"#","data-toggle":"collapse","data-target":".navbar-collapse.show",onClick:function(t){return c.navigate(t,e.name,e.module)}},e.display_name||e.name)))})),this.state.config.params.delegate||this.state.config.params.register||this.state.config.params.resetCredentials||!this.state.loggedIn||(n=s.a.createElement("li",{className:"nav-item"+("password"===this.state.curNav?" active":"")},s.a.createElement("a",{className:"nav-link",href:"#","data-toggle":"collapse","data-target":".navbar-collapse.show",onClick:function(e){return c.navigate(e,"password",null)}},o.a.t("profile.menu-password")))),!this.state.profileList||this.state.config.params.register||this.state.config.params.resetCredentials||(r=s.a.createElement("li",{className:"nav-item"+("session"===this.state.curNav?" active":"")},s.a.createElement("a",{className:"nav-link",href:"#","data-toggle":"collapse","data-target":".navbar-collapse.show",onClick:function(e){return c.navigate(e,"session",null)}},o.a.t("profile.menu-session")))),this.state.profileList&&this.state.profileList.forEach((function(e,t){c.userHasScope(e,c.state.config.profile_scope)?f.push(s.a.createElement("a",{className:"dropdown-item"+(t?"":" active"),href:"#","data-toggle":"collapse","data-target":".navbar-collapse.show",onClick:function(t){return c.changeProfile(t,e)},key:t},e.name||e.username)):f.push(s.a.createElement("a",{className:"dropdown-item glwd-nav-user-unavailable"+(t?"":" active"),key:t,href:"#",disabled:!0},e.name||e.username))})),(this.state.loggedIn||this.state.config.params.register&&this.state.registering)&&(i=s.a.createElement("li",{className:"nav-item"+("profile"===this.state.curNav?" active":"")},s.a.createElement("a",{className:"nav-link"+d,href:"#","data-toggle":"collapse","data-target":".navbar-collapse.show",onClick:function(e){return c.navigate(e,"profile",null)}},o.a.t("profile.menu-user")))),this.state.config.params.delegate||(f.push(s.a.createElement("div",{className:"dropdown-divider",key:f.length})),f.push(s.a.createElement("a",{className:"dropdown-item",href:"#",onClick:function(e){return c.changeProfile(e,null)},key:f.length},o.a.t("profile.menu-session-new"))),f.push(s.a.createElement("a",{className:"dropdown-item",href:"#",onClick:function(e){return c.gotoManageUsers(e)},key:f.length},o.a.t("login.manage-users")))),!this.state.config.params.register&&!this.state.config.params.resetCredentials&&this.state.profileList&&this.state.profileList[0]){if(this.state.config.profilePicture&&this.state.profileList[0][this.state.config.profilePicture.property]){var b=this.state.profileList[0][this.state.config.profilePicture.property];Array.isArray(b)&&(b=b[0]),l=s.a.createElement("div",{className:"glwd-nav-picture-div"},s.a.createElement("img",{className:"img-medium glwd-nav-picture-image",src:"data:image/*;base64,"+b}),this.state.profileList[0].username)}else l=s.a.createElement("div",{className:"glwd-nav-picture-div"},s.a.createElement("img",{className:"img-medium glwd-nav-picture-spacer",src:"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="})," ",s.a.createElement("i",{className:"fas fa-user"},"Â "),this.state.profileList[0].username);t=s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{className:"btn btn-secondary dropdown-toggle",type:"button",id:"dropdownProfile","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},s.a.createElement("div",{className:"glwd-nav-picture-container"},l)),s.a.createElement("div",{className:"dropdown-menu","aria-labelledby":"dropdownProfile"},f)),this.state.config.params.delegate||(a=s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:this.toggleLogin,title:o.a.t(this.state.loggedIn?"title-logout":"title-login")},this.state.loggedIn?s.a.createElement("i",{className:"fas fa-sign-out-alt btn-icon"}):s.a.createElement("i",{className:"fas fa-sign-in-alt btn-icon"})))}else this.state.config.params.register||this.state.config.params.delegate||this.state.config.params.resetCredentials?this.state.dataHighlight&&(h=!1,d=" required-field"):a=s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:this.toggleLogin,title:o.a.t(this.state.loggedIn?"title-logout":"title-login")},this.state.loggedIn?s.a.createElement("i",{className:"fas fa-sign-out-alt btn-icon"}):s.a.createElement("i",{className:"fas fa-sign-in-alt btn-icon"}));return this.state.registering&&(g=h?s.a.createElement("li",{className:"nav-item"},s.a.createElement("a",{className:"btn btn-success",href:"#","data-toggle":"collapse","data-target":".navbar-collapse.show",onClick:function(e){return c.navigate(e,"profile",null)}},o.a.t("profile.register-profile-nav-complete"))):s.a.createElement("li",{className:"nav-item"},s.a.createElement("a",{className:"btn btn-danger",href:"#","data-toggle":"collapse","data-target":".navbar-collapse.show",onClick:function(e){return c.navigate(e,"profile",null)}},o.a.t("profile.register-profile-nav-incomplete")))),s.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light"},s.a.createElement("a",{className:"navbar-brand",href:"#","data-toggle":"collapse"},s.a.createElement("img",{className:"mr-3",src:"img/logo-profile.png",alt:"logo"}),o.a.t("profile.menu-title")),s.a.createElement("button",(p(e={className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":".navbar-collapse.show"},"data-target","#navbarSupportedContent"),p(e,"aria-controls","navbarSupportedContent"),p(e,"aria-expanded","false"),p(e,"aria-label","Toggle navigation"),e),s.a.createElement("span",{className:"navbar-toggler-icon"})),s.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent"},s.a.createElement("ul",{className:"navbar-nav mr-auto"},i,r,n,m,g),s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{className:"btn btn-secondary dropdown-toggle",type:"button",id:"dropdownLang","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},s.a.createElement("i",{className:"fas fa-language"})),s.a.createElement("div",{className:"dropdown-menu","aria-labelledby":"dropdownLang"},u)),t,a)))}}]),a}();function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=k(e);if(t){var s=k(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?C(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,pattern:e.pattern,profile:e.profile,profileUpdate:e.profileUpdate,loggedIn:e.loggedIn,listAddValue:n.initListAdd(e.pattern),listEltConfirm:n.initListConfirm(e.pattern),updateEmail:e.updateEmail,listError:{}},n.editElt=n.editElt.bind(C(n)),n.createData=n.createData.bind(C(n)),n.initListAdd=n.initListAdd.bind(C(n)),n.initListConfirm=n.initListConfirm.bind(C(n)),n.deleteListElt=n.deleteListElt.bind(C(n)),n.changeElt=n.changeElt.bind(C(n)),n.toggleBooleanElt=n.toggleBooleanElt.bind(C(n)),n.changeListAddElt=n.changeListAddElt.bind(C(n)),n.AddListElt=n.AddListElt.bind(C(n)),n.changeEltConfirm=n.changeEltConfirm.bind(C(n)),n.changeTextArea=n.changeTextArea.bind(C(n)),n.uploadFile=n.uploadFile.bind(C(n)),n.uploadImage=n.uploadImage.bind(C(n)),n.removeImage=n.removeImage.bind(C(n)),n.editElt=n.editElt.bind(C(n)),n.saveProfile=n.saveProfile.bind(C(n)),n.confirmDeleteProfile=n.confirmDeleteProfile.bind(C(n)),n}return function(e,t,a){t&&w(e.prototype,t)}(a,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({config:e.config,pattern:e.pattern,profile:e.profile,profileUpdate:e.profileUpdate,loggedIn:e.loggedIn,listAddValue:this.initListAdd(e.pattern),listEltConfirm:this.initListConfirm(e.pattern),updateEmail:e.updateEmail,listError:{}},(function(){t.state.loggedIn||t.setState({pattern:[],profile:[]})}))}},{key:"createData",value:function(){var e={};this.state.pattern.forEach((function(t,a){t.list?e[t.name]=[]:t.defaultValue?e[t.name]=t.defaultValue:e[t.name]=""})),this.setState({data:e})}},{key:"initListAdd",value:function(e){var t={};return e&&e.forEach((function(e){e.list&&(t[e.name]="")})),t}},{key:"initListConfirm",value:function(e){var t={};return e&&e.forEach((function(e){e.confirm&&(t[e.name]="")})),t}},{key:"deleteListElt",value:function(e,t,a){var n=this.state.profile;n[t]&&(n[t].splice(a,1),this.setState({profile:n}))}},{key:"changeElt",value:function(e,t){var a=this.state.profile;a[t]=e.target.value,this.setState({profile:a})}},{key:"toggleBooleanElt",value:function(e,t){var a=this.state.profile;a[t]=!a[t],this.setState({profile:a})}},{key:"changeListAddElt",value:function(e,t){var a=this.state.listAddValue;a[t]=e.target.value,this.setState({listAddValue:a})}},{key:"AddListElt",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.preventDefault(),a)(n=this.state.profile)[t]||(n[t]=[]),n[t].push(a),this.setState({profile:n});else if(this.state.listAddValue[t]){var n=this.state.profile,s=this.state.listAddValue;n[t].push(this.state.listAddValue[t]),this.state.listAddValue[t]="",this.setState({profile:n,listAddValue:s})}}},{key:"changeEltConfirm",value:function(e,t){var a=this.state.listEltConfirm;a[t]=e.target.value,this.setState({listEltConfirm:a})}},{key:"changeTextArea",value:function(e,t,a){var n=this.state.profile;n[t]=a?e.target.value.split("\n"):e.target.value,this.setState({profile:n})}},{key:"uploadFile",value:function(e,t,a){var n=this,s=this.state.profile,r=e.target.files[0],i=new FileReader;i.onload=function(e){a?(s[t]||(s[t]=[]),s[t].push(r.name+"/"+btoa(e.target.result))):s[t]=r.name+"/"+btoa(e.target.result),n.setState({profile:s})},i.readAsText(r)}},{key:"uploadImage",value:function(e,t,a){var n=this,s=this.state.profile,r=e.target.files[0],i=new FileReader;i.onload=function(e){a?(s[t]||(s[t]=[]),s[t].push(btoa(e.target.result))):s[t]=btoa(e.target.result),n.setState({profile:s})},i.readAsBinaryString(r)}},{key:"removeImage",value:function(e,t,a){var n=this.state.profile;a>-1?n[t].splice(a,1):delete n[t],this.setState({profile:n})}},{key:"saveProfile",value:function(e){u.a.glewlwydRequest("/profile","PUT",this.state.profile).then((function(e){m.a.sendMessage("Notification",{type:"success",message:o.a.t("profile.save-profile-success")})})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.save-profile-error")})}))}},{key:"deleteProfile",value:function(e){m.a.sendMessage("App",{type:"confirm",title:o.a.t("profile.delete-profile-title"),message:o.a.t("profile.delete-profile-message"),callback:this.confirmDeleteProfile})}},{key:"confirmDeleteProfile",value:function(e){e&&u.a.glewlwydRequest("/profile","DELETE",this.state.profile).then((function(e){m.a.sendMessage("Notification",{type:"success",message:o.a.t("profile.delete-profile-success")}),m.a.sendMessage("App",{type:"profile"})})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.delete-profile-error")})})),m.a.sendMessage("App",{type:"closeConfirm"})}},{key:"updateEmailModal",value:function(e){m.a.sendMessage("App",{type:"updateEmail",module:e})}},{key:"editElt",value:function(e,t,a){var n,r,i=this,l=[],c=!1;if((void 0!==t||"password"===e.type||e.forceShow)&&e["profile-read"]){var u="",m="";if(this.state.listError[e.name]&&(u=" is-invalid",m=s.a.createElement("span",{className:"error-input"},o.a.t(this.state.listError[e.name]))),n=s.a.createElement("label",{htmlFor:"modal-edit-"+e.name},o.a.t(e.label)),e.list){if(t||(t=[]),e.listElements){var f=[];e.listElements.forEach((function(t,a){f.push(s.a.createElement("a",{className:"dropdown-item",key:a,href:"#",onClick:function(a){return i.AddListElt(a,e.name,t)}},t))})),r=s.a.createElement("div",{className:"dropdown"},s.a.createElement("button",{className:"btn btn-secondary btn-sm dropdown-toggle",type:"button",id:"modal-edit-"+e.name,"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},s.a.createElement("i",{className:"fas fa-plus"})),s.a.createElement("div",{className:"dropdown-menu","aria-labelledby":"modal-edit-"+e.name},f))}else if("textarea"===e.type)r=s.a.createElement("textarea",{className:"form-control"+u,onChange:function(t){return i.changeTextArea(t,e.name,!0)},value:t.join("\n"),placeholder:e.placeholder?o.a.t(e.placeholder):""});else if("file"===e.type)r=e["profile-write"]||this.state.add?s.a.createElement("input",{type:"file",className:"form-control"+u,onChange:function(t){return i.uploadFile(t,e.name,!0)}}):s.a.createElement("input",{type:"file",disabled:!0,className:"form-control"});else if(e.type&&e.type.startsWith("image")){var d=[];t.forEach((function(t,a){d.push(s.a.createElement("a",{href:"#",onClick:function(t){return i.removeImage(t,e.name,a)},title:o.a.t("remove")},s.a.createElement("img",{key:a,className:"btn-icon-right img-thumb",src:"data:"+e.type+";base64,"+t,alt:e.name+"-"+a}),s.a.createElement("span",{className:"badge badge-secondary align-top"},s.a.createElement("i",{className:"fas fa-trash"}))))})),e.edit||this.state.add?r=s.a.createElement("div",null,s.a.createElement("div",{className:"custom-file"},s.a.createElement("input",{type:"file",className:"custom-file-input"+u,accept:"image/*",onChange:function(t){return i.uploadImage(t,e.name,!0)},id:"modal-image-"+e.name}),s.a.createElement("label",{className:"custom-file-label",htmlFor:"modal-image-"+e.name},o.a.t("browse"))),d):(d=[],t.forEach((function(t,a){d.push(s.a.createElement("img",{key:a,className:"btn-icon-right img-thumb",src:"data:"+e.type+";base64,"+t,alt:e.name+"-"+a}))})),r=d)}else e["profile-write"]&&(r=s.a.createElement("div",{className:"input-group"},s.a.createElement("input",{type:"text",className:"form-control"+u,id:"modal-edit-"+e.name,placeholder:e.placeholder?o.a.t(e.placeholder):"",onChange:function(t){return i.changeListAddElt(t,e.name)},value:this.state.listAddValue[e.name]}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("button",{className:"btn btn-outline-secondary",type:"button",onClick:function(t){return i.AddListElt(t,e.name)},title:o.a.t("modal.list-add-title")},s.a.createElement("i",{className:"fas fa-plus"})))));t.forEach((function(t,a){var n=t;"file"===e.type&&(n=t.substring(0,t.indexOf("/"))),(e.type&&"textarea"!==e.type&&!e.type.startsWith("image")||!e.type)&&(!0===e["profile-write"]||i.state.add?l.push(s.a.createElement("a",{href:"#",onClick:function(t){return i.deleteListElt(t,e.name,a)},key:a},s.a.createElement("span",{className:"badge badge-primary btn-icon-right"},n,s.a.createElement("span",{className:"badge badge-light btn-icon-right"},s.a.createElement("i",{className:"fas fa-times"}))))):l.push(s.a.createElement("span",{className:"badge badge-primary btn-icon-right",key:a},n)))}))}else if("boolean"===e.type)c=!0===e["profile-write"]||this.state.add?s.a.createElement("div",{className:"form-group form-check"},s.a.createElement("input",{type:"checkbox",className:"form-check-input"+u,id:"modal-edit-"+e.name,onChange:function(t){return i.toggleBooleanElt(t,e.name)},checked:t}),s.a.createElement("label",{className:"form-check-label",htmlFor:"modal-edit-"+e.name},o.a.t(e.label))):s.a.createElement("div",{className:"form-group form-check"},s.a.createElement("input",{disabled:!0,type:"checkbox",className:"form-check-input",id:"modal-edit-"+e.name,checked:t}),s.a.createElement("label",{className:"form-check-label",htmlFor:"modal-edit-"+e.name},o.a.t(e.label)));else if("textarea"===e.type)r=!0===e["profile-write"]||this.state.add?s.a.createElement("textarea",{className:"form-control"+u,onChange:function(t){return i.changeTextArea(t,e.name,!1)},value:t||"",placeholder:e.placeholder?o.a.t(e.placeholder):""}):s.a.createElement("textarea",{className:"form-control",disabled:!0,value:t||""});else if("file"===e.type)t&&l.push(s.a.createElement("a",{href:"#",key:0,onClick:function(t){return i.deleteFile(t,e.name)}},s.a.createElement("span",{className:"badge badge-primary"},t.substring(0,t.indexOf("/")),s.a.createElement("span",{className:"badge badge-light btn-icon-right"},s.a.createElement("i",{className:"fas fa-times"}))))),r=e["profile-write"]||this.state.add?s.a.createElement("input",{type:"file",className:"form-control"+u,onChange:function(t){return i.uploadFile(t,e.name)}}):s.a.createElement("input",{type:"file",disabled:!0,className:"form-control"});else if(e.type&&e.type.startsWith("image"))t&&(d=s.a.createElement("a",{href:"#",onClick:function(t){return i.removeImage(t,e.name,-1)},title:o.a.t("remove")},s.a.createElement("img",{className:"btn-icon-right img-thumb",src:"data:"+e.type+";base64,"+t,alt:e.name}),s.a.createElement("span",{className:"badge badge-secondary align-top"},s.a.createElement("i",{className:"fas fa-trash"})))),r=e.edit||this.state.add?s.a.createElement("div",null,s.a.createElement("div",{className:"custom-file"},s.a.createElement("input",{type:"file",accept:"image/*",className:"custom-file-input"+u,onChange:function(t){return i.uploadImage(t,e.name)},id:"modal-image-"+e.name}),s.a.createElement("label",{className:"custom-file-label",htmlFor:"modal-image-"+e.name},o.a.t("browse"))),d):s.a.createElement("img",{className:"btn-icon-right img-thumb",src:"data:"+e.type+";base64,"+t,alt:e.name});else if(!0===e["profile-write"]||this.state.add)r="password"===e.type?s.a.createElement("div",null,s.a.createElement("input",{type:"password",className:"form-control"+u,id:"modal-edit-"+e.name,placeholder:e.placeholder?o.a.t(e.placeholder):"",onChange:function(t){return i.changeElt(t,e.name)},value:t||"",autoComplete:"new-password"}),s.a.createElement("input",{type:"password",className:"form-control"+u,id:"modal-edit-confirm"+e.name,placeholder:o.a.t(e.placeholderConfirm),value:this.state.listEltConfirm[e.name]||"",onChange:function(t){return i.changeEltConfirm(t,e.name)},autoComplete:"new-password"})):s.a.createElement("input",{type:e.type||"text",className:"form-control"+u,id:"modal-edit-"+e.name,placeholder:e.placeholder?o.a.t(e.placeholder):"",value:t,onChange:function(t){return i.changeElt(t,e.name)}});else if("email"===e.name){var p=[];this.state.updateEmail.forEach((function(e,t){p.push(s.a.createElement("button",{key:t,className:"btn btn-outline-secondary",type:"button",onClick:function(t){return i.updateEmailModal(e)},title:o.a.t("profile.update-email-modal-title")},s.a.createElement("i",{className:"fas fa-edit"})))})),r=s.a.createElement("div",{className:"input-group"},s.a.createElement("input",{disabled:!0,type:"text",className:"form-control"+u,id:"modal-edit-"+e.name,placeholder:e.placeholder?o.a.t(e.placeholder):"",value:t}),s.a.createElement("div",{className:"input-group-append"},p))}else r=s.a.createElement("input",{disabled:!0,type:e.type||"text",className:"form-control"+u,id:"modal-edit-"+e.name,placeholder:e.placeholder?o.a.t(e.placeholder):"",value:t})}return c||s.a.createElement("div",{className:"form-group",key:a},n,r,s.a.createElement("div",null,l),m)}},{key:"render",value:function(){var e,t=this,a=[];return this.state.pattern&&this.state.profile&&this.state.pattern.forEach((function(e,n){var s=t.editElt(e,t.state.profile[e.name],n);s&&a.push(s)})),"no"!==this.state.config.delete_profile&&(e=s.a.createElement("button",{type:"button",className:"btn btn-danger btn-icon",onClick:function(e){return t.deleteProfile(e)},disabled:!this.state.profile||!this.state.profileUpdate},o.a.t("profile.delete"))),this.state.loggedIn?s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.hello",{name:this.state.profile.name||this.state.profile.username})))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("form",{className:"needs-validation",noValidate:!0},a))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-6"},e),s.a.createElement("div",{className:"col-md-6 text-right"},s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.saveProfile(e)},disabled:!this.state.profile||!this.state.profileUpdate},o.a.t("profile.save"))))):s.a.createElement("div",null)}}]),a}();function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var M=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=R(e);if(t){var s=R(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={profile:e.profile},n}return function(e,t,a){t&&_(e.prototype,t)}(a,[{key:"componentWillReceiveProps",value:function(e){this.setState({profile:e.profile})}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.hello-delegate",{name:this.state.profile.name||this.state.profile.username})))))}}]),a}();function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=I(e);if(t){var s=I(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==x(t)&&"function"!=typeof t?T(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,profile:e.profile,status:e.status,password:"",passwordConfirm:"",invalidPassword:!1,password_set:!1,modifyPassword:!0},n.updatePassword=n.updatePassword.bind(T(n)),n}return function(e,t,a){t&&L(e.prototype,t)}(a,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,profile:e.profile,status:e.status})}},{key:"changePassword",value:function(e){var t=this;this.setState({password:e.target.value},(function(){t.checkPassword()}))}},{key:"changeConfirmPassword",value:function(e){var t=this;this.setState({passwordConfirm:e.target.value},(function(){t.checkPassword()}))}},{key:"checkPassword",value:function(){var e=!1;""===this.state.password&&""===this.state.passwordConfirm||(this.state.password!==this.state.passwordConfirm?e=o.a.t("profile.register-password-error-not-match"):this.state.password.length<(this.state.config.PasswordMinLength||8)&&(e=o.a.t("profile.register-password-ph",{car:this.state.config.PasswordMinLength||8}))),this.setState({invalidPassword:e})}},{key:"navigateProfile",value:function(e){var t=this;e.preventDefault(),u.a.glewlwydRequest("/"+this.state.config.params.resetCredentials+"/reset-credentials/profile/complete","POST").then((function(){var e=!1;t.state.config.sessionSchemes.forEach((function(t){t.scheme_default&&t.scheme_default.forEach((function(a){"admin"===a&&(e=t.scheme_name)}))})),document.location.href=t.state.config.LoginUrl+"?callback_url="+encodeURIComponent([location.protocol,"//",location.host,location.pathname].join(""))+"&scope="+encodeURIComponent(t.state.config.profile_scope)+(e?"&scheme="+encodeURIComponent(e):"")+"&prompt=login"})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"savePassword",value:function(e){var t=this;e.preventDefault(),!this.state.invalidPassword&&this.state.password.length>=(this.state.config.PasswordMinLength||8)&&u.a.glewlwydRequest("/"+this.state.config.params.resetCredentials+"/reset-credentials/profile/password","POST",{password:this.state.password}).then((function(){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.register-password-saved")})})).fail((function(e){400!==e.status&&m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){t.setState({password:"",passwordConfirm:"",modifyPassword:!1,password_set:!0})}))}},{key:"updatePassword",value:function(){this.setState({modifyPassword:!0,password_set:!1})}},{key:"render",value:function(){var e,t=this;return e=this.state.config.params.callback_url?s.a.createElement("a",{className:"btn btn-success",href:decodeURI(this.state.config.params.callback_url)},o.a.t("callback.button-login")):this.state.profile.callback_url?s.a.createElement("a",{className:"btn btn-success",href:decodeURI(this.state.profile.callback_url)},o.a.t("callback.button-login")):s.a.createElement("a",{className:"btn btn-success",href:"#",onClick:function(e){return t.navigateProfile(e)}},o.a.t("callback.button-profile")),1===this.state.status?s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.reset-credentials-hello",{name:this.state.profile.name||this.state.profile.username})))),s.a.createElement("hr",null),s.a.createElement("label",{htmlFor:"password-input"},o.a.t("profile.register-password-label"),s.a.createElement("button",{type:"button",disabled:!this.state.password_set,className:"btn btn-outline-secondary btn-sm btn-icon-right",onClick:this.updatePassword},s.a.createElement("i",{className:"fas fa-edit"}))),s.a.createElement("div",{className:"input-group"},s.a.createElement("input",{type:"password",className:"form-control",id:"password-input",disabled:this.state.password_set,placeholder:o.a.t("profile.register-password-ph",{car:this.state.config.PasswordMinLength||8}),onChange:function(e){return t.changePassword(e)},value:this.state.password})),s.a.createElement("label",{htmlFor:"confirm-password-input"},o.a.t("profile.register-confirm-password-label")),s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("input",{type:"password",className:"form-control",id:"confirm-password-input",disabled:this.state.password_set,placeholder:o.a.t("profile.register-confirm-password-ph"),onChange:function(e){return t.changeConfirmPassword(e)},value:this.state.passwordConfirm}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("button",{className:"btn btn-secondary btn-icon",type:"button",onClick:function(e){return t.savePassword(e)},disabled:this.state.invalidPassword||!this.state.modifyPassword&&this.state.password_set,title:o.a.t("save")},o.a.t("save")))),s.a.createElement("hr",null),s.a.createElement("h5",null,o.a.t("profile.reset-credentials-complete-message")),e):-1===this.state.status?s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.reset-credentials-error"))))):""}}]),a}();function D(e){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function U(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function V(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var H=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=F(e);if(t){var s=F(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==D(t)&&"function"!=typeof t?V(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,registerConfig:e.registerConfig,registerProfile:e.registerProfile,registerSchemes:e.registerSchemes,token:e.token,registerValid:e.registerValid,registerDefaultLang:e.registerDefaultLang,username:"",email:"",code:"",password:"",passwordConfirm:"",usernameValid:!1,usernameInvalid:!1,verificationSent:!1,invalidCode:!1,showCode:!1,timeout:!1,checkingUsername:!1,checkingEmail:!1,invalidMessage:!1,validMessage:!1,invalidEmailMessage:!0,invalidPassword:!1,registerComplete:!1,modifyPassword:!1},n.confirmCancelRegistration=n.confirmCancelRegistration.bind(V(n)),n.updatePassword=n.updatePassword.bind(V(n)),document.title=o.a.t("profile.register-title"),n}return function(e,t,a){t&&U(e.prototype,t)}(a,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,registerConfig:e.registerConfig,registerProfile:e.registerProfile,token:e.token,registerValid:e.registerValid,registerDefaultLang:e.registerDefaultLang})}},{key:"checkUsername",value:function(){var e=this;this.state.timeout&&clearTimeout(this.state.timeout),this.state.username?u.a.glewlwydRequest("/"+this.state.config.params.register+"/username","POST",{username:this.state.username}).then((function(){e.setState({timeout:!1,usernameValid:!0,usernameInvalid:!1,checkingUsername:!1,invalidMessage:!1,validMessage:!0})})).fail((function(t){400!==t.status?(m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")}),e.setState({timeout:!1,usernameValid:!1,usernameInvalid:!0,checkingUsername:!1,invalidMessage:!0,validMessage:!1})):e.setState({timeout:!1,usernameValid:!1,usernameInvalid:!0,checkingUsername:!1,invalidMessage:!0,validMessage:!1})})):this.setState({timeout:!1,usernameValid:!1,usernameInvalid:!1,checkingUsername:!1,invalidMessage:!1,validMessage:!1})}},{key:"checkEmailAsUsername",value:function(){var e=this;this.state.timeout&&clearTimeout(this.state.timeout),this.state.email?u.a.glewlwydRequest("/"+this.state.config.params.register+"/username","POST",{username:this.state.email}).then((function(){e.setState({timeout:!1,usernameValid:!0,usernameInvalid:!1,checkingEmail:!1,invalidMessage:!1,validMessage:!0})})).fail((function(t){400!==t.status?(m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")}),e.setState({timeout:!1,usernameValid:!1,usernameInvalid:!0,checkingEmail:!1,invalidMessage:!0,validMessage:!1})):e.setState({timeout:!1,usernameValid:!1,usernameInvalid:!0,checkingEmail:!1,invalidMessage:!1,validMessage:!1})})):this.setState({timeout:!1,usernameValid:!1,usernameInvalid:!1,checkingEmail:!1,invalidMessage:!1,validMessage:!1})}},{key:"changeUsername",value:function(e){var t=this;e.preventDefault(),this.setState({username:e.target.value,usernameValid:!1},(function(){t.state.timeout&&clearTimeout(t.state.timeout),t.setState({checkingUsername:!0,timeout:setTimeout((function(){t.checkUsername()}),1e3)})}))}},{key:"changeEmailVerification",value:function(e){var t=this.state.usernameValid;this.state.registerConfig["email-is-username"]&&(t=!0),this.setState({email:e.target.value,invalidEmailMessage:!e.target.value,usernameValid:t})}},{key:"changeEmailAsUsername",value:function(e){var t=this;this.setState({email:e.target.value,invalidEmailMessage:!e.target.value,usernameValid:!0},(function(){t.state.timeout&&clearTimeout(t.state.timeout),t.setState({checkingEmail:!0,timeout:setTimeout((function(){t.checkEmailAsUsername()}),1e3)})}))}},{key:"changeCode",value:function(e){this.setState({code:e.target.value,invalidCode:!e.target.value})}},{key:"changeName",value:function(e){e.preventDefault();var t=this.state.registerProfile;t.name=e.target.value,this.setState({registerProfile:t})}},{key:"changePassword",value:function(e){var t=this;this.setState({password:e.target.value},(function(){t.checkPassword()}))}},{key:"changeConfirmPassword",value:function(e){var t=this;this.setState({passwordConfirm:e.target.value},(function(){t.checkPassword()}))}},{key:"checkPassword",value:function(){var e=!1;""===this.state.password&&""===this.state.passwordConfirm||(this.state.password!==this.state.passwordConfirm?e=o.a.t("profile.register-password-error-not-match"):this.state.password.length<(this.state.config.PasswordMinLength||8)&&(e=o.a.t("profile.register-password-ph",{car:this.state.config.PasswordMinLength||8}))),this.setState({invalidPassword:e})}},{key:"registerUsername",value:function(){u.a.glewlwydRequest("/"+this.state.config.params.register+"/register","POST",{username:this.state.username}).then((function(){m.a.sendMessage("App",{type:"registration"})})).fail((function(e){400!==e.status&&m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"noSubmit",value:function(e){return e.preventDefault(),!1}},{key:"saveName",value:function(e){e.preventDefault(),u.a.glewlwydRequest("/"+this.state.config.params.register+"/profile","PUT",this.state.registerProfile).then((function(){m.a.sendMessage("App",{type:"registration"}),m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.register-profile-saved")})})).fail((function(e){400!==e.status&&m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"savePassword",value:function(e){var t=this;e.preventDefault(),!this.state.invalidPassword&&this.state.password.length>=(this.state.config.PasswordMinLength||8)?u.a.glewlwydRequest("/"+this.state.config.params.register+"/profile/password","POST",{password:this.state.password}).then((function(){m.a.sendMessage("App",{type:"registration"}),m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.register-password-saved")})})).fail((function(e){400!==e.status&&m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){t.setState({password:"",passwordConfirm:"",modifyPassword:!1})})):m.a.sendMessage("App",{type:"registration"})}},{key:"sendVerificationEmail",value:function(){var e,t=this;e=!!this.state.config.params.callback_url&&encodeURIComponent(this.state.config.params.callback_url),u.a.glewlwydRequest("/"+this.state.config.params.register+"/verify","PUT",{username:this.state.username,email:this.state.email,lang:this.state.registerDefaultLang,callback_url:e}).then((function(){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.register-profile-email-sent",{email:t.state.email})}),t.setState({verificationSent:!0})})).fail((function(e){400!==e.status&&m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"verifyCode",value:function(){var e=this;u.a.glewlwydRequest("/"+this.state.config.params.register+"/verify","POST",{username:this.state.username,email:this.state.email,code:this.state.code}).then((function(){m.a.sendMessage("App",{type:"registration"}),m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.register-profile-created")})})).fail((function(t){e.setState({invalidCode:!0},(function(){400!==t.status&&m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}))}},{key:"completeRegistration",value:function(){var e=this;u.a.glewlwydRequest("/"+this.state.config.params.register+"/profile/complete","POST").then((function(){e.setState({registerComplete:!0,username:""},(function(){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.register-profile-completed")}),m.a.sendMessage("App",{type:"registrationComplete"})}))})).fail((function(e){400!==e.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")}):m.a.sendMessage("Notification",{type:"warning",message:o.a.t("profile.register-profile-incomplete")})}))}},{key:"cancelRegistration",value:function(){m.a.sendMessage("App",{type:"confirm",title:o.a.t("profile.register-profile-cancel-title"),message:o.a.t("profile.register-profile-cancel-message"),callback:this.confirmCancelRegistration})}},{key:"confirmCancelRegistration",value:function(e){var t=this;e&&u.a.glewlwydRequest("/"+this.state.config.params.register+"/profile","DELETE").then((function(){t.setState({username:"",usernameValid:!1,email:"",verificationSent:!1,code:"",validMessage:!1,invalidMessage:!1},(function(){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.register-profile-cancelled")}),m.a.sendMessage("App",{type:"registration"})}))})).fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})),m.a.sendMessage("App",{type:"closeConfirm"})}},{key:"updatePassword",value:function(){this.setState({modifyPassword:!0})}},{key:"changeLang",value:function(e,t){this.setState({registerDefaultLang:t})}},{key:"render",value:function(){var e,t,a,n,r=this;if(this.state.registerComplete){var i=[];this.state.config["register-complete"]&&this.state.config["register-complete"].length&&this.state.config["register-complete"].forEach((function(e,t){i.push(s.a.createElement("a",{key:t,className:"btn btn-primary btn-icon-right",href:e["complete-link"]},o.a.t(e["complete-link-label"])))})),this.state.config.params.callback_url?i.push(s.a.createElement("a",{key:i.length,className:"btn btn-primary btn-icon-right",href:decodeURI(this.state.config.params.callback_url)},o.a.t("callback.button-login"))):this.state.registerProfile.callback_url&&i.push(s.a.createElement("a",{key:i.length,className:"btn btn-primary btn-icon-right",href:decodeURI(this.state.registerProfile.callback_url)},o.a.t("callback.button-login"))),i.length||i.push(s.a.createElement("a",{key:i.length,className:"btn btn-primary",href:this.state.config.ProfileUrl},o.a.t("profile.register-profile-complete-link"))),t=s.a.createElement("div",null,s.a.createElement("div",{className:"alert alert-info",role:"alert"},o.a.t("profile.register-profile-complete-message")),s.a.createElement("div",null,i))}else if(this.state.registerProfile){var l,c=[];if("always"!==this.state.registerConfig["set-password"]||this.state.registerProfile.password_set||c.push(s.a.createElement("li",{key:0},o.a.t("profile.register-profile-complete-step-password"))),this.state.registerConfig.schemes&&this.state.registerConfig.schemes.forEach((function(e,t){"always"!=e.register||r.state.registerSchemes[e.name]||c.push(s.a.createElement("li",{key:t+1},o.a.t("profile.register-profile-complete-step-scheme",{scheme:e.display_name||e.name})))})),l=c.length?s.a.createElement("div",{className:"alert alert-danger",role:"alert"},o.a.t("profile.register-profile-complete-steps"),s.a.createElement("ul",null,c),s.a.createElement("button",{className:"btn btn-primary btn-icon",type:"button",disabled:!0,title:o.a.t("profile.register-profile-complete")},o.a.t("profile.register-profile-complete")),s.a.createElement("button",{className:"btn btn-primary",type:"button",onClick:function(){return r.cancelRegistration()},title:o.a.t("profile.register-profile-cancel")},o.a.t("profile.register-profile-cancel"))):s.a.createElement("div",{className:"alert alert-info",role:"alert"},o.a.t("profile.register-profile-complete-possible"),s.a.createElement("div",null,s.a.createElement("button",{className:"btn btn-primary btn-icon",type:"button",onClick:function(){return r.completeRegistration()},title:o.a.t("profile.register-profile-complete")},o.a.t("profile.register-profile-complete")),s.a.createElement("button",{className:"btn btn-primary",type:"button",onClick:function(){return r.cancelRegistration()},title:o.a.t("profile.register-profile-cancel")},o.a.t("profile.register-profile-cancel")))),"no"!==this.state.registerConfig["set-password"]){var u="";!this.state.modifyPassword&&this.state.registerProfile.password_set&&(u=s.a.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm btn-icon-right",onClick:this.updatePassword},s.a.createElement("i",{className:"fas fa-edit"}))),a=s.a.createElement("div",null,s.a.createElement("hr",null),s.a.createElement("label",{htmlFor:"password-input"},o.a.t("profile.register-password-label"),u),s.a.createElement("div",{className:"input-group"},s.a.createElement("input",{type:"password",className:"form-control",id:"password-input",placeholder:!this.state.modifyPassword&&this.state.registerProfile.password_set?o.a.t("profile.register-password-set-ph"):o.a.t("profile.register-password-ph",{car:this.state.config.PasswordMinLength||8}),disabled:!this.state.modifyPassword&&this.state.registerProfile.password_set,onChange:function(e){return r.changePassword(e)},value:this.state.password})),s.a.createElement("label",{htmlFor:"confirm-password-input"},o.a.t("profile.register-confirm-password-label")),s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("input",{type:"password",className:"form-control",id:"confirm-password-input",disabled:!this.state.modifyPassword&&this.state.registerProfile.password_set,placeholder:o.a.t(!this.state.modifyPassword&&this.state.registerProfile.password_set?"profile.register-password-set-ph":"profile.register-confirm-password-ph"),onChange:function(e){return r.changeConfirmPassword(e)},value:this.state.passwordConfirm}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("button",{className:"btn btn-secondary btn-icon",type:"button",onClick:function(e){return r.savePassword(e)},disabled:this.state.invalidPassword||!this.state.modifyPassword&&this.state.registerProfile.password_set,title:o.a.t("save")},o.a.t("save")))),this.state.invalidPassword?s.a.createElement("span",{className:"badge badge-danger"},this.state.invalidPassword):"")}this.state.registerConfig["verify-email"]&&(n=s.a.createElement("div",null,s.a.createElement("hr",null),s.a.createElement("label",{htmlFor:"email-input"},o.a.t("profile.register-email-label")),s.a.createElement("div",{className:"input-group"},s.a.createElement("input",{type:"text",className:"form-control",id:"email-input",disabled:!0,value:this.state.registerProfile.email||""})))),e=s.a.createElement("form",{className:"needs-validation",noValidate:!0,onSubmit:function(e){return r.noSubmit(e)}},s.a.createElement("label",{htmlFor:"username-input"},o.a.t("profile.register-profile-username-label")),s.a.createElement("div",{className:"input-group"},s.a.createElement("input",{type:"text",className:"form-control",value:this.state.registerProfile.username,disabled:!0})),n,s.a.createElement("hr",null),s.a.createElement("label",{htmlFor:"name-input"},o.a.t("profile.register-name-label")),s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("input",{type:"text",className:"form-control",id:"name-input",placeholder:o.a.t("profile.register-name-ph"),onChange:function(e){return r.changeName(e)},value:this.state.registerProfile.name||""}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("button",{className:"btn btn-secondary btn-icon",type:"button",onClick:function(e){return r.saveName(e)},title:o.a.t("save")},o.a.t("save")))),a)}else if(!this.state.registerProfile)if(this.state.registerConfig["verify-email"]){var m,f,d;if(this.state.registerDefaultLang&&this.state.registerConfig.languages.length>1){var p=[];this.state.registerConfig.languages.forEach((function(e,t){p.push(s.a.createElement("a",{key:t,className:"dropdown-item"+(r.state.registerDefaultLang===e?" active":""),href:"#",onClick:function(t){return r.changeLang(t,e)}},e))})),d=s.a.createElement("div",{className:"btn-group dropup",role:"group"},s.a.createElement("button",{className:"btn btn-success dropdown-toggle",type:"button",id:"register-profile-lang","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",disabled:!this.state.usernameValid||!this.state.email||!this.state.registerValid},this.state.registerDefaultLang),s.a.createElement("div",{className:"dropdown-menu","aria-labelledby":"register-profile-lang"},p))}this.state.verificationSent?(f=s.a.createElement("div",null,s.a.createElement("hr",null),s.a.createElement("label",{htmlFor:"code-input"},o.a.t("profile.register-code-label")),s.a.createElement("div",{className:"input-group"},s.a.createElement("input",{type:"text",className:"form-control",id:"code-input",placeholder:o.a.t("profile.register-code-ph"),onChange:function(e){return r.changeCode(e)},value:this.state.code})),this.state.invalidCode?s.a.createElement("span",{className:"badge badge-danger"},o.a.t("profile.register-code-error")):""),m=s.a.createElement("div",null,s.a.createElement("button",{className:"btn btn-success btn-icon",type:"button",onClick:function(){return r.verifyCode()},title:o.a.t("profile.register-profile-verify-code")},o.a.t("profile.register-profile-verify-code")),s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{className:"btn btn-success",type:"button",onClick:function(){return r.sendVerificationEmail()},title:o.a.t("profile.register-profile-reverify-email")},o.a.t("profile.register-profile-reverify-email")),d))):m=s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{className:"btn btn-success",type:"button",onClick:function(){return r.sendVerificationEmail()},disabled:!this.state.usernameValid||!this.state.email||!this.state.registerValid,title:o.a.t("profile.register-profile-verify-email")},o.a.t("profile.register-profile-verify-email")),d),e=this.state.registerConfig["email-is-username"]?s.a.createElement("form",{className:"needs-validation",noValidate:!0},s.a.createElement("label",{htmlFor:"email-input"},o.a.t("profile.register-email-label")),s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("input",{type:"text",className:"form-control",id:"email-input",placeholder:o.a.t("profile.register-email-ph"),onChange:function(e){return r.changeEmailAsUsername(e)},disabled:this.state.verificationSent||!this.state.registerValid,value:this.state.email}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("span",{className:"input-group-text"},s.a.createElement("i",{className:this.state.checkingEmail?"fas fa-compass fa-spin":this.state.usernameValid?"fas fa-check":"fas fa-exclamation"})))),this.state.email?"":s.a.createElement("span",{className:"badge badge-danger"},o.a.t("profile.register-email-error")),!this.state.usernameValid&&this.state.email?s.a.createElement("span",{className:"badge badge-danger"},o.a.t("profile.register-username-error")):"",this.state.validMessage?s.a.createElement("span",{className:"badge badge-success"},o.a.t("profile.register-username-valid")):"",this.state.checkingEmail?s.a.createElement("span",{className:"badge badge-info"},o.a.t("profile.register-username-checking")):"",f,s.a.createElement("hr",null),s.a.createElement("div",{className:"input-group-append"},m)):s.a.createElement("form",{className:"needs-validation",noValidate:!0},s.a.createElement("label",{htmlFor:"username-input"},o.a.t("profile.register-username-label")),s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("input",{type:"text",className:"form-control",id:"username-input",placeholder:o.a.t("profile.register-username-ph"),onChange:function(e){return r.changeUsername(e)},disabled:!this.state.registerValid,value:this.state.username}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("span",{className:"input-group-text"},s.a.createElement("i",{className:this.state.checkingUsername?"fas fa-compass fa-spin":this.state.invalidMessage?"fas fa-exclamation":"fas fa-check"})))),this.state.invalidMessage?s.a.createElement("span",{className:"badge badge-danger"},o.a.t("profile.register-username-error")):"",this.state.validMessage?s.a.createElement("span",{className:"badge badge-success"},o.a.t("profile.register-username-valid")):"",this.state.validMessage||this.state.invalidMessage?"":s.a.createElement("span",{className:"badge badge-info"},o.a.t("profile.register-username-empty")),s.a.createElement("hr",null),s.a.createElement("label",{htmlFor:"email-input"},o.a.t("profile.register-email-label")),s.a.createElement("div",{className:"input-group"},s.a.createElement("input",{type:"text",className:"form-control",id:"email-input",placeholder:o.a.t("profile.register-email-ph"),onChange:function(e){return r.changeEmailVerification(e)},disabled:this.state.verificationSent||!this.state.registerValid,value:this.state.email})),this.state.invalidEmailMessage?s.a.createElement("span",{className:"badge badge-danger"},o.a.t("profile.register-email-error")):"",f,s.a.createElement("hr",null),s.a.createElement("div",{className:"input-group-append"},m))}else e=s.a.createElement("form",{className:"needs-validation",noValidate:!0},s.a.createElement("label",{htmlFor:"username-input"},o.a.t("profile.register-username-label")),s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("input",{type:"text",className:"form-control",id:"username-input",placeholder:o.a.t("profile.register-username-ph"),onChange:function(e){return r.changeUsername(e)},disabled:!this.state.registerValid,value:this.state.username}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("span",{className:"input-group-text"},s.a.createElement("i",{className:this.state.checkingUsername?"fas fa-compass fa-spin":this.state.invalidMessage?"fas fa-exclamation":"fas fa-check"})))),this.state.invalidMessage?s.a.createElement("span",{className:"badge badge-danger"},o.a.t("profile.register-username-error")):"",this.state.validMessage?s.a.createElement("span",{className:"badge badge-success"},o.a.t("profile.register-username-valid")):"",this.state.validMessage||this.state.invalidMessage?"":s.a.createElement("span",{className:"badge badge-info"},o.a.t("profile.register-username-empty")),s.a.createElement("hr",null),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("button",{className:"btn btn-success",type:"button",onClick:function(){return r.registerUsername()},disabled:!this.state.usernameValid||!this.state.registerValid,title:o.a.t("profile.register-username-create")},o.a.t("profile.register-profile-create"))));return s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.register-title")))),t,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-6"},e)),s.a.createElement("hr",null),l)}}]),a}();function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function W(e,t){return(W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=J(e);if(t){var s=J(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==G(t)&&"function"!=typeof t?z(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,sessionList:e.sessionList,plugins:e.plugins,disableObject:!1},n.getTable=n.getTable.bind(z(n)),n.disableSession=n.disableSession.bind(z(n)),n.disableSessionConfirm=n.disableSessionConfirm.bind(z(n)),n.disableToken=n.disableToken.bind(z(n)),n.disableTokenConfirm=n.disableTokenConfirm.bind(z(n)),n}return function(e,t,a){t&&B(e.prototype,t)}(a,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,plugins:e.plugins,sessionList:e.sessionList})}},{key:"getTable",value:function(e,t){return s.a.createElement("table",{className:"table table-responsive table-striped"},s.a.createElement("thead",null,e),s.a.createElement("tbody",null,t))}},{key:"disableSession",value:function(e){var t=this;this.setState({disableObject:e},(function(){m.a.sendMessage("App",{type:"confirm",title:o.a.t("profile.session-disable-title"),message:o.a.t("profile.session-disable-message"),callback:t.disableSessionConfirm})}))}},{key:"disableSessionConfirm",value:function(e){var t=this;e&&this.state.disableObject&&u.a.glewlwydRequest("/profile/session/"+this.state.disableObject.session_hash,"DELETE").then((function(e){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.session-disabled")})})).fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){m.a.sendMessage("App",{type:"refreshSession"}),t.setState({disableObject:!1})})),m.a.sendMessage("App",{type:"closeConfirm"})}},{key:"disableToken",value:function(e,t,a){var n=this;this.setState({disableObject:{type:e,key:t,token:a}},(function(){m.a.sendMessage("App",{type:"confirm",title:o.a.t("profile.session-disable-token-title"),message:o.a.t("profile.session-disable-token-message"),callback:n.disableTokenConfirm})}))}},{key:"disableTokenConfirm",value:function(e){var t=this;e&&this.state.disableObject&&("oauth2"===this.state.disableObject.type?u.a.glewlwydRequestSub("/"+this.state.disableObject.key+"/profile/token/"+this.state.disableObject.token.token_hash+(this.state.config.params.delegate?"?impersonate="+this.state.config.params.delegate:""),"DELETE").then((function(e){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.token-disabled")})})).fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){m.a.sendMessage("App",{type:"refreshSession"}),t.setState({disableObject:!1}),m.a.sendMessage("App",{type:"closeConfirm"})})):"oidc"===this.state.disableObject.type&&u.a.glewlwydRequestSub("/"+this.state.disableObject.key+"/token/"+this.state.disableObject.token.token_hash+(this.state.config.params.delegate?"?impersonate="+this.state.config.params.delegate:""),"DELETE").then((function(e){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.token-disabled")})})).fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){m.a.sendMessage("App",{type:"refreshSession"}),t.setState({disableObject:!1})}))),m.a.sendMessage("App",{type:"closeConfirm"})}},{key:"render",value:function(){var e=this,t=s.a.createElement("tr",null,s.a.createElement("th",null,o.a.t("profile.session-table-last-login")),s.a.createElement("th",null,o.a.t("profile.session-table-expiration")),s.a.createElement("th",null,o.a.t("profile.session-table-issued-for")),s.a.createElement("th",null,o.a.t("profile.session-table-user-agent")),s.a.createElement("th",null,o.a.t("admin.enabled")),s.a.createElement("th",null)),a=[],n=[];this.state.sessionList.forEach((function(t,n){var r=new Date(1e3*t.last_login),i=new Date(1e3*t.expiration);a.push(s.a.createElement("tr",{key:n},s.a.createElement("td",null,r.toLocaleString()),s.a.createElement("td",null,i.toLocaleString()),s.a.createElement("td",null,t.issued_for),s.a.createElement("td",null,t.user_agent),s.a.createElement("td",null,t.enabled?o.a.t("profile.session-enabled-true"):o.a.t("profile.session-enabled-false")),s.a.createElement("td",null,s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(a){return e.disableSession(t)},title:o.a.t("admin.delete"),disabled:!t.enabled},s.a.createElement("i",{className:"fas fa-trash"})))))}));var r=0;for(var i in n=[],this.state.plugins.oauth2){var l=this.state.plugins.oauth2[i],c=s.a.createElement("tr",null,s.a.createElement("th",null,o.a.t("profile.session-table-last-login")),s.a.createElement("th",null,o.a.t("profile.session-table-expiration")),s.a.createElement("th",null,o.a.t("profile.session-table-client")),s.a.createElement("th",null,o.a.t("profile.session-table-issued-for")),s.a.createElement("th",null,o.a.t("profile.session-table-user-agent")),s.a.createElement("th",null,o.a.t("admin.enabled")),s.a.createElement("th",null)),u=[];l.forEach((function(t,a){var n=new Date(1e3*t.last_seen),r=new Date(1e3*t.expires_at);u.push(s.a.createElement("tr",{key:a},s.a.createElement("td",null,n.toLocaleString()),s.a.createElement("td",null,r.toLocaleString()),s.a.createElement("td",null,t.client_id),s.a.createElement("td",null,t.issued_for),s.a.createElement("td",null,t.user_agent),s.a.createElement("td",null,t.enabled?o.a.t("profile.session-enabled-true"):o.a.t("profile.session-enabled-false")),s.a.createElement("td",null,s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(a){return e.disableToken("oauth2",i,t)},title:o.a.t("admin.delete"),disabled:!t.enabled},s.a.createElement("i",{className:"fas fa-trash"})))))})),n.push(s.a.createElement("div",{className:"card",key:++r},s.a.createElement("div",{className:"card-header",id:"dataFormatCard"},s.a.createElement("h2",{className:"mb-0"},s.a.createElement("button",{className:"btn btn-link",type:"button","data-toggle":"collapse","data-target":"#collapseOauth2-"+i,"aria-expanded":"true","aria-controls":"collapseOauth2-"+i},o.a.t("profile.session-token-oauth2-table",{name:i})))),s.a.createElement("div",{id:"collapseOauth2-"+i,className:"collapse","aria-labelledby":"dataFormatCard","data-parent":"#accordionParams"},s.a.createElement("div",{className:"card-body"},this.getTable(c,u)))))}for(var i in r=n.length,this.state.plugins.oidc){var m=this.state.plugins.oidc[i],f=s.a.createElement("tr",null,s.a.createElement("th",null,o.a.t("profile.session-table-last-login")),s.a.createElement("th",null,o.a.t("profile.session-table-expiration")),s.a.createElement("th",null,o.a.t("profile.session-table-client")),s.a.createElement("th",null,o.a.t("profile.session-table-issued-for")),s.a.createElement("th",null,o.a.t("profile.session-table-user-agent")),s.a.createElement("th",null,o.a.t("admin.enabled")),s.a.createElement("th",null));u=[],m.forEach((function(t,a){var n=new Date(1e3*t.last_seen),r=new Date(1e3*t.expires_at);u.push(s.a.createElement("tr",{key:a},s.a.createElement("td",null,n.toLocaleString()),s.a.createElement("td",null,r.toLocaleString()),s.a.createElement("td",null,t.client_id),s.a.createElement("td",null,t.issued_for),s.a.createElement("td",null,t.user_agent),s.a.createElement("td",null,t.enabled?o.a.t("profile.session-enabled-true"):o.a.t("profile.session-enabled-false")),s.a.createElement("td",null,s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(a){return e.disableToken("oidc",i,t)},title:o.a.t("admin.delete"),disabled:!t.enabled},s.a.createElement("i",{className:"fas fa-trash"})))))})),n.push(s.a.createElement("div",{className:"card",key:++r},s.a.createElement("div",{className:"card-header",id:"dataFormatCard"},s.a.createElement("h2",{className:"mb-0"},s.a.createElement("button",{className:"btn btn-link",type:"button","data-toggle":"collapse","data-target":"#collapseOauth2-"+i,"aria-expanded":"true","aria-controls":"collapseOauth2-"+i},o.a.t("profile.session-token-oidc-table",{name:i})))),s.a.createElement("div",{id:"collapseOauth2-"+i,className:"collapse","aria-labelledby":"dataFormatCard","data-parent":"#accordionParams"},s.a.createElement("div",{className:"card-body"},this.getTable(f,u)))))}return s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.session-title")))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"accordion",id:"accordionParams"},s.a.createElement("div",{className:"card"},s.a.createElement("div",{className:"card-header",id:"dataFormatCard"},s.a.createElement("h2",{className:"mb-0"},s.a.createElement("button",{className:"btn btn-link",type:"button","data-toggle":"collapse","data-target":"#collapseSession","aria-expanded":"true","aria-controls":"collapseSession"},o.a.t("profile.session-table")))),s.a.createElement("div",{id:"collapseSession",className:"collapse","aria-labelledby":"dataFormatCard","data-parent":"#accordionParams"},s.a.createElement("div",{className:"card-body"},this.getTable(t,a)))),n))))}}]),a}();function K(e){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Y(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function X(e,t){return(X=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ee(e){return(ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var te=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&X(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=ee(e);if(t){var s=ee(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==K(t)&&"function"!=typeof t?Z(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,profile:e.profile,passwordMinLength:e.config.PasswordMinLength||8,callback:e.callback,loggedIn:e.loggedIn,registerPlugin:e.registerPlugin,old_password:"",password:n.initPassword(e.profile),password_confirm:n.initPassword(e.profile),oldPasswordInvalid:!1,passwordInvalid:!1,passwordInvalidMessage:!1,passwordConfirmInvalid:!1,passwordConfirmInvalidMessage:!1},n.initPassword=n.initPassword.bind(Z(n)),n.passwordButtonHandler=n.passwordButtonHandler.bind(Z(n)),n.changeOldPassword=n.changeOldPassword.bind(Z(n)),n.changeNewPassword=n.changeNewPassword.bind(Z(n)),n.changeNewPasswordConfirm=n.changeNewPasswordConfirm.bind(Z(n)),n.checkPassword=n.checkPassword.bind(Z(n)),n.resetCredentialsCodeReset=n.resetCredentialsCodeReset.bind(Z(n)),n.deletePasswordAt=n.deletePasswordAt.bind(Z(n)),n.addPassword=n.addPassword.bind(Z(n)),n}return function(e,t,a){t&&Y(e.prototype,t)}(a,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({config:e.config,profile:e.profile,passwordMinLength:e.config.PasswordMinLength||8,password:this.initPassword(e.profile),password_confirm:this.initPassword(e.profile),callback:e.callback,loggedIn:e.loggedIn,registerPlugin:e.registerPlugin},(function(){t.state.loggedIn||t.setState({password:"",old_password:"",password_confirm:"",passwordMinLength:0})}))}},{key:"passwordButtonHandler",value:function(e,t){var a=this;t?this.checkPassword()&&u.a.glewlwydRequest("/profile/password","PUT",{old_password:this.state.old_password,password:this.state.password}).then((function(){a.setState({old_password:"",password:a.initPassword(a.state.profile),password_confirm:a.initPassword(a.state.profile),oldPasswordInvalid:!1,oldPasswordInvalidMessage:"",passwordInvalid:!1,passwordInvalidMessage:"",passwordConfirmInvalid:!1,passwordConfirmInvalidMessage:""},(function(){a.state.callback(t)}))})).fail((function(e){400==e.status?a.setState({oldPasswordInvalid:!0,oldPasswordInvalidMessage:o.a.t("profile.password-invalid")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})):this.state.callback(t)}},{key:"changeOldPassword",value:function(e){this.setState({old_password:e.target.value})}},{key:"changeNewPassword",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if(t>-1){var a=this.state.password;a[t]=e.target.value,this.setState({password:a})}else this.setState({password:e.target.value})}},{key:"changeNewPasswordConfirm",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if(t>-1){var a=this.state.password_confirm;a[t]=e.target.value,this.setState({password_confirm:a})}else this.setState({password_confirm:e.target.value})}},{key:"checkPassword",value:function(){if(Array.isArray(this.state.password)){for(var e=[],t=[],a=[],n=[],s=!1,r=0;r<this.state.password.length;r++){e.push(!1),t.push(!1),a.push(""),n.push("");var i=this.state.password[r],l=this.state.password_confirm[r];null!==i&&(i.length<this.state.passwordMinLength&&(e[r]=!0,a[r]=o.a.t("profile.password-min-characters",{minLength:this.state.passwordMinLength}),s=!0),i!==l&&(t[r]=!0,n[r]=o.a.t("profile.password-not-match"),s=!0))}return this.setState({passwordInvalid:e,passwordConfirmInvalid:t,passwordInvalidMessage:a,passwordConfirmInvalidMessage:n}),!s}return e=!1,t=!1,a="",n="",this.state.password.length<this.state.passwordMinLength&&(e=!0,a=o.a.t("profile.password-min-characters",{minLength:this.state.passwordMinLength})),this.state.password!==this.state.password_confirm&&(t=!0,n=o.a.t("profile.password-not-match")),this.setState({passwordInvalid:e,passwordConfirmInvalid:t,passwordInvalidMessage:a,passwordConfirmInvalidMessage:n}),!e&&!t}},{key:"resetCredentialsCodeReset",value:function(e){u.a.glewlwydRequest("/"+e+"/reset-credentials-code","PUT").then((function(e){m.a.sendMessage("App",{type:"message",title:o.a.t("profile.reset-credentials-code-reset-title"),label:o.a.t("profile.reset-credentials-code-reset-label-modal"),message:e})})).fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"initPassword",value:function(e){if(Number.isInteger(e.password)){for(var t=[],a=0;a<e.password;a++)t.push("");return t}return""}},{key:"deletePasswordAt",value:function(e){var t=this.state.password,a=this.state.password_confirm;t[e]=null,a[e]=null,this.setState({password:t,password_confirm:a})}},{key:"addPassword",value:function(){var e=this.state.password,t=this.state.password_confirm;e.push(""),t.push(""),this.setState({password:e,password_confirm:t})}},{key:"render",value:function(){var e,t=this,a=[];if(this.state.registerPlugin.forEach((function(e,n){e["reset-credentials"].code&&a.push(s.a.createElement("div",{className:"card",key:n},s.a.createElement("div",{className:"card-header",id:"headingResetCredCode"+e.name},s.a.createElement("h2",{className:"mb-0"},s.a.createElement("button",{className:"btn btn-link btn-block text-left collapsed",type:"button","data-toggle":"collapse","data-target":"#collapseResetCredCode"+e.name,"aria-expanded":"false","aria-controls":"collapseResetCredCode"+e.name},o.a.t("profile.reset-credentials-code-reset-title")))),s.a.createElement("div",{id:"collapseResetCredCode"+e.name,className:"collapse","aria-labelledby":"headingResetCredCode"+e.name,"data-parent":"#accordionResetCredCode"},s.a.createElement("div",{className:"card-body"},s.a.createElement("p",null,o.a.t("profile.reset-credentials-code-reset-label")),s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(){return t.resetCredentialsCodeReset(e.name)}},o.a.t("profile.reset-credentials-code-reset-button"))))))})),Array.isArray(this.state.password)){var n=[],r=0;this.state.password.forEach((function(e,a){null!==e&&(r++,n.push(s.a.createElement("div",{key:a},s.a.createElement("div",{className:"form-group"},s.a.createElement("button",{className:"btn btn-secondary",type:"button",onClick:function(e){return t.deletePasswordAt(a)},title:o.a.t("admin.delete")},s.a.createElement("span",{className:"badge badge-light btn-icon"},r),s.a.createElement("i",{className:"fas fa-trash"})),s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("div",{className:"input-group-prepend"},s.a.createElement("label",{className:"input-group-text",htmlFor:"mod-new-password"},o.a.t("profile.password-new-password"))),s.a.createElement("input",{type:"password",autoComplete:"new-password",className:"form-control"+(t.state.passwordInvalid[a]?" is-invalid":""),id:"newPassword",placeholder:o.a.t("profile.password-new-password-ph",{minLength:t.state.passwordMinLength}),value:e||"",onChange:function(e){return t.changeNewPassword(e,a)}})),s.a.createElement("span",{className:"error-input"+(t.state.passwordInvalid[a]?"":" hidden")},t.state.passwordInvalidMessage[a])),s.a.createElement("div",{className:"form-group"},s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("div",{className:"input-group-prepend"},s.a.createElement("label",{className:"input-group-text",htmlFor:"mod-new-password-confirm"},o.a.t("profile.password-new-password-confirm"))),s.a.createElement("input",{type:"password",autoComplete:"new-password",className:"form-control"+(t.state.passwordConfirmInvalid[a]?" is-invalid":""),id:"retypeNewPassword",placeholder:o.a.t("profile.password-new-password-confirm-ph",{minLength:t.state.passwordMinLength}),value:t.state.password_confirm[a]||"",onChange:function(e){return t.changeNewPasswordConfirm(e,a)}})),s.a.createElement("span",{className:"error-input"+(t.state.passwordConfirmInvalid[a]?"":" hidden")},t.state.passwordConfirmInvalidMessage[a])))))})),e=s.a.createElement("div",{className:"card"},s.a.createElement("div",{className:"card-body"},n,s.a.createElement("hr",null),s.a.createElement("button",{className:"btn btn-secondary",type:"button",onClick:this.addPassword,title:o.a.t("admin.add")},s.a.createElement("i",{className:"fas fa-plus"}))))}else e=s.a.createElement("div",null,s.a.createElement("div",{className:"form-group"},s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("div",{className:"input-group-prepend"},s.a.createElement("label",{className:"input-group-text",htmlFor:"mod-new-password"},o.a.t("profile.password-new-password"))),s.a.createElement("input",{type:"password",autoComplete:"new-password",className:"form-control"+(this.state.passwordInvalid?" is-invalid":""),id:"newPassword",placeholder:o.a.t("profile.password-new-password-ph",{minLength:this.state.passwordMinLength}),value:this.state.password||"",onChange:function(e){return t.changeNewPassword(e)}})),s.a.createElement("span",{className:"error-input"+(this.state.passwordInvalid?"":" hidden")},this.state.passwordInvalidMessage)),s.a.createElement("div",{className:"form-group"},s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("div",{className:"input-group-prepend"},s.a.createElement("label",{className:"input-group-text",htmlFor:"mod-new-password-confirm"},o.a.t("profile.password-new-password-confirm"))),s.a.createElement("input",{type:"password",autoComplete:"new-password",className:"form-control"+(this.state.passwordConfirmInvalid?" is-invalid":""),id:"retypeNewPassword",placeholder:o.a.t("profile.password-new-password-confirm-ph",{minLength:this.state.passwordMinLength}),value:this.state.password_confirm||"",onChange:function(e){return t.changeNewPasswordConfirm(e)}})),s.a.createElement("span",{className:"error-input"+(this.state.passwordConfirmInvalid?"":" hidden")},this.state.passwordConfirmInvalidMessage)));return s.a.createElement("div",null,s.a.createElement("div",{className:"row",id:"password"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.password-title")))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("form",{className:"needs-validation",noValidate:!0},s.a.createElement("div",{className:"form-group"},s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("div",{className:"input-group-prepend"},s.a.createElement("label",{className:"input-group-text",htmlFor:"mod-old-password"},o.a.t("profile.password-old-password"))),s.a.createElement("input",{type:"password",autoComplete:"current-password",className:"form-control"+(this.state.oldPasswordInvalid?" is-invalid":""),id:"oldPassword",placeholder:o.a.t("profile.password-old-password-ph"),value:this.state.old_password,onChange:function(e){return t.changeOldPassword(e)}})),s.a.createElement("span",{className:"error-input"+(this.state.oldPasswordInvalid?"":" hidden")},this.state.oldPasswordInvalidMessage)),e))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12 text-right"},s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.passwordButtonHandler(e,!0)}},o.a.t("profile.save")))),s.a.createElement("hr",null),s.a.createElement("div",{className:"accordion",id:"accordionResetCredCode"},a))}}]),a}();function ae(e){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ne(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function se(e,t){return(se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ie(e){return(ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var oe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&se(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=ie(e);if(t){var s=ie(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==ae(t)&&"function"!=typeof t?re(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix,registered:!1,registration:!1},n.getRegister=n.getRegister.bind(re(n)),n.register=n.register.bind(re(n)),n.getRegister(),n}return function(e,t,a){t&&ne(e.prototype,t)}(a,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix,registered:!1,registration:!1},(function(){t.getRegister()}))}},{key:"getRegister",value:function(){var e=this;this.state.profile&&u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","PUT",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name},!0).then((function(t){e.setState({registration:o.a.t("profile.scheme-mock-register-status-registered"),registered:!0})})).fail((function(t){400===t.status?e.setState({registration:o.a.t("profile.scheme-mock-register-status-not-registered"),registered:!1}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"register",value:function(){var e=this;u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:!this.state.registered}}).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){m.a.sendMessage("App",{type:"registration"}),e.getRegister()}))}},{key:"render",value:function(){var e,t=this;return this.state.registration&&(e=s.a.createElement("div",null,s.a.createElement("h4",null,o.a.t("profile.scheme-mock-register-status")),s.a.createElement("span",{className:"badge badge-primary"},this.state.registration))),s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.scheme-mock-title",{module:this.state.module,name:this.state.name})))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},e)),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("hr",null))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.register(e)}},this.state.registered?o.a.t("profile.scheme-mock-deregister"):o.a.t("profile.scheme-mock-register"))))))}}]),a}();function le(e){return(le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ce(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ue(e,t){return(ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function me(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fe(e){return(fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var de=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ue(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=fe(e);if(t){var s=fe(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==le(t)&&"function"!=typeof t?me(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix,registered:!1,registration:!1,credentialList:[],credentialAvailable:!1,editIndex:-1,editValue:"",removeIndex:-1,credAssertion:!1,webauthnEnabled:!!window.PublicKeyCredential},n.getCredentials=n.getCredentials.bind(me(n)),n.createCredential=n.createCredential.bind(me(n)),n.testAssertion=n.testAssertion.bind(me(n)),n.editNameCred=n.editNameCred.bind(me(n)),n.changeName=n.changeName.bind(me(n)),n.saveName=n.saveName.bind(me(n)),n.cancelSaveName=n.cancelSaveName.bind(me(n)),n.switchCred=n.switchCred.bind(me(n)),n.removeCred=n.removeCred.bind(me(n)),n.confirmRemoveCred=n.confirmRemoveCred.bind(me(n)),n.getCredentials(),n}return function(e,t,a){t&&ce(e.prototype,t)}(a,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix,registered:!1,registration:!1},(function(){t.getCredentials()}))}},{key:"strToBin",value:function(e){return Uint8Array.from(atob(e),(function(e){return e.charCodeAt(0)}))}},{key:"binToStr",value:function(e){return btoa(new Uint8Array(e).reduce((function(e,t){return e+String.fromCharCode(t)}),""))}},{key:"getCredentials",value:function(){var e=this;this.state.profile&&u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","PUT",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name},!0).then((function(t){var a=!1;t.forEach((function(e){"registered"==e.status&&(a=!0)})),e.setState({credentialList:t,credentialAvailable:a,credAssertion:!1})})).fail((function(t){401===t.status?e.setState({registration:o.a.t("profile.scheme-webauthn-register-status-not-registered"),registered:!1,credentialList:[],credAssertion:!1}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"createCredential",value:function(){var e=this;u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"new-credential"}}).then((function(t){var a=[];e.state.credentialList.forEach((function(t){a.push({id:e.strToBin(t.credential_id),type:"public-key"})}));var n={authenticatorSelection:{requireResidentKey:!1},rp:{name:t.rpId.split("://")[1]},user:{id:Uint8Array.from(atob(t.user.id),(function(e){return e.charCodeAt(0)})),name:t.user.name,displayName:e.state.profile.name||t.user.name},pubKeyCredParams:t["pubKey-cred-params"],challenge:e.strToBin(t.challenge),excludeCredentials:a};t["attestation-required"]&&(n.attestation=t["attestation-required"]),t.timeout&&(n.timeout=t.timeout),navigator.credentials.create({publicKey:n}).then((function(a){var n={};"id"in a&&(n.id=a.id),"type"in a&&(n.type=a.type),"rawId"in a&&(n.rawId=e.binToStr(a.rawId));var s={};s.clientDataJSON=e.binToStr(a.response.clientDataJSON),s.attestationObject=e.binToStr(a.response.attestationObject),a.response.getTransports&&(s.transports=a.response.getTransports()),n.response=s,u.a.glewlwydRequest(e.state.schemePrefix+"/scheme/register/","POST",{username:e.state.profile.username,scheme_type:e.state.module,scheme_name:e.state.name,value:{register:"register-credential",session:t.session,credential:n}}).then((function(){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.scheme-webauthn-register-credential-success")}),e.getCredentials(),e.state.config.params.register&&m.a.sendMessage("App",{type:"registration"})})).fail((function(e,t){400===e.status?(m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.scheme-webauthn-register-credential-error")}),m.a.sendMessage("App",{type:"message",title:o.a.t("profile.scheme-webauthn-register-credential-error"),message:e.responseJSON})):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))})).catch((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.scheme-webauthn-error-registration")}),m.a.sendMessage("App",{type:"message",title:o.a.t("profile.scheme-webauthn-register-credential-error"),message:[e.toString()]})}))})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"testAssertion",value:function(e){var t=this;u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"trigger-assertion"}}).then((function(e){var a=[];e.allowCredentials.forEach((function(e){a.push({id:t.strToBin(e.credential_id),type:"public-key"})}));var n={allowCredentials:a,challenge:t.strToBin(e.challenge)};navigator.credentials.get({publicKey:n}).then((function(a){var n={};"id"in a&&(n.id=a.id),"type"in a&&(n.type=a.type),"rawId"in a&&(n.rawId=t.binToStr(a.rawId)),t.setState({credAssertion:n.rawId}),n.response={clientDataJSON:t.binToStr(a.response.clientDataJSON),authenticatorData:t.binToStr(a.response.authenticatorData),signature:t.binToStr(a.response.signature),userHandle:t.binToStr(a.response.userHandle)},a.response.getTransports&&(response.transports=a.response.getTransports()),u.a.glewlwydRequest(t.state.schemePrefix+"/scheme/register/","POST",{username:t.state.profile.username,scheme_type:t.state.module,scheme_name:t.state.name,value:{register:"validate-assertion",session:e.session,credential:n}},!0).then((function(){t.state.config.params.register&&m.a.sendMessage("App",{type:"registration"}),m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.scheme-webauthn-assertion-success")})})).fail((function(e){401===e.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.scheme-webauthn-assertion-error")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))})).catch((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.scheme-webauthn-error-assertion")}),m.a.sendMessage("App",{type:"message",title:o.a.t("profile.scheme-webauthn-register-credential-error"),message:[e.toString()]})}))})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"editNameCred",value:function(e){this.setState({editIndex:e,editValue:this.state.credentialList[e].name,credAssertion:!1})}},{key:"changeName",value:function(e){this.setState({editValue:e.target.value,credAssertion:!1})}},{key:"saveName",value:function(e,t){var a=this;e.preventDefault(),u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"edit-credential",credential_id:this.state.credentialList[t].credential_id,name:this.state.editValue}}).then((function(e){a.setState({editIndex:-1,editValue:""},(function(){a.getCredentials()}))})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"cancelSaveName",value:function(){this.setState({editIndex:-1,editValue:""})}},{key:"switchCred",value:function(e){var t=this;u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"registered"===this.state.credentialList[e].status?"disable-credential":"enable-credential",credential_id:this.state.credentialList[e].credential_id}}).then((function(e){t.state.config.params.register&&m.a.sendMessage("App",{type:"registration"}),t.getCredentials()})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"removeCred",value:function(e){var t=this;this.setState({removeIndex:e},(function(){m.a.sendMessage("App",{type:"confirm",title:o.a.t("profile.scheme-webauthn-confirm-title"),message:o.a.t("profile.scheme-webauthn-confirm-message"),callback:t.confirmRemoveCred})}))}},{key:"confirmRemoveCred",value:function(e){var t=this;e?u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"remove-credential",credential_id:this.state.credentialList[this.state.removeIndex].credential_id}}).then((function(e){t.getCredentials(),m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.scheme-webauthn-removed")}),t.state.config.params.register&&m.a.sendMessage("App",{type:"registration"})})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){m.a.sendMessage("App",{type:"closeConfirm"})})):m.a.sendMessage("App",{type:"closeConfirm"})}},{key:"render",value:function(){var e,t=this,a=[];return this.state.credentialList.forEach((function(e,n){var r=new Date(1e3*e.created_at);if(t.state.editIndex===n)a.push(s.a.createElement("tr",{key:n},s.a.createElement("td",{className:"d-none d-md-block"},r.toLocaleString()),s.a.createElement("td",null,s.a.createElement("form",{className:"needs-validation",noValidate:!0,onSubmit:function(e){return t.saveName(e,n)}},s.a.createElement("input",{type:"text",className:"form-control",value:t.state.editValue,onChange:function(e){return t.changeName(e,n)},placeholder:o.a.t("profile.webauthn-edit-placeholder")}))),s.a.createElement("td",{className:"d-none d-md-block"},o.a.t("admin.yes")),s.a.createElement("td",null,s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.saveName(e,n)},title:o.a.t("modal.ok")},s.a.createElement("i",{className:"fas fa-save"})),s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.cancelSaveName()},title:o.a.t("modal.close")},s.a.createElement("i",{className:"fas fa-times"}))))));else if("registered"===e.status){var i="";e.credential_id===t.state.credAssertion&&(i=s.a.createElement("i",{className:"far fa-check-circle btn-icon-right text-success"})),a.push(s.a.createElement("tr",{key:n},s.a.createElement("td",{className:"d-none d-md-block"},r.toLocaleString()),s.a.createElement("td",null,s.a.createElement("span",{className:"badge badge-success"},e.name),i),s.a.createElement("td",{className:"d-none d-md-block"},o.a.t("admin.yes")),s.a.createElement("td",null,s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.switchCred(n)},title:o.a.t("profile.scheme-webauthn-btn-switch-off")},s.a.createElement("i",{className:"fas fa-toggle-on"})),s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.editNameCred(n)},title:o.a.t("profile.scheme-webauthn-btn-edit")},s.a.createElement("i",{className:"fas fa-edit"})),s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.removeCred(n)},title:o.a.t("profile.scheme-webauthn-btn-remove")},s.a.createElement("i",{className:"fas fa-trash"}))))))}else a.push(s.a.createElement("tr",{key:n},s.a.createElement("td",{className:"d-none d-md-block"},r.toLocaleString()),s.a.createElement("td",null,s.a.createElement("span",{className:"badge badge-danger"},e.name)),s.a.createElement("td",{className:"d-none d-md-block"},o.a.t("admin.no")),s.a.createElement("td",null,s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.switchCred(n)},title:o.a.t("profile.scheme-webauthn-btn-switch-on")},s.a.createElement("i",{className:"fas fa-toggle-off"})),s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.editNameCred(n)},title:o.a.t("profile.scheme-webauthn-btn-edit")},s.a.createElement("i",{className:"fas fa-edit"})),s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.removeCred(n)},title:o.a.t("profile.scheme-webauthn-btn-remove")},s.a.createElement("i",{className:"fas fa-trash"}))))))})),this.state.webauthnEnabled||(e=s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"alert alert-danger",role:"alert"},o.a.t("profile.scheme-webauthn-disabled"))))),s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.scheme-webauthn-title",{module:this.state.module,name:this.state.name})))),e,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.getCredentials(e)}},o.a.t("login.btn-reload")))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("table",{className:"table table-responsive table-striped"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",{className:"d-none d-md-block"},o.a.t("profile.scheme-webauthn-table-created_at")),s.a.createElement("th",null,o.a.t("profile.scheme-webauthn-table-name")),s.a.createElement("th",{className:"d-none d-md-block"},o.a.t("profile.scheme-webauthn-table-enabled")),s.a.createElement("th",null))),s.a.createElement("tbody",null,a)))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("hr",null))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{type:"button",disabled:!this.state.webauthnEnabled,className:"btn btn-primary",onClick:function(e){return t.createCredential(e)},title:o.a.t("profile.scheme-webauthn-register-title")},o.a.t("profile.scheme-webauthn-register")),s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.testAssertion(e)},disabled:!this.state.credentialAvailable||!this.state.webauthnEnabled,title:o.a.t("profile.scheme-webauthn-test-registration-title")},o.a.t("profile.scheme-webauthn-test-registration"))))))}}]),a}(),pe=a(18),ge=a.n(pe);function he(e){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function be(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ye(e,t){return(ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ve(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ee(e){return(Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var we=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ye(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Ee(e);if(t){var s=Ee(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==he(t)&&"function"!=typeof t?ve(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix,myOtp:!1,errorList:{},otpUrl:!1,qrcode:"",allowHotp:!1,allowTotp:!1},n.getRegister=n.getRegister.bind(ve(n)),n.register=n.register.bind(ve(n)),n.changeParam=n.changeParam.bind(ve(n)),n.changeType=n.changeType.bind(ve(n)),n.generateSecret=n.generateSecret.bind(ve(n)),n.showQRCode=n.showQRCode.bind(ve(n)),n.getRegister(),n}return function(e,t,a){t&&be(e.prototype,t)}(a,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix},(function(){t.getRegister()}))}},{key:"getRegister",value:function(){var e=this;this.state.profile&&u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","PUT",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name}).then((function(t){var a;a="NONE"!==t.type&&t.type?t:{type:"NONE",secret:"",moving_factor:0,time_step_size:t["totp-window"]},e.setState({myOtp:a,allowHotp:t["hotp-allow"],allowTotp:t["totp-allow"]})})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){e.showQRCode()}))}},{key:"showQRCode",value:function(){var e=!1;if(this.state.myOtp.issuer&&this.state.profile.username&&this.state.myOtp.secret&&this.state.myOtp.digits&&("HOTP"===this.state.myOtp.type&&void 0!==this.state.myOtp.moving_factor?e="otpauth://hotp/"+encodeURIComponent(this.state.myOtp.issuer)+":"+encodeURIComponent(this.state.profile.username)+"?issuer="+encodeURIComponent([location.protocol,"//",location.host].join(""))+"&secret="+encodeURIComponent(this.state.myOtp.secret)+"&digits="+this.state.myOtp.digits+"&algorithm=SHA1&counter="+this.state.myOtp.moving_factor:"TOTP"===this.state.myOtp.type&&this.state.myOtp.time_step_size&&(e="otpauth://totp/"+encodeURIComponent(this.state.myOtp.issuer)+":"+encodeURIComponent(this.state.profile.username)+"?issuer="+encodeURIComponent([location.protocol,"//",location.host].join(""))+"&secret="+encodeURIComponent(this.state.myOtp.secret)+"&digits="+this.state.myOtp.digits+"&algorithm=SHA1&period="+this.state.myOtp.time_step_size)),e){var t=ge()(0,"L");t.addData(e),t.make(),this.setState({otpUrl:e,qrcode:t.createSvgTag(4)})}else this.setState({otpUrl:!1,qrcode:""})}},{key:"changeParam",value:function(e,t,a){var n=this,s=this.state.myOtp;s[t]=a?parseInt(e.target.value):e.target.value,this.setState({myOtp:s},(function(){n.showQRCode()}))}},{key:"changeType",value:function(e,t){var a=this;e.preventDefault();var n=this.state.myOtp;n.type=t,this.setState({myOtp:n},(function(){a.showQRCode()}))}},{key:"generateSecret",value:function(){var e=this;u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{"generate-secret":!0}}).then((function(t){var a=e.state.myOtp;a.secret=t.secret,e.setState({myOtp:a},(function(){e.showQRCode()}))})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"register",value:function(){var e=this,t={},a=!1;"NONE"!==this.state.myOtp.type&&(this.state.myOtp.secret||(t.secret=o.a.t("profile.scheme-otp-secret-error"),a=!0),"HOTP"===this.state.myOtp.type?""!==this.state.myOtp.moving_factor&&void 0!==this.state.myOtp.moving_factor||(t.moving_factor=o.a.t("profile.scheme-otp-moving_factor-error"),a=!0):"TOTP"===this.state.myOtp.type&&(""!==this.state.myOtp.time_step_size&&void 0!==this.state.myOtp.time_step_size||(t.time_step_size=o.a.t("profile.scheme-otp-time_step_size-error"),a=!0),""===this.state.myOtp.start_offset&&(t.start_offset=o.a.t("profile.scheme-otp-start_offset-error"),a=!0))),this.setState({errorList:t},(function(){a||u.a.glewlwydRequest(e.state.schemePrefix+"/scheme/register/","POST",{username:e.state.profile.username,scheme_type:e.state.module,scheme_name:e.state.name,value:e.state.myOtp}).then((function(t){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.scheme-otp-save-ok")}),e.getRegister(),e.state.config.params.register&&m.a.sendMessage("App",{type:"registration"})})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.scheme-otp-save-error")})}))}))}},{key:"render",value:function(){var e,t,a,n,r,i,l=this;return a=s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"input-group input-group-sm mb-3"},s.a.createElement("div",{className:"input-group-prepend"},s.a.createElement("span",{className:"input-group-text"},o.a.t("profile.scheme-otp-secret"))),s.a.createElement("input",{type:"text",maxLength:"128",className:this.state.errorList.secret?"form-control is-invalid":"form-control",id:"scheme-otp-secret",onChange:function(e){return l.changeParam(e,"secret")},value:this.state.myOtp.secret,placeholder:o.a.t("profile.scheme-otp-secret-ph")}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("button",{className:"btn btn-outline-secondary",type:"button",onClick:this.generateSecret},o.a.t("profile.scheme-otp-generate-secret"))),this.state.errorList.secret?s.a.createElement("span",{className:"error-input"},this.state.errorList.secret):""))),"HOTP"===this.state.myOtp.type?e=s.a.createElement("div",null,a,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"input-group input-group-sm mb-3"},s.a.createElement("div",{className:"input-group-prepend"},s.a.createElement("span",{className:"input-group-text"},o.a.t("profile.scheme-otp-moving_factor"))),s.a.createElement("input",{type:"number",min:"0",step:"1",className:this.state.errorList.moving_factor?"form-control is-invalid":"form-control",id:"scheme-otp-moving_factor",onChange:function(e){return l.changeParam(e,"moving_factor",1)},value:this.state.myOtp.moving_factor,placeholder:o.a.t("profile.scheme-otp-moving_factor-ph")}),this.state.errorList.moving_factor?s.a.createElement("span",{className:"error-input"},this.state.errorList.moving_factor):"")))):"TOTP"===this.state.myOtp.type&&(t=s.a.createElement("div",null,a,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"input-group input-group-sm mb-3"},s.a.createElement("div",{className:"input-group-prepend"},s.a.createElement("span",{className:"input-group-text"},o.a.t("profile.scheme-otp-time_step_size"))),s.a.createElement("input",{type:"number",min:"0",step:"1",className:this.state.errorList.time_step_size?"form-control is-invalid":"form-control",id:"scheme-otp-time_step_size",onChange:function(e){return l.changeParam(e,"time_step_size",1)},value:this.state.myOtp.time_step_size,placeholder:o.a.t("profile.scheme-otp-time_step_size-ph")}),this.state.errorList.time_step_size?s.a.createElement("span",{className:"error-input"},this.state.errorList.time_step_size):""))))),this.state.allowHotp&&(n=s.a.createElement("a",{className:"dropdown-item"+("HOTP"===this.state.myOtp.type?" active":""),href:"#",onClick:function(e){return l.changeType(e,"HOTP")}},o.a.t("profile.scheme-otp-type-HOTP"))),this.state.allowTotp&&(r=s.a.createElement("a",{className:"dropdown-item"+("TOTP"===this.state.myOtp.type?" active":""),href:"#",onClick:function(e){return l.changeType(e,"TOTP")}},o.a.t("profile.scheme-otp-type-TOTP"))),this.state.otpUrl&&(i=s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-4"},s.a.createElement("a",{href:this.state.otpUrl,title:this.state.otpUrl},s.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.state.qrcode}}))),s.a.createElement("div",{className:"col-md-8 v-center"},s.a.createElement("h4",null,o.a.t("profile.scheme-otp-scan-qrcode-message"))))),s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.scheme-otp-title")))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"input-group input-group-sm mb-3"},s.a.createElement("div",{className:"input-group-prepend"},s.a.createElement("span",{className:"input-group-text"},o.a.t("profile.scheme-otp-type"))),s.a.createElement("div",{className:"dropdown"},s.a.createElement("button",{className:"btn btn-secondary dropdown-toggle",type:"button",id:"scheme-otp-type","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},o.a.t("profile.scheme-otp-type-"+this.state.myOtp.type)),s.a.createElement("div",{className:"dropdown-menu","aria-labelledby":"scheme-otp-type"},r,n,s.a.createElement("a",{className:"dropdown-item"+("NONE"===this.state.myOtp.type?" active":""),href:"#",onClick:function(e){return l.changeType(e,"NONE")}},o.a.t("profile.scheme-otp-type-NONE"))))))),e,t,i,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("hr",null))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return l.register(e)}},o.a.t("profile.scheme-otp-save"))))))}}]),a}();function Ne(e){return(Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ce(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ke(e,t){return(ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Se(e){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _e=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ke(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Se(e);if(t){var s=Se(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==Ne(t)&&"function"!=typeof t?Pe(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix,registered:!1,registration:!1,certificateList:[],dn:!1,addModal:!1,certFile:!1,curCert:!1,fileName:!1,activeCert:!1,downloadCert:!1,canAddCert:!1,canRequestCert:!1},n.getRegister=n.getRegister.bind(Pe(n)),n.selectCertFile=n.selectCertFile.bind(Pe(n)),n.addCertificateFile=n.addCertificateFile.bind(Pe(n)),n.addCertificateFromRequest=n.addCertificateFromRequest.bind(Pe(n)),n.switchCertStatus=n.switchCertStatus.bind(Pe(n)),n.deleteCert=n.deleteCert.bind(Pe(n)),n.confirmDeleteCert=n.confirmDeleteCert.bind(Pe(n)),n.testCertificate=n.testCertificate.bind(Pe(n)),n.getRegister(),n}return function(e,t,a){t&&Ce(e.prototype,t)}(a,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix,registered:!1,registration:!1,certificateList:[],dn:!1,addModal:!1,certFile:!1,fileName:!1,activeCert:!1,downloadCert:!1,canAddCert:!1,canRequestCert:!1})}},{key:"getRegister",value:function(){var e=this;return this.state.profile?u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","PUT",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name}).then((function(t){e.setState({certificateList:t.certificate||[],dn:t.dn||!1,canAddCert:t["add-certificate"],certFile:!1,canRequestCert:t["request-certificate"],fileName:!1,activeCert:!1,downloadCert:!1})})).fail((function(t){e.setState({certificateList:[],dn:!1,canAddCert:!1,canRequestCert:!1,certFile:!1,fileName:!1,downloadCert:!1},(function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))})):Promise.reject(new Error("fail"))}},{key:"selectCertFile",value:function(e){var t=this,a=(this.state.profile,e.target.files[0]),n=new FileReader;n.onload=function(e){t.setState({certFile:e.target.result,fileName:a.name})},n.readAsText(a)}},{key:"addCertificateFile",value:function(){var e=this;this.state.certFile&&u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"upload-certificate",x509:this.state.certFile}}).then((function(t){e.getRegister(),e.state.config.params.register&&(m.a.sendMessage("App",{type:"registration"}),m.a.sendMessage("App",{type:"nav",page:"profile"}))})).fail((function(e){400===e.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.scheme-certificate-invalid")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"addCertificateFromRequest",value:function(){var e=this;u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"use-certificate"}}).then((function(t){e.getRegister(),e.state.config.params.register&&m.a.sendMessage("App",{type:"registration"})})).fail((function(e){400===e.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.scheme-certificate-invalid")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"switchCertStatus",value:function(e){var t=this;u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"toggle-certificate",certificate_id:e.certificate_id,enabled:!e.enabled}}).then((function(a){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.scheme-certificate-"+(e.enabled?"disabled":"enabled"))}),t.getRegister(),t.state.config.params.register&&m.a.sendMessage("App",{type:"registration"})})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"deleteCert",value:function(e,t){var a=this;e.preventDefault(),this.setState({curCert:t,certFile:!1,fileName:!1},(function(){m.a.sendMessage("App",{type:"confirm",title:o.a.t("profile.scheme-certificate-confirm-title"),message:o.a.t("profile.scheme-certificate-confirm-message"),callback:a.confirmDeleteCert})}))}},{key:"confirmDeleteCert",value:function(e){var t=this;e?u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"delete-certificate",certificate_id:this.state.curCert.certificate_id}}).then((function(e){t.getRegister(),t.state.config.params.register&&m.a.sendMessage("App",{type:"registration"})})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){m.a.sendMessage("App",{type:"closeConfirm"})})):m.a.sendMessage("App",{type:"closeConfirm"})}},{key:"testCertificate",value:function(){var e=this;u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"test-certificate"}}).then((function(t){e.setState({activeCert:t}),m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.scheme-certificate-test-valid")})})).fail((function(e){400===e.status||401===e.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.scheme-certificate-invalid")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"render",value:function(){var e=this,t=[];return this.state.certificateList.forEach((function(a,n){var r,i,l=new Date(1e3*a.expiration),c=new Date(1e3*a.last_used);e.state.activeCert&&a.certificate_id===e.state.activeCert.certificate_id&&(i=s.a.createElement("i",{className:"far fa-check-circle btn-icon-right text-success"})),r=!0===a.enabled?s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return e.switchCertStatus(a)},title:o.a.t("admin.switch-off")},s.a.createElement("i",{className:"fas fa-toggle-on"})),s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return e.deleteCert(t,a)},title:o.a.t("admin.delete")},s.a.createElement("i",{className:"fas fa-trash"}))):!1===a.enabled?s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return e.switchCertStatus(a)},title:o.a.t("admin.switch-on")},s.a.createElement("i",{className:"fas fa-toggle-off"})),s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return e.deleteCert(t,a)},title:o.a.t("admin.delete")},s.a.createElement("i",{className:"fas fa-trash"}))):s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{type:"button",disabled:!0,className:"btn btn-secondary",title:o.a.t("admin.switch-off")},s.a.createElement("i",{className:"fas fa-toggle-on"})),s.a.createElement("button",{type:"button",disabled:!0,className:"btn btn-secondary",title:o.a.t("admin.delete")},s.a.createElement("i",{className:"fas fa-trash"}))),t.push(s.a.createElement("tr",{key:n},s.a.createElement("td",null,s.a.createElement("span",{className:"d-inline-block",tabIndex:"0","data-toggle":"tooltip",title:a.certificate_dn},a.certificate_dn.substring(0,8),"[...]"),i),s.a.createElement("td",{className:"d-none d-lg-table-cell"},s.a.createElement("span",{className:"d-inline-block",tabIndex:"1","data-toggle":"tooltip",title:a.certificate_issuer_dn},a.certificate_issuer_dn.substring(0,8),"[...]")),s.a.createElement("td",{className:"d-none d-lg-table-cell"},l.toLocaleString()),s.a.createElement("td",{className:"d-none d-lg-table-cell"},c.toLocaleString()),s.a.createElement("td",null,r)))})),this.state.dn&&t.push(s.a.createElement("tr",{key:t.length},s.a.createElement("td",null,s.a.createElement("span",{className:"d-inline-block",tabIndex:"0","data-toggle":"tooltip",title:this.state.dn},this.state.dn.substring(0,8),"[...]")),s.a.createElement("td",{className:"d-none d-lg-table-cell"},s.a.createElement("span",{className:"d-inline-block",tabIndex:"1","data-toggle":"tooltip"})),s.a.createElement("td",{className:"d-none d-lg-table-cell"}),s.a.createElement("td",{className:"d-none d-lg-table-cell"}),s.a.createElement("td",null))),s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.scheme-certificate-title",{module:this.state.module,name:this.state.name})))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-6"},s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("div",{className:"input-group-prepend"},s.a.createElement("button",{className:"btn btn-outline-secondary",type:"button",disabled:!this.state.canAddCert,id:"addCertificateFromFile",title:o.a.t("profile.scheme-certificate-add-from-file"),onClick:this.addCertificateFile},o.a.t("upload"))),s.a.createElement("div",{className:"custom-file"},s.a.createElement("input",{type:"file",disabled:!this.state.canAddCert,className:"custom-file-input",id:"addCertificateFromFileInput","aria-describedby":"addCertificateFromFile",onChange:function(t){return e.selectCertFile(t)}}),s.a.createElement("label",{className:"custom-file-label",htmlFor:"addCertificateFromFile"},this.state.fileName||o.a.t("browse"))))),s.a.createElement("div",{className:"col-md-6"},s.a.createElement("div",{className:"btn-group",role:"group","aria-label":"current-certificate"},s.a.createElement("button",{type:"button",className:"btn btn-outline-secondary",disabled:!this.state.canAddCert,onClick:this.addCertificateFromRequest,title:o.a.t("profile.scheme-certificate-add-from-request")},s.a.createElement("i",{className:"fas fa-file-code-o"})),s.a.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:this.testCertificate,title:o.a.t("profile.scheme-certificate-test")},s.a.createElement("i",{className:"fas fa-question-circle"})),s.a.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:this.getRegister,title:o.a.t("profile.scheme-certificate-refresh")},s.a.createElement("i",{className:"fas fa-sync"}))))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("table",{className:"table table-responsive table-striped"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,o.a.t("profile.scheme-certificate-table-certificate_dn")),s.a.createElement("th",{className:"d-none d-lg-table-cell"},o.a.t("profile.scheme-certificate-table-certificate_issuer_dn")),s.a.createElement("th",{className:"d-none d-lg-table-cell"},o.a.t("profile.scheme-certificate-table-expiration")),s.a.createElement("th",{className:"d-none d-lg-table-cell"},o.a.t("profile.scheme-certificate-table-last_used")),s.a.createElement("th",null))),s.a.createElement("tbody",null,t)))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("hr",null))))}}]),a}();function Oe(e){return(Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Re(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function xe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Le(e){return(Le=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var je=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Le(e);if(t){var s=Le(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==Oe(t)&&"function"!=typeof t?xe(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix,registerList:[],removeProvdier:!1},n.getRegister=n.getRegister.bind(xe(n)),n.confirmRemoveRegistration=n.confirmRemoveRegistration.bind(xe(n)),n.getRegister(),n}return function(e,t,a){t&&Re(e.prototype,t)}(a,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix},(function(){t.getRegister()}))}},{key:"getRegister",value:function(){var e=this;this.state.profile&&u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","PUT",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name},!0).then((function(t){e.setState({registerList:t})})).fail((function(e){400===e.status||m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"addRegistration",value:function(e){this.state.profile&&u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{provider:e,action:"new",register_url:this.state.config.params.register?u.a.getConfig()+"/"+this.state.config.params.register:u.a.getConfig(),complete_url:window.location.href}},!0).then((function(e){document.location=e.redirect_to})).fail((function(e){400===e.status||m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"removeRegistration",value:function(e){var t=this;this.setState({removeProvdier:e},(function(){m.a.sendMessage("App",{type:"confirm",title:o.a.t("profile.scheme-oauth2-confirm-title"),message:o.a.t("profile.scheme-oauth2-confirm-message",{provider:e}),callback:t.confirmRemoveRegistration})}))}},{key:"confirmRemoveRegistration",value:function(e){var t=this;this.state.profile?u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{provider:this.state.removeProvdier,action:"delete"}},!0).then((function(e){t.getRegister()})).fail((function(e){400===e.status||m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){m.a.sendMessage("App",{type:"closeConfirm"})})):m.a.sendMessage("App",{type:"closeConfirm"})}},{key:"render",value:function(){var e=this,t=[];return this.state.registerList.forEach((function(a,n){var r,i,l,c;a.logo_uri?r=s.a.createElement("img",{src:a.logo_uri,alt:a.provider,className:"img-fluid logo-img"}):a.logo_fa&&(r=s.a.createElement("i",{className:a.logo_fa})),null!==a.created_at?(i=new Date(1e3*a.created_at).toLocaleString(),l=a.last_session?new Date(1e3*a.last_session).toLocaleString():o.a.t("profile.scheme-oauth2-registration-invalid"),c=s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(t){return e.removeRegistration(a.provider)},title:o.a.t("profile.scheme-oauth2-btn-remove")},s.a.createElement("i",{className:"fas fa-trash"}))):c=s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(t){return e.addRegistration(a.provider)},title:o.a.t("profile.scheme-oauth2-btn-add")},s.a.createElement("i",{className:"fas fa-plus"})),t.push(s.a.createElement("tr",{key:n},s.a.createElement("td",null,r),s.a.createElement("td",null,s.a.createElement("span",{className:"badge badge-success"},a.provider)),s.a.createElement("td",null,i),s.a.createElement("td",null,l),s.a.createElement("td",null,c)))})),s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.scheme-oauth2-title")))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("table",{className:"table table-responsive table-striped"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null),s.a.createElement("th",null,o.a.t("profile.scheme-oauth2-table-name")),s.a.createElement("th",null,o.a.t("profile.scheme-oauth2-table-created_at")),s.a.createElement("th",null,o.a.t("profile.scheme-oauth2-table-last_session")),s.a.createElement("th",null))),s.a.createElement("tbody",null,t)))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("hr",null))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"btn-group",role:"group"}))))}}]),a}();function Te(e){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ie(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ae(e,t){return(Ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function De(e){return(De=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ue=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ae(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=De(e);if(t){var s=De(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==Te(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix},n}return function(e,t,a){t&&Ie(e.prototype,t)}(a,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix})}},{key:"render",value:function(){return"mock"===this.state.module?s.a.createElement(oe,{config:this.state.config,module:this.state.module,name:this.state.name,profile:this.state.profile,schemePrefix:this.state.schemePrefix}):"webauthn"===this.state.module?s.a.createElement(de,{config:this.state.config,module:this.state.module,name:this.state.name,profile:this.state.profile,schemePrefix:this.state.schemePrefix}):"otp"===this.state.module?s.a.createElement(we,{config:this.state.config,module:this.state.module,name:this.state.name,profile:this.state.profile,schemePrefix:this.state.schemePrefix}):"certificate"===this.state.module?s.a.createElement(_e,{config:this.state.config,module:this.state.module,name:this.state.name,profile:this.state.profile,schemePrefix:this.state.schemePrefix}):"oauth2"===this.state.module?s.a.createElement(je,{config:this.state.config,module:this.state.module,name:this.state.name,profile:this.state.profile,schemePrefix:this.state.schemePrefix}):s.a.createElement("div",null,s.a.createElement("h4",null,o.a.t("profile.scheme-not-found",{module:this.state.module})))}}]),a}(),qe=a(12),Ve=a(9);function Fe(e){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function He(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ge(e,t){return(Ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Be(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function We(e){return(We=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ze=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ge(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=We(e);if(t){var s=We(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==Fe(t)&&"function"!=typeof t?Be(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={title:e.title,message:e.message,value:e.value,placeHolder:e.placeHolder,cb:e.callback},n.closeModal=n.closeModal.bind(Be(n)),n.changeValue=n.changeValue.bind(Be(n)),n}return function(e,t,a){t&&He(e.prototype,t)}(a,[{key:"componentWillReceiveProps",value:function(e){this.setState({title:e.title,message:e.message,value:e.value,placeHolder:e.placeHolder,cb:e.callback})}},{key:"closeModal",value:function(e,t){this.state.cb&&this.state.cb(t,this.state.value)}},{key:"changeValue",value:function(e){this.setState({value:e.target.value})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"modal fade on-top",id:"editModal",tabIndex:"-1",role:"dialog","aria-labelledby":"editModalLabel","aria-hidden":"true"},s.a.createElement("div",{className:"modal-dialog modal-lg",role:"document"},s.a.createElement("div",{className:"modal-content"},s.a.createElement("div",{className:"modal-header"},s.a.createElement("h5",{className:"modal-title",id:"editModalLabel"},this.state.title),s.a.createElement("button",{type:"button",className:"close","aria-label":o.a.t("modal.close"),onClick:function(t){return e.closeModal(t,!1)}},s.a.createElement("span",{"aria-hidden":"true"},"Ã—"))),s.a.createElement("div",{className:"modal-body"},this.state.message,s.a.createElement("form",{className:"needs-validation",noValidate:!0},s.a.createElement("div",{className:"form-group"},s.a.createElement("input",{type:"text",className:"form-control",id:"editModalInput",placeholder:this.state.placeHolder||"",value:this.state.value,onChange:function(t){return e.changeValue(t)}})))),s.a.createElement("div",{className:"modal-footer"},s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return e.closeModal(t,!1)}},o.a.t("modal.close")),s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(t){return e.closeModal(t,!0)}},o.a.t("modal.ok"))))))}}]),a}();function $e(e){return($e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Je(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Qe(e,t){return(Qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ke(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ye(e){return(Ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Xe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qe(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Ye(e);if(t){var s=Ye(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==$e(t)&&"function"!=typeof t?Ke(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={lang:o.a.language,config:e.config,registerPlugin:[],registerConfig:!1,registerProfile:!1,registerSchemes:{},schemeHighlight:{},registering:!1,registerValid:!0,curNav:"profile",profileList:!1,profileUpdate:!1,schemeList:[],loggedIn:!1,confirmModal:{title:"",message:"",callback:!1},messageModal:{title:"",label:"",message:""},editModal:{title:"",message:"",value:"",placeHolder:"",callback:!1},plugins:{oauth2:{},oidc:{}},sessionList:[],invalidCredentialMessage:!1,invalidDelegateMessage:!1,tokenParsed:!1,registerDefaultLang:!1,updateEmail:[],updateEmailModule:!1,register:!1,schemePrefix:e.config&&e.config.params.register?"/"+e.config.params.register+"/profile":"/profile",resetCredentials:0},n.fetchProfile=n.fetchProfile.bind(Ke(n)),n.updateEmailCallback=n.updateEmailCallback.bind(Ke(n)),n.refreshSession=n.refreshSession.bind(Ke(n)),m.a.subscribe("App",(function(e){if("nav"===e.type)"password"===e.page?n.setState({curNav:"password"}):"session"===e.page?n.setState({curNav:"session"}):"profile"===e.page?n.setState({curNav:"profile"}):"resetCredentialsCode"===e.page?n.setState({curNav:"resetCredentialsCode"}):n.setState({curNav:e.module,module:e.page});else if("loggedIn"===e.type)n.setState({loggedIn:e.loggedIn},(function(){n.fetchProfile()}));else if("lang"===e.type)n.setState({lang:o.a.language},(function(){n.state.config.params.register&&n.state.registerConfig.languages.length&&n.state.registerConfig.languages.forEach((function(e){e===n.state.lang&&n.setState({registerDefaultLang:e})}))}));else if("profile"===e.type)n.fetchProfile();else if("confirm"===e.type){var t=n.state.confirmModal;t.title=e.title,t.message=e.message,t.callback=e.callback,n.setState({confirmModal:t},(function(){$("#confirmModal").modal({keyboard:!1,show:!0})}))}else if("message"===e.type){var a=n.state.messageModal;a.title=e.title,a.label=e.label,a.message=e.message,n.setState({messageModal:a},(function(){$("#messageModal").modal({keyboard:!1,show:!0})}))}else if("closeConfirm"===e.type)$("#confirmModal").modal("hide");else if("registration"===e.type)n.state.config.params.register&&n.setState({registerProfile:!1,schemeList:[],profileList:!1},(function(){n.fetchRegistration()}));else if("registrationComplete"===e.type)n.state.config.params.register?n.setState({registerProfile:!1,schemeList:[],profileList:!1,registering:!1}):n.setState({registerProfile:!1,schemeList:[],profileList:!1,registering:!1},(function(){n.fetchRegistration()}));else if("updateEmailAvailable"===e.type){var s=n.state.updateEmail;e.module&&s.push(e.module),n.setState({updateEmail:s,register:!0})}else if("updateEmail"===e.type){if(e.module){var r={title:o.a.t("profile.update-email-modal-title"),message:o.a.t("profile.update-email-modal-message"),value:"",placeHolder:o.a.t("profile.update-email-modal-ph"),callback:n.updateEmailCallback};n.setState({editModal:r,updateEmailModule:e.module},(function(){$("#editModal").modal({keyboard:!1,show:!0})}))}}else"refreshSession"===e.type&&n.refreshSession()})),n.state.config&&(n.getRegisterConfig(),n.state.config.params.updateEmail?n.updateEmailVerifyToken(n.state.config.params.updateEmail,n.state.config.params.token).then((function(){m.a.sendMessage("Notification",{type:"success",message:o.a.t("profile.update-email-success")}),n.fetchProfile()})):n.state.config.params.resetCredentials?n.state.config.register&&(n.state.config.params.token?u.a.glewlwydRequest("/"+n.state.config.params.resetCredentials+"/reset-credentials-email/"+encodeURI(n.state.config.params.token),"PUT").then((function(){n.getResetCredentialsConfig()})).fail((function(e){403===e.status?(n.setState({resetCredentials:-1}),m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.reset-credentials-email-token-error")})):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})):n.getResetCredentialsConfig()):n.state.config.params.register||n.fetchProfile()),n}return function(e,t,a){t&&Je(e.prototype,t)}(a,[{key:"getRegisterConfig",value:function(){var e=this;this.state.config.register&&this.state.config.register.forEach((function(t,a){u.a.glewlwydRequest("/"+t.name+"/config").then((function(a){var n=e.state.registerPlugin;a.name=t.name,n.push(a),e.setState({registerPlugin:n},(function(){if(e.state.config.params.register&&e.fetchRegistration(),a["update-email"]){var n=e.state.updateEmail;n.push(t.name),e.setState({updateEmail:n})}}))})).fail((function(t){e.setState({registerValid:!1,registering:!1},(function(){404===t.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.register-invalid-url")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}))}))}},{key:"getResetCredentialsConfig",value:function(){var e=this;u.a.glewlwydRequest("/"+this.state.config.params.resetCredentials+"/reset-credentials/profile/").then((function(t){e.setState({profileList:[t.user],loggedIn:!0,schemeList:t.scheme,schemePrefix:"/"+e.state.config.params.resetCredentials+"/reset-credentials/profile",resetCredentials:1})})).fail((function(t){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")}),e.setState({resetCredentials:-1})}))}},{key:"fetchProfile",value:function(){var e=this;this.state.config.params.delegate?u.a.glewlwydRequest("/profile/scheme").then((function(t){e.setState({loggedIn:!0,profileList:[{username:e.state.config.params.delegate}],schemeList:t,invalidCredentialMessage:!1,invalidDelegateMessage:!1},(function(){e.state.config.params.scheme_name&&t.forEach((function(t){t.name===e.state.config.params.scheme_name&&m.a.sendMessage("Nav",{type:t.module,page:t.name})}))}))})).fail((function(t){e.setState({invalidCredentialMessage:!1,invalidDelegateMessage:!0},(function(){401===t.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.requires-profile-scope")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))})):u.a.glewlwydRequest("/profile_list").then((function(t){e.setState({profileList:t},(function(){!t[0]||t[0].scope.indexOf(e.state.config.profile_scope)<0?e.setState({loggedIn:!1,schemeList:[],invalidDelegateMessage:!1,invalidCredentialMessage:!0,profileUpdate:!1},(function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.requires-profile-scope")})})):u.a.glewlwydRequest("/profile/scheme").then((function(t){e.setState({loggedIn:!0,schemeList:t,invalidDelegateMessage:!1,invalidCredentialMessage:!1,profileUpdate:!0},(function(){e.state.config.params.scheme_name&&t.forEach((function(t){t.name===e.state.config.params.scheme_name&&m.a.sendMessage("Nav",{type:t.module,page:t.name})}))})),e.refreshSession()})).fail((function(t){e.setState({loggedIn:!1,schemeList:[],invalidDelegateMessage:!1,invalidCredentialMessage:!0,profileUpdate:!1},(function(){401===t.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.requires-profile-scope")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}))}))})).fail((function(t){e.setState({loggedIn:!1,profileList:!1,schemeList:[],invalidDelegateMessage:!1,invalidCredentialMessage:!0},(function(){401===t.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.requires-profile-scope")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}))}},{key:"refreshSession",value:function(){var e=this;u.a.glewlwydRequest("/profile/session").then((function(t){e.setState({sessionList:t})})).fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})),u.a.glewlwydRequest("/profile/plugin").then((function(t){t.forEach((function(t){"oauth2-glewlwyd"===t.module?u.a.glewlwydRequestSub("/"+t.name+"/profile/token"+(e.state.config.params.delegate?"?impersonate="+e.state.config.params.delegate:"")).then((function(a){var n=e.state.plugins;n.oauth2[t.name]=a,e.setState({plugins:n})})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})):"oidc"===t.module&&u.a.glewlwydRequestSub("/"+t.name+"/token"+(e.state.config.params.delegate?"?impersonate="+e.state.config.params.delegate:"")).then((function(a){var n=e.state.plugins;n.oidc[t.name]=a,e.setState({plugins:n})})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))})),m.a.sendMessage("App",{type:"sessionComplete"})})).fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"fetchRegistration",value:function(){var e=this;this.state.registerPlugin.forEach((function(t){if(t.registration){var a=!1;e.state.lang&&t.registration.languages.length&&t.registration.languages.forEach((function(t){t===e.state.lang&&(a=e.state.lang)})),!a&&t.registration.languages.length&&(a=t.registration.languages[0]),e.setState({registerValid:!0,registerConfig:t.registration,registerDefaultLang:a},(function(){!e.state.config.params.token||e.state.tokenParsed?u.a.glewlwydRequest("/"+e.state.config.params.register+"/profile").then((function(a){e.setState({registerProfile:a,schemeList:t.registration.schemes,profile:a,profileList:[a],registering:!0},(function(){t.registration.schemes.forEach((function(t){u.a.glewlwydRequest("/"+e.state.config.params.register+"/profile/scheme/register/canuse","PUT",{username:a.username,scheme_type:t.module,scheme_name:t.name}).then((function(){var a=e.state.registerSchemes,n=e.state.schemeHighlight;n[t.name]=!1,a[t.name]=!0,e.setState({registerSchemes:a,schemeHighlight:n})})).fail((function(){var a=e.state.registerSchemes,n=e.state.schemeHighlight;a[t.name]=!1,"always"==t.register&&(n[t.name]=!0),e.setState({registerSchemes:a,schemeHighlight:n})}))}))}))})).fail((function(t){401!=t.status&&m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")}),e.setState({registerProfile:!1,registering:!1})})):u.a.glewlwydRequest("/"+e.state.config.params.register+"/verify","POST",{token:e.state.config.params.token}).then((function(){u.a.glewlwydRequest("/"+e.state.config.params.register+"/profile").then((function(a){e.setState({tokenParsed:!0,registerProfile:a,schemeList:t.schemes,profile:a,profileList:[a],registering:!0},(function(){t.registration.schemes.forEach((function(t){u.a.glewlwydRequest("/"+e.state.config.params.register+"/profile/scheme/register/canuse","PUT",{username:a.username,scheme_type:t.module,scheme_name:t.name}).then((function(){var a=e.state.registerSchemes;a[t.name]=!0,e.setState({registerSchemes:a})})).fail((function(){var a=e.state.registerSchemes;a[t.name]=!1,e.setState({registerSchemes:a})}))}))}))})).fail((function(t){401!=t.status&&m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")}),e.setState({registerProfile:!1,registering:!1})}))})).fail((function(t){401!=t.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.register-token-invalid")}),e.setState({registerProfile:!1,registering:!1})}))}))}if(t["update-email"]){var n=e.state.updateEmail;n.push(e.state.config.params.register),e.setState({updateEmail:n})}}))}},{key:"updateEmailVerifyToken",value:function(e,t){return u.a.glewlwydRequest("/"+e+"/update-email/"+encodeURIComponent(t),"PUT").fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"showPasswordChangeNotification",value:function(e,t){e&&m.a.sendMessage("Notification",{type:"success",message:o.a.t("profile.password-change-success")})}},{key:"updateEmailCallback",value:function(e,t){var a=this;$("#editModal").modal("hide"),e&&u.a.glewlwydRequest("/"+this.state.updateEmailModule+"/update-email","POST",{email:t}).then((function(e){var n={title:o.a.t("profile.update-email-modal-title"),message:[o.a.t("profile.update-email-modal-complete-message",{email:t})]};a.setState({messageModal:n},(function(){$("#messageModal").modal({keyboard:!1,show:!0})}))})).fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"render",value:function(){if(this.state.config){var e,t;return this.state.invalidCredentialMessage?e=s.a.createElement("div",{className:"alert alert-danger",role:"alert"},o.a.t("profile.error-credential-message")):this.state.invalidDelegateMessage&&(e=s.a.createElement("div",{className:"alert alert-danger",role:"alert"},o.a.t("admin.error-credential-message"))),t=this.state.config.params.delegate?s.a.createElement(M,{config:this.state.config,profile:this.state.profileList[0]||!1}):this.state.config.params.register?s.a.createElement(H,{config:this.state.config,registerConfig:this.state.registerConfig,registerProfile:this.state.registerProfile,registerSchemes:this.state.registerSchemes,registerValid:this.state.registerValid,registerDefaultLang:this.state.registerDefaultLang}):this.state.config.params.resetCredentials?s.a.createElement(A,{config:this.state.config,profile:this.state.profileList[0]||!1,status:this.state.resetCredentials}):s.a.createElement(P,{config:this.state.config,profile:this.state.profileList[0]||!1,pattern:!!this.state.config&&this.state.config.pattern.user,profileUpdate:this.state.profileUpdate,loggedIn:this.state.loggedIn,updateEmail:this.state.updateEmail}),s.a.createElement("div",{"aria-live":"polite","aria-atomic":"true",className:"glwd-container"},s.a.createElement("div",{className:"card center glwd-card",id:"userCard",tabIndex:"-1",role:"dialog"},s.a.createElement("div",{className:"card-header"},s.a.createElement(v,{active:this.state.curNav,config:this.state.config,loggedIn:this.state.loggedIn,schemeList:this.state.schemeList,profileList:this.state.profileList,dataHighlight:!this.state.registerProfile.password_set,schemeHighlight:this.state.schemeHighlight,registering:this.state.registering})),e,s.a.createElement("div",{className:"card-body"},s.a.createElement("div",{id:"carouselBody",className:"carousel slide","data-ride":"carousel"},s.a.createElement("div",{className:"carousel-inner"},s.a.createElement("div",{className:"carousel-item"+("profile"===this.state.curNav?" active":"")},t),s.a.createElement("div",{className:"carousel-item"+("session"===this.state.curNav?" active":"")},s.a.createElement(Q,{config:this.state.config,plugins:this.state.plugins,sessionList:this.state.sessionList})),s.a.createElement("div",{className:"carousel-item"+("password"===this.state.curNav?" active":"")},s.a.createElement(te,{config:this.state.config,profile:this.state.profileList[0]||!1,loggedIn:this.state.loggedIn,callback:this.showPasswordChangeNotification,registerPlugin:this.state.registerPlugin})),s.a.createElement("div",{className:"carousel-item"+("profile"!==this.state.curNav&&"session"!==this.state.curNav&&"password"!==this.state.curNav?" active":"")},s.a.createElement(Ue,{config:this.state.config,module:this.state.curNav,name:this.state.module,profile:this.state.profileList[0]||!1,schemePrefix:this.state.schemePrefix})))))),s.a.createElement(f.a,{loggedIn:this.state.loggedIn||this.state.config.params.register}),s.a.createElement(qe.a,{title:this.state.confirmModal.title,message:this.state.confirmModal.message,callback:this.state.confirmModal.callback}),s.a.createElement(Ve.a,{title:this.state.messageModal.title,label:this.state.messageModal.label,message:this.state.messageModal.message}),s.a.createElement(ze,{title:this.state.editModal.title,message:this.state.editModal.message,value:this.state.editModal.value,placeHolder:this.state.editModal.placeHolder,callback:this.state.editModal.callback}))}return s.a.createElement("div",{"aria-live":"polite","aria-atomic":"true",className:"glwd-container"},s.a.createElement("div",{className:"card center glwd-card",id:"userCard",tabIndex:"-1",role:"dialog"},s.a.createElement("div",{className:"card-header"},s.a.createElement("h4",null,s.a.createElement("span",{className:"badge badge-danger"},o.a.t("error-api-connect"))))))}}]),a}(),Ze=a(8);try{o.a.use(l.a).use(c.a).init({fallbackLng:"en",ns:["translations"],defaultNS:"translations",backend:{loadPath:"locales/{{lng}}/{{ns}}.json"}}).then((function(){!function(){var e=new URLSearchParams(window.location.search);u.a.request("config.json").then((function(t){t.lang||(t.lang=["en","fr","nl"]),u.a.request(t.GlewlwydUrl+"config/").then((function(a){e.get("delegate")?u.a.setConfig(t.GlewlwydUrl+a.api_prefix+"/delegate/"+e.get("delegate")):u.a.setConfig(t.GlewlwydUrl+a.api_prefix),u.a.setConfigSub(t.GlewlwydUrl+a.api_prefix);var n=Object.assign({params:{scope:e.get("scope"),client_id:e.get("client_id"),callback_url:e.get("callback_url"),delegate:e.get("delegate")||!1,register:e.get("register")||!1,updateEmail:e.get("updateEmail")||!1,token:e.get("token")||!1,scheme_name:e.get("scheme_name")||!1,provider:e.get("provider")||!1,resetCredentials:e.get("resetCredentials")||!1}},t,a);i.a.render(s.a.createElement(Xe,{config:n}),document.getElementById("root"))})).fail((function(e){i.a.render(s.a.createElement(Xe,{config:!1}),document.getElementById("root"))}))})).fail((function(e){i.a.render(s.a.createElement(Ze.a,null),document.getElementById("root"))}))}()}))}catch(e){$("#root").html('<div class="alert alert-danger" role="alert"><i class="fas fa-exclamation-triangle"></i><span class="btn-icon-right">You must use a browser compatible with Glewlwyd SSO</span></div>')}},3:function(e,t,a){"use strict";var n=a(2);function s(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.GlewlwydApiPrefix="",this.GlewlwydApiPrefixSub=""}return function(e,t,a){t&&s(e.prototype,t)}(e,[{key:"setConfig",value:function(e){this.GlewlwydApiPrefix=e}},{key:"getConfig",value:function(e){return this.GlewlwydApiPrefix}},{key:"setConfigSub",value:function(e){this.GlewlwydApiPrefixSub=e}},{key:"getConfigSub",value:function(e){return this.GlewlwydApiPrefixSub}},{key:"request",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return a&&"GET"!==t?$.ajax({method:t,url:e,data:JSON.stringify(a),contentType:"application/json; charset=utf-8"}):$.ajax({method:t,url:e})}},{key:"glewlwydRequest",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.request(this.GlewlwydApiPrefix+e,t,a).fail((function(e){s&&401===e.status&&n.a.sendMessage("App",{type:"loggedIn",message:!1})}))}},{key:"glewlwydRequestSub",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.request(this.GlewlwydApiPrefixSub+e,t,a)}}]),e}());t.a=r},4:function(e,t,a){"use strict";var n=a(0),s=a.n(n),r=a(2);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=u(e);if(t){var s=u(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?c(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={message:[],counter:0,loggedIn:e.loggedIn},r.a.subscribe("Notification",(function(e){if(e.type){var t=n.state.message;t.push({type:e.type,message:e.message,id:n.state.counter}),n.setState({message:t,counter:n.state.counter+1},(function(){n.timeoutClose(n.state.counter-1)}))}})),n.close=n.close.bind(c(n)),n.timeoutClose=n.timeoutClose.bind(c(n)),n}return function(e,t,a){t&&o(e.prototype,t)}(a,[{key:"componentWillReceiveProps",value:function(e){this.setState({loggedIn:e.loggedIn})}},{key:"timeoutClose",value:function(e){var t=this;setTimeout((function(){t.close(e)}),5e3)}},{key:"close",value:function(e){var t=this,a=this.state.message;a.forEach((function(n,s){n.id===e&&(a.splice(s,1),t.setState({message:a}))}))}},{key:"render",value:function(){var e=this,t=[];return this.state.loggedIn&&this.state.message.forEach((function(a,n){var r;r="success"===a.type?s.a.createElement("strong",{className:"mr-auto"},s.a.createElement("span",{className:"badge badge-success btn-icon"},s.a.createElement("i",{className:"fas fa-check-circle"})),"Glewlwyd"):"danger"===a.type?s.a.createElement("strong",{className:"mr-auto"},s.a.createElement("span",{className:"badge badge-danger btn-icon"},s.a.createElement("i",{className:"fas fa-exclamation-circle"})),"Glewlwyd"):"warning"===a.type?s.a.createElement("strong",{className:"mr-auto"},s.a.createElement("span",{className:"badge badge-warning btn-icon"},s.a.createElement("i",{className:"fas fa-exclamation-circle"})),"Glewlwyd"):s.a.createElement("strong",{className:"mr-auto"},s.a.createElement("span",{className:"badge badge-info btn-icon"},s.a.createElement("i",{className:"fas fa-info-circle"})),"Glewlwyd"),t.push(s.a.createElement("div",{className:"toast-container",style:{top:95+90*n,right:5},key:n},s.a.createElement("div",{className:"toast glwd-toast",role:"alert","aria-live":"assertive","aria-atomic":"true"},s.a.createElement("div",{className:"toast-header"},r,s.a.createElement("button",{type:"button",className:"ml-2 mb-1 close","data-dismiss":"toast","aria-label":"Close",onClick:function(){return e.close(a.id)}},s.a.createElement("span",{"aria-hidden":"true"},"Ã—"))),s.a.createElement("div",{className:"toast-body"},a.message))))})),s.a.createElement("div",null,t)}}]),a}();t.a=m},8:function(e,t,a){"use strict";var n=a(0),s=a.n(n),r=a(1);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=c(e);if(t){var s=c(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,a)}}(a);function a(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),t.call(this,e)}return function(e,t,a){t&&o(e.prototype,t)}(a,[{key:"render",value:function(){return s.a.createElement("div",{className:"alert alert-danger perfect-centering",role:"alert"},r.a.t("error-config"))}}]),a}();t.a=u},9:function(e,t,a){"use strict";var n=a(0),s=a.n(n),r=a(1);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=u(e);if(t){var s=u(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?c(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={title:e.title,label:e.label,message:e.message},n.closeModal=n.closeModal.bind(c(n)),n}return function(e,t,a){t&&o(e.prototype,t)}(a,[{key:"componentWillReceiveProps",value:function(e){this.setState({title:e.title,label:e.label,message:e.message})}},{key:"closeModal",value:function(e,t){$("#messageModal").modal("hide")}},{key:"render",value:function(){var e,t=this,a=[];return this.state.label&&(e=s.a.createElement("h5",null,this.state.label)),this.state.message&&this.state.message.forEach((function(e,t){a.push(s.a.createElement("li",{key:t},e))})),s.a.createElement("div",{className:"modal fade on-top",id:"messageModal",tabIndex:"-1",role:"dialog","aria-labelledby":"messageModalLabel","aria-hidden":"true"},s.a.createElement("div",{className:"modal-dialog",role:"document"},s.a.createElement("div",{className:"modal-content"},s.a.createElement("div",{className:"modal-header"},s.a.createElement("h5",{className:"modal-title",id:"messageModalLabel"},this.state.title),s.a.createElement("button",{type:"button",className:"close","aria-label":r.a.t("modal.close"),onClick:function(e){return t.closeModal(e,!1)}},s.a.createElement("span",{"aria-hidden":"true"},"Ã—"))),s.a.createElement("div",{className:"modal-body"},e,s.a.createElement("ul",null,a)),s.a.createElement("div",{className:"modal-footer"},s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(e){return t.closeModal(e,!1)}},r.a.t("modal.close"))))))}}]),a}();t.a=m}})}));