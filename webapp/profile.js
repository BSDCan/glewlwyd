!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var a=t();for(var n in a)("object"==typeof exports?exports:e)[n]=a[n]}}(window,(function(){return function(e){function t(t){for(var n,i,o=t[0],l=t[1],c=t[2],m=0,f=[];m<o.length;m++)i=o[m],Object.prototype.hasOwnProperty.call(s,i)&&s[i]&&f.push(s[i][0]),s[i]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);for(u&&u(t);f.length;)f.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],n=!0,o=1;o<a.length;o++){var l=a[o];0!==s[l]&&(n=!1)}n&&(r.splice(t--,1),e=i(i.s=a[0]))}return e}var n={},s={4:0},r=[];function i(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=n,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;return r.push([23,0,5]),a()}({12:function(e,t,a){"use strict";var n=a(0),s=a.n(n),r=a(1);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var m=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(m,n.Component);var e,t,a=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n,s,r=u(e);return n=this,!(s=t?(a=u(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments))||"object"!==i(s)&&"function"!=typeof s?c(n):s}}(m);function m(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m),(t=a.call(this,e)).state={title:e.title,message:e.message,cb:e.callback},t.closeModal=t.closeModal.bind(c(t)),t}return e=m,(t=[{key:"componentWillReceiveProps",value:function(e){this.setState({title:e.title,message:e.message,cb:e.callback})}},{key:"closeModal",value:function(e,t){this.state.cb&&this.state.cb(t)}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"modal fade on-top",id:"confirmModal",tabIndex:"-1",role:"dialog","aria-labelledby":"confirmModalLabel","aria-hidden":"true"},s.a.createElement("div",{className:"modal-dialog",role:"document"},s.a.createElement("div",{className:"modal-content"},s.a.createElement("div",{className:"modal-header"},s.a.createElement("h5",{className:"modal-title",id:"confirmModalLabel"},this.state.title),s.a.createElement("button",{type:"button",className:"close","aria-label":r.a.t("modal.close"),onClick:function(t){return e.closeModal(t,!1)}},s.a.createElement("span",{"aria-hidden":"true"},"×"))),s.a.createElement("div",{className:"modal-body"},this.state.message),s.a.createElement("div",{className:"modal-footer"},s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return e.closeModal(t,!1)}},r.a.t("modal.close")),s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(t){return e.closeModal(t,!0)}},r.a.t("modal.ok"))))))}}])&&o(e.prototype,t),m}();t.a=m},13:function(e,t,a){"use strict";var n=a(0),s=a.n(n),r=a(1);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var m=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(m,n.Component);var e,t,a=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n,s,r=u(e);return n=this,!(s=t?(a=u(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments))||"object"!==i(s)&&"function"!=typeof s?c(n):s}}(m);function m(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m),(t=a.call(this,e)).state={title:e.title,label:e.label,message:e.message},t.closeModal=t.closeModal.bind(c(t)),t}return e=m,(t=[{key:"componentWillReceiveProps",value:function(e){this.setState({title:e.title,label:e.label,message:e.message})}},{key:"closeModal",value:function(){$("#messageModal").modal("hide")}},{key:"render",value:function(){var e,t=this,a=[];return this.state.label&&(e=s.a.createElement("h5",null,this.state.label)),this.state.message&&this.state.message.forEach((function(e,t){a.push(s.a.createElement("li",{key:t},e))})),s.a.createElement("div",{className:"modal fade on-top",id:"messageModal",tabIndex:"-1",role:"dialog","aria-labelledby":"messageModalLabel","aria-hidden":"true"},s.a.createElement("div",{className:"modal-dialog",role:"document"},s.a.createElement("div",{className:"modal-content"},s.a.createElement("div",{className:"modal-header"},s.a.createElement("h5",{className:"modal-title",id:"messageModalLabel"},this.state.title),s.a.createElement("button",{type:"button",className:"close","aria-label":r.a.t("modal.close"),onClick:function(e){return t.closeModal(e,!1)}},s.a.createElement("span",{"aria-hidden":"true"},"×"))),s.a.createElement("div",{className:"modal-body"},e,s.a.createElement("ul",null,a)),s.a.createElement("div",{className:"modal-footer"},s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(e){return t.closeModal(e,!1)}},r.a.t("modal.close"))))))}}])&&o(e.prototype,t),m}();t.a=m},2:function(e,t,a){"use strict";function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.subscriberList={}}var t,a;return t=e,(a=[{key:"subscribe",value:function(e,t){this.subscriberList[e]=t}},{key:"sendMessage",value:function(e,t){if(Array.isArray(e)||(e=[e]),"broadcast"===e[0])this.subscriberList.forEach((function(e,a){e({type:"broadcast",message:t})}));else for(var a in this.subscriberList)0<=e.indexOf(a)&&this.subscriberList[a](t)}}])&&n(t.prototype,a),e}());t.a=s},23:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(5),i=a.n(r),o=a(1),l=a(10),c=a(11),u=a(3),m=a(2),f=a(4);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function g(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(r,n.Component);var e,t,a=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n,s,r=y(e);return n=this,!(s=t?(a=y(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments))||"object"!==d(s)&&"function"!=typeof s?b(n):s}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=a.call(this,e)).state={config:e.config,curNav:"profile",loggedIn:e.loggedIn,schemeList:e.schemeList,profileList:e.profileList,dataHighlight:e.dataHighlight,schemeHighlight:e.schemeHighlight,registering:e.registering},t.navigate=t.navigate.bind(b(t)),t.toggleLogin=t.toggleLogin.bind(b(t)),t.changeLang=t.changeLang.bind(b(t)),t.changeProfile=t.changeProfile.bind(b(t)),t.gotoManageUsers=t.gotoManageUsers.bind(b(t)),m.a.subscribe("Nav",(function(e){"profile"===e.type?t.navigate(!1,"profile",null):t.navigate(!1,e.page,e.type)})),t}return e=r,(t=[{key:"componentWillReceiveProps",value:function(e){this.setState({loggedIn:e.loggedIn,schemeList:e.schemeList,profileList:e.profileList,dataHighlight:e.dataHighlight,schemeHighlight:e.schemeHighlight,registering:e.registering})}},{key:"navigate",value:function(e,t,a){e&&e.preventDefault(),m.a.sendMessage("App",{type:"nav",page:t,module:a}),this.setState({curNav:t})}},{key:"toggleLogin",value:function(){var e;this.state.loggedIn?u.a.glewlwydRequest("/auth/?username="+encodeURIComponent(this.state.profileList[0].username),"DELETE").then((function(){m.a.sendMessage("Notification",{type:"info",message:o.a.t("login.success-delete-session")}),m.a.sendMessage("App",{type:"loggedIn",loggedIn:!1})})).fail((function(e){401!==e.status&&m.a.sendMessage("Notification",{type:"danger",message:o.a.t("login.error-delete-session")}),m.a.sendMessage("App",{type:"loggedIn",loggedIn:!1})})):(e=!1,this.state.config.sessionSchemes.forEach((function(t){t.scheme_default&&t.scheme_default.forEach((function(a){"profile"===a&&(e=t.scheme_name)}))})),document.location.href=this.state.config.LoginUrl+"?callback_url="+encodeURIComponent([location.protocol,"//",location.host,location.pathname].join(""))+"&scope="+encodeURIComponent(this.state.config.profile_scope)+(e?"&scheme="+encodeURIComponent(e):""))}},{key:"changeLang",value:function(e,t){var a=this;o.a.changeLanguage(t).then((function(){a.setState({lang:t}),m.a.sendMessage("App",{type:"lang"})}))}},{key:"changeProfile",value:function(e,t){var a;t?u.a.glewlwydRequest("/auth/","POST",{username:t.username}).then((function(){m.a.sendMessage("App",{type:"profile"})})).fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("login.error-login")})})):(a=!1,this.state.config.sessionSchemes.forEach((function(e){e.scheme_default&&e.scheme_default.forEach((function(t){"admin"===t&&(a=e.scheme_name)}))})),document.location.href=this.state.config.LoginUrl+"?callback_url="+encodeURIComponent([location.protocol,"//",location.host,location.pathname].join(""))+"&scope="+encodeURIComponent(this.state.config.profile_scope)+(a?"&scheme="+encodeURIComponent(a):"")+"&prompt=login")}},{key:"gotoManageUsers",value:function(e){e.preventDefault(),document.location.href=this.state.config.LoginUrl+"?callback_url="+encodeURIComponent([location.protocol,"//",location.host,location.pathname].join(""))+"&scope="+encodeURIComponent(this.state.config.profile_scope)+"&prompt=select_account"}},{key:"userHasScope",value:function(e,t){var a=!1;return t&&e.scope&&e.scope.length&&t.split(" ").forEach((function(t){-1<e.scope.indexOf(t)&&(a=!0)})),a}},{key:"render",value:function(){var e,t,a,n,r,i,l,c,u=this,m=[],f=[],d=[],g="",h="",b=!0;return this.state.config.lang.forEach((function(e,t){e===o.a.language?m.push(s.a.createElement("a",{className:"dropdown-item active",href:"#",key:t},e)):m.push(s.a.createElement("a",{className:"dropdown-item",href:"#",onClick:function(t){return u.changeLang(t,e)},key:t},e))})),this.state.schemeList.forEach((function(e,t){var a="";u.state.schemeHighlight[e.name]&&(b=!1,a=" required-field"),"retype-password"!==e.module&&"email"!==e.module&&f.push(s.a.createElement("li",{className:"nav-item"+(u.state.curNav===e.name?" active":""),key:t},s.a.createElement("a",{className:"nav-link"+a,href:"#","data-toggle":"collapse","data-target":".navbar-collapse.show",onClick:function(t){return u.navigate(t,e.name,e.module)}},e.display_name||e.name)))})),this.state.config.params.delegate||this.state.config.params.register||this.state.config.params.resetCredentials||!this.state.loggedIn||(a=s.a.createElement("li",{className:"nav-item"+("password"===this.state.curNav?" active":"")},s.a.createElement("a",{className:"nav-link",href:"#","data-toggle":"collapse","data-target":".navbar-collapse.show",onClick:function(e){return u.navigate(e,"password",null)}},o.a.t("profile.menu-password")))),!this.state.profileList||this.state.config.params.register||this.state.config.params.resetCredentials||(n=s.a.createElement("li",{className:"nav-item"+("session"===this.state.curNav?" active":"")},s.a.createElement("a",{className:"nav-link",href:"#","data-toggle":"collapse","data-target":".navbar-collapse.show",onClick:function(e){return u.navigate(e,"session",null)}},o.a.t("profile.menu-session")))),this.state.profileList&&this.state.profileList.forEach((function(e,t){u.userHasScope(e,u.state.config.profile_scope)?d.push(s.a.createElement("a",{className:"dropdown-item"+(t?"":" active"),href:"#","data-toggle":"collapse","data-target":".navbar-collapse.show",onClick:function(t){return u.changeProfile(t,e)},key:t},e.name||e.username)):d.push(s.a.createElement("a",{className:"dropdown-item glwd-nav-user-unavailable"+(t?"":" active"),key:t,href:"#",disabled:!0},e.name||e.username))})),(this.state.loggedIn||this.state.config.params.register&&this.state.registering)&&(r=s.a.createElement("li",{className:"nav-item"+("profile"===this.state.curNav?" active":"")},s.a.createElement("a",{className:"nav-link"+g,href:"#","data-toggle":"collapse","data-target":".navbar-collapse.show",onClick:function(e){return u.navigate(e,"profile",null)}},o.a.t("profile.menu-user")))),this.state.config.params.delegate||(d.push(s.a.createElement("div",{className:"dropdown-divider",key:d.length})),d.push(s.a.createElement("a",{className:"dropdown-item",href:"#",onClick:function(e){return u.changeProfile(e,null)},key:d.length},o.a.t("profile.menu-session-new"))),d.push(s.a.createElement("a",{className:"dropdown-item",href:"#",onClick:function(e){return u.gotoManageUsers(e)},key:d.length},o.a.t("login.manage-users")))),!this.state.config.params.register&&!this.state.config.params.resetCredentials&&this.state.profileList&&this.state.profileList[0]?(l=this.state.config.profilePicture&&this.state.profileList[0][this.state.config.profilePicture.property]?(i=this.state.profileList[0][this.state.config.profilePicture.property],Array.isArray(i)&&(i=i[0]),s.a.createElement("div",{className:"glwd-nav-picture-div"},s.a.createElement("img",{className:"img-medium glwd-nav-picture-image",src:"data:image/*;base64,"+i}),this.state.profileList[0].username)):s.a.createElement("div",{className:"glwd-nav-picture-div"},s.a.createElement("img",{className:"img-medium glwd-nav-picture-spacer",src:"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="})," ",s.a.createElement("i",{className:"fas fa-user"}," "),this.state.profileList[0].username),c=s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{className:"btn btn-secondary dropdown-toggle",type:"button",id:"dropdownProfile","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},s.a.createElement("div",{className:"glwd-nav-picture-container"},l)),s.a.createElement("div",{className:"dropdown-menu","aria-labelledby":"dropdownProfile"},d)),this.state.config.params.delegate||(t=s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:this.toggleLogin,title:o.a.t(this.state.loggedIn?"title-logout":"title-login")},this.state.loggedIn?s.a.createElement("i",{className:"fas fa-sign-out-alt btn-icon"}):s.a.createElement("i",{className:"fas fa-sign-in-alt btn-icon"})))):this.state.config.params.register||this.state.config.params.delegate||this.state.config.params.resetCredentials?this.state.dataHighlight&&(b=!1,g=" required-field"):t=s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:this.toggleLogin,title:o.a.t(this.state.loggedIn?"title-logout":"title-login")},this.state.loggedIn?s.a.createElement("i",{className:"fas fa-sign-out-alt btn-icon"}):s.a.createElement("i",{className:"fas fa-sign-in-alt btn-icon"})),this.state.registering&&(h=b?s.a.createElement("li",{className:"nav-item"},s.a.createElement("a",{className:"btn btn-success",href:"#","data-toggle":"collapse","data-target":".navbar-collapse.show",onClick:function(e){return u.navigate(e,"profile",null)}},o.a.t("profile.register-profile-nav-complete"))):s.a.createElement("li",{className:"nav-item"},s.a.createElement("a",{className:"btn btn-danger",href:"#","data-toggle":"collapse","data-target":".navbar-collapse.show",onClick:function(e){return u.navigate(e,"profile",null)}},o.a.t("profile.register-profile-nav-incomplete")))),s.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light"},s.a.createElement("a",{className:"navbar-brand",href:"#","data-toggle":"collapse"},s.a.createElement("img",{className:"mr-3",src:"img/logo-profile.png",alt:"logo"}),o.a.t("profile.menu-title")),s.a.createElement("button",(p(e={className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":".navbar-collapse.show"},"data-target","#navbarSupportedContent"),p(e,"aria-controls","navbarSupportedContent"),p(e,"aria-expanded","false"),p(e,"aria-label","Toggle navigation"),e),s.a.createElement("span",{className:"navbar-toggler-icon"})),s.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent"},s.a.createElement("ul",{className:"navbar-nav mr-auto"},r,n,a,f,h),s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{className:"btn btn-secondary dropdown-toggle",type:"button",id:"dropdownLang","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},s.a.createElement("i",{className:"fas fa-language"})),s.a.createElement("div",{className:"dropdown-menu","aria-labelledby":"dropdownLang"},m)),c,t)))}}])&&g(e.prototype,t),r}();function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var P=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(r,n.Component);var e,t,a=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n,s,r=k(e);return n=this,!(s=t?(a=k(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments))||"object"!==E(s)&&"function"!=typeof s?C(n):s}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=a.call(this,e)).state={config:e.config,pattern:e.pattern,profile:e.profile,profileUpdate:e.profileUpdate,loggedIn:e.loggedIn,listAddValue:t.initListAdd(e.pattern),listEltConfirm:t.initListConfirm(e.pattern),updateEmail:e.updateEmail,listError:{}},t.editElt=t.editElt.bind(C(t)),t.createData=t.createData.bind(C(t)),t.initListAdd=t.initListAdd.bind(C(t)),t.initListConfirm=t.initListConfirm.bind(C(t)),t.deleteListElt=t.deleteListElt.bind(C(t)),t.changeElt=t.changeElt.bind(C(t)),t.toggleBooleanElt=t.toggleBooleanElt.bind(C(t)),t.changeListAddElt=t.changeListAddElt.bind(C(t)),t.AddListElt=t.AddListElt.bind(C(t)),t.changeEltConfirm=t.changeEltConfirm.bind(C(t)),t.changeTextArea=t.changeTextArea.bind(C(t)),t.uploadFile=t.uploadFile.bind(C(t)),t.uploadImage=t.uploadImage.bind(C(t)),t.removeImage=t.removeImage.bind(C(t)),t.editElt=t.editElt.bind(C(t)),t.saveProfile=t.saveProfile.bind(C(t)),t.confirmDeleteProfile=t.confirmDeleteProfile.bind(C(t)),t}return e=r,(t=[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({config:e.config,pattern:e.pattern,profile:e.profile,profileUpdate:e.profileUpdate,loggedIn:e.loggedIn,listAddValue:this.initListAdd(e.pattern),listEltConfirm:this.initListConfirm(e.pattern),updateEmail:e.updateEmail,listError:{}},(function(){t.state.loggedIn||t.setState({pattern:[],profile:[]})}))}},{key:"createData",value:function(){var e={};this.state.pattern.forEach((function(t,a){t.list?e[t.name]=[]:t.defaultValue?e[t.name]=t.defaultValue:e[t.name]=""})),this.setState({data:e})}},{key:"initListAdd",value:function(e){var t={};return e&&e.forEach((function(e){e.list&&(t[e.name]="")})),t}},{key:"initListConfirm",value:function(e){var t={};return e&&e.forEach((function(e){e.confirm&&(t[e.name]="")})),t}},{key:"deleteListElt",value:function(e,t,a){var n=this.state.profile;n[t]&&(n[t].splice(a,1),this.setState({profile:n}))}},{key:"changeElt",value:function(e,t){var a=this.state.profile;a[t]=e.target.value,this.setState({profile:a})}},{key:"toggleBooleanElt",value:function(e,t){var a=this.state.profile;a[t]=!a[t],this.setState({profile:a})}},{key:"changeListAddElt",value:function(e,t){var a=this.state.listAddValue;a[t]=e.target.value,this.setState({listAddValue:a})}},{key:"AddListElt",value:function(e,t,a){var n,s,r=2<arguments.length&&void 0!==a&&a;e.preventDefault(),r?((n=this.state.profile)[t]||(n[t]=[]),n[t].push(r),this.setState({profile:n})):this.state.listAddValue[t]&&(n=this.state.profile,s=this.state.listAddValue,n[t].push(this.state.listAddValue[t]),this.state.listAddValue[t]="",this.setState({profile:n,listAddValue:s}))}},{key:"changeEltConfirm",value:function(e,t){var a=this.state.listEltConfirm;a[t]=e.target.value,this.setState({listEltConfirm:a})}},{key:"changeTextArea",value:function(e,t,a){var n=this.state.profile;n[t]=a?e.target.value.split("\n"):e.target.value,this.setState({profile:n})}},{key:"uploadFile",value:function(e,t,a){var n=this,s=this.state.profile,r=e.target.files[0],i=new FileReader;i.onload=function(e){a?(s[t]||(s[t]=[]),s[t].push(r.name+"/"+btoa(e.target.result))):s[t]=r.name+"/"+btoa(e.target.result),n.setState({profile:s})},i.readAsText(r)}},{key:"uploadImage",value:function(e,t,a){var n=this,s=this.state.profile,r=e.target.files[0],i=new FileReader;i.onload=function(e){a?(s[t]||(s[t]=[]),s[t].push(btoa(e.target.result))):s[t]=btoa(e.target.result),n.setState({profile:s})},i.readAsBinaryString(r)}},{key:"removeImage",value:function(e,t,a){var n=this.state.profile;-1<a?n[t].splice(a,1):delete n[t],this.setState({profile:n})}},{key:"saveProfile",value:function(){u.a.glewlwydRequest("/profile","PUT",this.state.profile).then((function(e){m.a.sendMessage("Notification",{type:"success",message:o.a.t("profile.save-profile-success")})})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.save-profile-error")})}))}},{key:"deleteProfile",value:function(){m.a.sendMessage("App",{type:"confirm",title:o.a.t("profile.delete-profile-title"),message:o.a.t("profile.delete-profile-message"),callback:this.confirmDeleteProfile})}},{key:"confirmDeleteProfile",value:function(e){e&&u.a.glewlwydRequest("/profile","DELETE",this.state.profile).then((function(e){m.a.sendMessage("Notification",{type:"success",message:o.a.t("profile.delete-profile-success")}),m.a.sendMessage("App",{type:"profile"})})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.delete-profile-error")})})),m.a.sendMessage("App",{type:"closeConfirm"})}},{key:"updateEmailModal",value:function(e){m.a.sendMessage("App",{type:"updateEmail",module:e})}},{key:"editElt",value:function(e,t,a){var n,r,i,l,c,u,m,f=this,d=[],p=!1;return(void 0!==t||"password"===e.type||e.forceShow)&&e["profile-read"]&&(i=r="",this.state.listError[e.name]&&(r=" is-invalid",i=s.a.createElement("span",{className:"error-input"},o.a.t(this.state.listError[e.name]))),n=s.a.createElement("label",{htmlFor:"modal-edit-"+e.name},o.a.t(e.label)),e.list?(t=t||[],e.listElements?(l=[],e.listElements.forEach((function(t,a){l.push(s.a.createElement("a",{className:"dropdown-item",key:a,href:"#",onClick:function(a){return f.AddListElt(a,e.name,t)}},t))})),m=s.a.createElement("div",{className:"dropdown"},s.a.createElement("button",{className:"btn btn-secondary btn-sm dropdown-toggle",type:"button",id:"modal-edit-"+e.name,"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},s.a.createElement("i",{className:"fas fa-plus"})),s.a.createElement("div",{className:"dropdown-menu","aria-labelledby":"modal-edit-"+e.name},l))):"textarea"===e.type?m=s.a.createElement("textarea",{className:"form-control"+r,onChange:function(t){return f.changeTextArea(t,e.name,!0)},value:t.join("\n"),placeholder:e.placeholder?o.a.t(e.placeholder):""}):"file"===e.type?m=e["profile-write"]||this.state.add?s.a.createElement("input",{type:"file",className:"form-control"+r,onChange:function(t){return f.uploadFile(t,e.name,!0)}}):s.a.createElement("input",{type:"file",disabled:!0,className:"form-control"}):e.type&&e.type.startsWith("image")?(c=[],t.forEach((function(t,a){c.push(s.a.createElement("a",{href:"#",onClick:function(t){return f.removeImage(t,e.name,a)},title:o.a.t("remove")},s.a.createElement("img",{key:a,className:"btn-icon-right img-thumb",src:"data:"+e.type+";base64,"+t,alt:e.name+"-"+a}),s.a.createElement("span",{className:"badge badge-secondary align-top"},s.a.createElement("i",{className:"fas fa-trash"}))))})),m=e.edit||this.state.add?s.a.createElement("div",null,s.a.createElement("div",{className:"custom-file"},s.a.createElement("input",{type:"file",className:"custom-file-input"+r,accept:"image/*",onChange:function(t){return f.uploadImage(t,e.name,!0)},id:"modal-image-"+e.name}),s.a.createElement("label",{className:"custom-file-label",htmlFor:"modal-image-"+e.name},o.a.t("browse"))),c):(c=[],t.forEach((function(t,a){c.push(s.a.createElement("img",{key:a,className:"btn-icon-right img-thumb",src:"data:"+e.type+";base64,"+t,alt:e.name+"-"+a}))})),c)):e["profile-write"]&&(m=s.a.createElement("div",{className:"input-group"},s.a.createElement("input",{type:"text",className:"form-control"+r,id:"modal-edit-"+e.name,placeholder:e.placeholder?o.a.t(e.placeholder):"",onChange:function(t){return f.changeListAddElt(t,e.name)},value:this.state.listAddValue[e.name]}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("button",{className:"btn btn-outline-secondary",type:"button",onClick:function(t){return f.AddListElt(t,e.name)},title:o.a.t("modal.list-add-title")},s.a.createElement("i",{className:"fas fa-plus"}))))),t.forEach((function(t,a){var n=t;"file"===e.type&&(n=t.substring(0,t.indexOf("/"))),(!e.type||"textarea"===e.type||e.type.startsWith("image"))&&e.type||(!0===e["profile-write"]||f.state.add?d.push(s.a.createElement("a",{href:"#",onClick:function(t){return f.deleteListElt(t,e.name,a)},key:a},s.a.createElement("span",{className:"badge badge-primary btn-icon-right"},n,s.a.createElement("span",{className:"badge badge-light btn-icon-right"},s.a.createElement("i",{className:"fas fa-times"}))))):d.push(s.a.createElement("span",{className:"badge badge-primary btn-icon-right",key:a},n)))}))):"boolean"===e.type?p=!0===e["profile-write"]||this.state.add?s.a.createElement("div",{className:"form-group form-check"},s.a.createElement("input",{type:"checkbox",className:"form-check-input"+r,id:"modal-edit-"+e.name,onChange:function(t){return f.toggleBooleanElt(t,e.name)},checked:t}),s.a.createElement("label",{className:"form-check-label",htmlFor:"modal-edit-"+e.name},o.a.t(e.label))):s.a.createElement("div",{className:"form-group form-check"},s.a.createElement("input",{disabled:!0,type:"checkbox",className:"form-check-input",id:"modal-edit-"+e.name,checked:t}),s.a.createElement("label",{className:"form-check-label",htmlFor:"modal-edit-"+e.name},o.a.t(e.label))):m="textarea"===e.type?!0===e["profile-write"]||this.state.add?s.a.createElement("textarea",{className:"form-control"+r,onChange:function(t){return f.changeTextArea(t,e.name,!1)},value:t||"",placeholder:e.placeholder?o.a.t(e.placeholder):""}):s.a.createElement("textarea",{className:"form-control",disabled:!0,value:t||""}):"file"===e.type?(t&&d.push(s.a.createElement("a",{href:"#",key:0,onClick:function(t){return f.deleteFile(t,e.name)}},s.a.createElement("span",{className:"badge badge-primary"},t.substring(0,t.indexOf("/")),s.a.createElement("span",{className:"badge badge-light btn-icon-right"},s.a.createElement("i",{className:"fas fa-times"}))))),e["profile-write"]||this.state.add?s.a.createElement("input",{type:"file",className:"form-control"+r,onChange:function(t){return f.uploadFile(t,e.name)}}):s.a.createElement("input",{type:"file",disabled:!0,className:"form-control"})):e.type&&e.type.startsWith("image")?(t&&(c=s.a.createElement("a",{href:"#",onClick:function(t){return f.removeImage(t,e.name,-1)},title:o.a.t("remove")},s.a.createElement("img",{className:"btn-icon-right img-thumb",src:"data:"+e.type+";base64,"+t,alt:e.name}),s.a.createElement("span",{className:"badge badge-secondary align-top"},s.a.createElement("i",{className:"fas fa-trash"})))),e.edit||this.state.add?s.a.createElement("div",null,s.a.createElement("div",{className:"custom-file"},s.a.createElement("input",{type:"file",accept:"image/*",className:"custom-file-input"+r,onChange:function(t){return f.uploadImage(t,e.name)},id:"modal-image-"+e.name}),s.a.createElement("label",{className:"custom-file-label",htmlFor:"modal-image-"+e.name},o.a.t("browse"))),c):s.a.createElement("img",{className:"btn-icon-right img-thumb",src:"data:"+e.type+";base64,"+t,alt:e.name})):!0===e["profile-write"]||this.state.add?"password"===e.type?s.a.createElement("div",null,s.a.createElement("input",{type:"password",className:"form-control"+r,id:"modal-edit-"+e.name,placeholder:e.placeholder?o.a.t(e.placeholder):"",onChange:function(t){return f.changeElt(t,e.name)},value:t||"",autoComplete:"new-password"}),s.a.createElement("input",{type:"password",className:"form-control"+r,id:"modal-edit-confirm"+e.name,placeholder:o.a.t(e.placeholderConfirm),value:this.state.listEltConfirm[e.name]||"",onChange:function(t){return f.changeEltConfirm(t,e.name)},autoComplete:"new-password"})):s.a.createElement("input",{type:e.type||"text",className:"form-control"+r,id:"modal-edit-"+e.name,placeholder:e.placeholder?o.a.t(e.placeholder):"",value:t,onChange:function(t){return f.changeElt(t,e.name)}}):"email"===e.name?(u=[],this.state.updateEmail.forEach((function(e,t){u.push(s.a.createElement("button",{key:t,className:"btn btn-outline-secondary",type:"button",onClick:function(){return f.updateEmailModal(e)},title:o.a.t("profile.update-email-modal-title")},s.a.createElement("i",{className:"fas fa-edit"})))})),s.a.createElement("div",{className:"input-group"},s.a.createElement("input",{disabled:!0,type:"text",className:"form-control"+r,id:"modal-edit-"+e.name,placeholder:e.placeholder?o.a.t(e.placeholder):"",value:t}),s.a.createElement("div",{className:"input-group-append"},u))):s.a.createElement("input",{disabled:!0,type:e.type||"text",className:"form-control"+r,id:"modal-edit-"+e.name,placeholder:e.placeholder?o.a.t(e.placeholder):"",value:t})),p||s.a.createElement("div",{className:"form-group",key:a},n,m,s.a.createElement("div",null,d),i)}},{key:"render",value:function(){var e,t=this,a=[];return this.state.pattern&&this.state.profile&&this.state.pattern.forEach((function(e,n){var s=t.editElt(e,t.state.profile[e.name],n);s&&a.push(s)})),"no"!==this.state.config.delete_profile&&(e=s.a.createElement("button",{type:"button",className:"btn btn-danger btn-icon",onClick:function(e){return t.deleteProfile(e)},disabled:!this.state.profile||!this.state.profileUpdate},o.a.t("profile.delete"))),this.state.loggedIn?s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.hello",{name:this.state.profile.name||this.state.profile.username})))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("form",{className:"needs-validation",noValidate:!0},a))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-6"},e),s.a.createElement("div",{className:"col-md-6 text-right"},s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.saveProfile(e)},disabled:!this.state.profile||!this.state.profileUpdate},o.a.t("profile.save"))))):s.a.createElement("div",null)}}])&&w(e.prototype,t),r}();function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var M=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(r,n.Component);var e,t,a=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n,s,r=R(e);return n=this,!(s=t?(a=R(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments))||"object"!==S(s)&&"function"!=typeof s?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(n):s}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=a.call(this,e)).state={profile:e.profile},t}return e=r,(t=[{key:"componentWillReceiveProps",value:function(e){this.setState({profile:e.profile})}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.hello-delegate",{name:this.state.profile.name||this.state.profile.username})))))}}])&&_(e.prototype,t),r}();function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var I=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(r,n.Component);var e,t,a=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n,s,r=A(e);return n=this,!(s=t?(a=A(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments))||"object"!==x(s)&&"function"!=typeof s?T(n):s}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=a.call(this,e)).state={config:e.config,profile:e.profile,status:e.status,password:"",passwordConfirm:"",invalidPassword:!1,password_set:!1,modifyPassword:!0},t.updatePassword=t.updatePassword.bind(T(t)),t}return e=r,(t=[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,profile:e.profile,status:e.status})}},{key:"changePassword",value:function(e){var t=this;this.setState({password:e.target.value},(function(){t.checkPassword()}))}},{key:"changeConfirmPassword",value:function(e){var t=this;this.setState({passwordConfirm:e.target.value},(function(){t.checkPassword()}))}},{key:"checkPassword",value:function(){var e=!1;""===this.state.password&&""===this.state.passwordConfirm||(this.state.password!==this.state.passwordConfirm?e=o.a.t("profile.register-password-error-not-match"):this.state.password.length<(this.state.config.PasswordMinLength||8)&&(e=o.a.t("profile.register-password-ph",{car:this.state.config.PasswordMinLength||8}))),this.setState({invalidPassword:e})}},{key:"navigateProfile",value:function(e){var t=this;e.preventDefault(),u.a.glewlwydRequest("/"+this.state.config.params.resetCredentials+"/reset-credentials/profile/complete","POST").then((function(){var e=!1;t.state.config.sessionSchemes.forEach((function(t){t.scheme_default&&t.scheme_default.forEach((function(a){"admin"===a&&(e=t.scheme_name)}))})),document.location.href=t.state.config.LoginUrl+"?callback_url="+encodeURIComponent([location.protocol,"//",location.host,location.pathname].join(""))+"&scope="+encodeURIComponent(t.state.config.profile_scope)+(e?"&scheme="+encodeURIComponent(e):"")+"&prompt=login"})).fail((function(e){console.log(e),m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"savePassword",value:function(e){var t=this;e.preventDefault(),!this.state.invalidPassword&&this.state.password.length>=(this.state.config.PasswordMinLength||8)&&u.a.glewlwydRequest("/"+this.state.config.params.resetCredentials+"/reset-credentials/profile/password","POST",{password:this.state.password}).then((function(){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.register-password-saved")})})).fail((function(e){400!==e.status&&m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){t.setState({password:"",passwordConfirm:"",modifyPassword:!1,password_set:!0})}))}},{key:"updatePassword",value:function(){this.setState({modifyPassword:!0,password_set:!1})}},{key:"render",value:function(){var e=this,t=this.state.config.params.callback_url?s.a.createElement("a",{className:"btn btn-success",href:decodeURI(this.state.config.params.callback_url)},o.a.t("callback.button-login")):this.state.profile.callback_url?s.a.createElement("a",{className:"btn btn-success",href:decodeURI(this.state.profile.callback_url)},o.a.t("callback.button-login")):s.a.createElement("a",{className:"btn btn-success",href:"#",onClick:function(t){return e.navigateProfile(t)}},o.a.t("callback.button-profile"));return 1===this.state.status?s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.reset-credentials-hello",{name:this.state.profile.name||this.state.profile.username})))),s.a.createElement("hr",null),s.a.createElement("label",{htmlFor:"password-input"},o.a.t("profile.register-password-label"),s.a.createElement("button",{type:"button",disabled:!this.state.password_set,className:"btn btn-outline-secondary btn-sm btn-icon-right",onClick:this.updatePassword},s.a.createElement("i",{className:"fas fa-edit"}))),s.a.createElement("div",{className:"input-group"},s.a.createElement("input",{type:"password",className:"form-control",id:"password-input",disabled:this.state.password_set,placeholder:o.a.t("profile.register-password-ph",{car:this.state.config.PasswordMinLength||8}),onChange:function(t){return e.changePassword(t)},value:this.state.password})),s.a.createElement("label",{htmlFor:"confirm-password-input"},o.a.t("profile.register-confirm-password-label")),s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("input",{type:"password",className:"form-control",id:"confirm-password-input",disabled:this.state.password_set,placeholder:o.a.t("profile.register-confirm-password-ph"),onChange:function(t){return e.changeConfirmPassword(t)},value:this.state.passwordConfirm}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("button",{className:"btn btn-secondary btn-icon",type:"button",onClick:function(t){return e.savePassword(t)},disabled:this.state.invalidPassword||!this.state.modifyPassword&&this.state.password_set,title:o.a.t("save")},o.a.t("save")))),s.a.createElement("hr",null),s.a.createElement("h5",null,o.a.t("profile.reset-credentials-complete-message")),t):-1===this.state.status?s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.reset-credentials-error"))))):""}}])&&L(e.prototype,t),r}();function D(e){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function q(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function U(e,t){return(U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function V(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var H=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&U(e,t)}(r,n.Component);var e,t,a=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n,s,r=F(e);return n=this,!(s=t?(a=F(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments))||"object"!==D(s)&&"function"!=typeof s?V(n):s}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=a.call(this,e)).state={config:e.config,registerConfig:e.registerConfig,registerProfile:e.registerProfile,registerSchemes:e.registerSchemes,token:e.token,registerValid:e.registerValid,registerDefaultLang:e.registerDefaultLang,username:"",email:"",code:"",password:"",passwordConfirm:"",usernameValid:!1,usernameInvalid:!1,verificationSent:!1,invalidCode:!1,showCode:!1,timeout:!1,checkingUsername:!1,checkingEmail:!1,invalidMessage:!1,validMessage:!1,invalidEmailMessage:!0,invalidPassword:!1,registerComplete:!1,modifyPassword:!1},t.confirmCancelRegistration=t.confirmCancelRegistration.bind(V(t)),t.updatePassword=t.updatePassword.bind(V(t)),document.title=o.a.t("profile.register-title"),t}return e=r,(t=[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,registerConfig:e.registerConfig,registerProfile:e.registerProfile,token:e.token,registerValid:e.registerValid,registerDefaultLang:e.registerDefaultLang})}},{key:"checkUsername",value:function(){var e=this;this.state.timeout&&clearTimeout(this.state.timeout),this.state.username?u.a.glewlwydRequest("/"+this.state.config.params.register+"/username","POST",{username:this.state.username}).then((function(){e.setState({timeout:!1,usernameValid:!0,usernameInvalid:!1,checkingUsername:!1,invalidMessage:!1,validMessage:!0})})).fail((function(t){400!==t.status&&m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")}),e.setState({timeout:!1,usernameValid:!1,usernameInvalid:!0,checkingUsername:!1,invalidMessage:!0,validMessage:!1})})):this.setState({timeout:!1,usernameValid:!1,usernameInvalid:!1,checkingUsername:!1,invalidMessage:!1,validMessage:!1})}},{key:"checkEmailAsUsername",value:function(){var e=this;this.state.timeout&&clearTimeout(this.state.timeout),this.state.email?u.a.glewlwydRequest("/"+this.state.config.params.register+"/username","POST",{username:this.state.email}).then((function(){e.setState({timeout:!1,usernameValid:!0,usernameInvalid:!1,checkingEmail:!1,invalidMessage:!1,validMessage:!0})})).fail((function(t){400!==t.status?(m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")}),e.setState({timeout:!1,usernameValid:!1,usernameInvalid:!0,checkingEmail:!1,invalidMessage:!0,validMessage:!1})):e.setState({timeout:!1,usernameValid:!1,usernameInvalid:!0,checkingEmail:!1,invalidMessage:!1,validMessage:!1})})):this.setState({timeout:!1,usernameValid:!1,usernameInvalid:!1,checkingEmail:!1,invalidMessage:!1,validMessage:!1})}},{key:"changeUsername",value:function(e){var t=this;e.preventDefault(),this.setState({username:e.target.value,usernameValid:!1},(function(){t.state.timeout&&clearTimeout(t.state.timeout),t.setState({checkingUsername:!0,timeout:setTimeout((function(){t.checkUsername()}),1e3)})}))}},{key:"changeEmailVerification",value:function(e){var t=this.state.usernameValid;this.state.registerConfig["email-is-username"]&&(t=!0),this.setState({email:e.target.value,invalidEmailMessage:!e.target.value,usernameValid:t})}},{key:"changeEmailAsUsername",value:function(e){var t=this;this.setState({email:e.target.value,invalidEmailMessage:!e.target.value,usernameValid:!0},(function(){t.state.timeout&&clearTimeout(t.state.timeout),t.setState({checkingEmail:!0,timeout:setTimeout((function(){t.checkEmailAsUsername()}),1e3)})}))}},{key:"changeCode",value:function(e){this.setState({code:e.target.value,invalidCode:!e.target.value})}},{key:"changeName",value:function(e){e.preventDefault();var t=this.state.registerProfile;t.name=e.target.value,this.setState({registerProfile:t})}},{key:"changePassword",value:function(e){var t=this;this.setState({password:e.target.value},(function(){t.checkPassword()}))}},{key:"changeConfirmPassword",value:function(e){var t=this;this.setState({passwordConfirm:e.target.value},(function(){t.checkPassword()}))}},{key:"checkPassword",value:function(){var e=!1;""===this.state.password&&""===this.state.passwordConfirm||(this.state.password!==this.state.passwordConfirm?e=o.a.t("profile.register-password-error-not-match"):this.state.password.length<(this.state.config.PasswordMinLength||8)&&(e=o.a.t("profile.register-password-ph",{car:this.state.config.PasswordMinLength||8}))),this.setState({invalidPassword:e})}},{key:"registerUsername",value:function(){u.a.glewlwydRequest("/"+this.state.config.params.register+"/register","POST",{username:this.state.username}).then((function(){m.a.sendMessage("App",{type:"registration"})})).fail((function(e){400!==e.status&&m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"noSubmit",value:function(e){return e.preventDefault(),!1}},{key:"saveName",value:function(e){e.preventDefault(),u.a.glewlwydRequest("/"+this.state.config.params.register+"/profile","PUT",this.state.registerProfile).then((function(){m.a.sendMessage("App",{type:"registration"}),m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.register-profile-saved")})})).fail((function(e){400!==e.status&&m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"savePassword",value:function(e){var t=this;e.preventDefault(),!this.state.invalidPassword&&this.state.password.length>=(this.state.config.PasswordMinLength||8)?u.a.glewlwydRequest("/"+this.state.config.params.register+"/profile/password","POST",{password:this.state.password}).then((function(){m.a.sendMessage("App",{type:"registration"}),m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.register-password-saved")})})).fail((function(e){400!==e.status&&m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){t.setState({password:"",passwordConfirm:"",modifyPassword:!1})})):m.a.sendMessage("App",{type:"registration"})}},{key:"sendVerificationEmail",value:function(){var e=this,t=!!this.state.config.params.callback_url&&encodeURIComponent(this.state.config.params.callback_url);u.a.glewlwydRequest("/"+this.state.config.params.register+"/verify","PUT",{username:this.state.username,email:this.state.email,lang:this.state.registerDefaultLang,callback_url:t}).then((function(){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.register-profile-email-sent",{email:e.state.email})}),e.setState({verificationSent:!0})})).fail((function(e){400!==e.status&&m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"verifyCode",value:function(){var e=this;u.a.glewlwydRequest("/"+this.state.config.params.register+"/verify","POST",{username:this.state.username,email:this.state.email,code:this.state.code}).then((function(){m.a.sendMessage("App",{type:"registration"}),m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.register-profile-created")})})).fail((function(t){e.setState({invalidCode:!0},(function(){400!==t.status&&m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}))}},{key:"completeRegistration",value:function(){var e=this;u.a.glewlwydRequest("/"+this.state.config.params.register+"/profile/complete","POST").then((function(){e.setState({registerComplete:!0,username:""},(function(){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.register-profile-completed")}),m.a.sendMessage("App",{type:"registrationComplete"})}))})).fail((function(e){400!==e.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")}):m.a.sendMessage("Notification",{type:"warning",message:o.a.t("profile.register-profile-incomplete")})}))}},{key:"cancelRegistration",value:function(){m.a.sendMessage("App",{type:"confirm",title:o.a.t("profile.register-profile-cancel-title"),message:o.a.t("profile.register-profile-cancel-message"),callback:this.confirmCancelRegistration})}},{key:"confirmCancelRegistration",value:function(e){var t=this;e&&u.a.glewlwydRequest("/"+this.state.config.params.register+"/profile","DELETE").then((function(){t.setState({username:"",usernameValid:!1,email:"",verificationSent:!1,code:"",validMessage:!1,invalidMessage:!1},(function(){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.register-profile-cancelled")}),m.a.sendMessage("App",{type:"registration"})}))})).fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})),m.a.sendMessage("App",{type:"closeConfirm"})}},{key:"updatePassword",value:function(){this.setState({modifyPassword:!0})}},{key:"changeLang",value:function(e,t){this.setState({registerDefaultLang:t})}},{key:"render",value:function(){var e,t,a,n,r,i,l,c,u,m,f,d,p=this;return this.state.registerComplete?(n=[],this.state.config["register-complete"]&&this.state.config["register-complete"].length&&this.state.config["register-complete"].forEach((function(e,t){n.push(s.a.createElement("a",{key:t,className:"btn btn-primary btn-icon-right",href:e["complete-link"]},o.a.t(e["complete-link-label"])))})),this.state.config.params.callback_url?n.push(s.a.createElement("a",{key:n.length,className:"btn btn-primary btn-icon-right",href:decodeURI(this.state.config.params.callback_url)},o.a.t("callback.button-login"))):this.state.registerProfile.callback_url&&n.push(s.a.createElement("a",{key:n.length,className:"btn btn-primary btn-icon-right",href:decodeURI(this.state.registerProfile.callback_url)},o.a.t("callback.button-login"))),n.length||n.push(s.a.createElement("a",{key:n.length,className:"btn btn-primary",href:this.state.config.ProfileUrl},o.a.t("profile.register-profile-complete-link"))),e=s.a.createElement("div",null,s.a.createElement("div",{className:"alert alert-info",role:"alert"},o.a.t("profile.register-profile-complete-message")),s.a.createElement("div",null,n))):this.state.registerProfile?(r=[],"always"!==this.state.registerConfig["set-password"]||this.state.registerProfile.password_set||r.push(s.a.createElement("li",{key:0},o.a.t("profile.register-profile-complete-step-password"))),this.state.registerConfig.schemes&&this.state.registerConfig.schemes.forEach((function(e,t){"always"!=e.register||p.state.registerSchemes[e.name]||r.push(s.a.createElement("li",{key:t+1},o.a.t("profile.register-profile-complete-step-scheme",{scheme:e.display_name||e.name})))})),i=r.length?s.a.createElement("div",{className:"alert alert-danger",role:"alert"},o.a.t("profile.register-profile-complete-steps"),s.a.createElement("ul",null,r),s.a.createElement("button",{className:"btn btn-primary btn-icon",type:"button",disabled:!0,title:o.a.t("profile.register-profile-complete")},o.a.t("profile.register-profile-complete")),s.a.createElement("button",{className:"btn btn-primary",type:"button",onClick:function(){return p.cancelRegistration()},title:o.a.t("profile.register-profile-cancel")},o.a.t("profile.register-profile-cancel"))):s.a.createElement("div",{className:"alert alert-info",role:"alert"},o.a.t("profile.register-profile-complete-possible"),s.a.createElement("div",null,s.a.createElement("button",{className:"btn btn-primary btn-icon",type:"button",onClick:function(){return p.completeRegistration()},title:o.a.t("profile.register-profile-complete")},o.a.t("profile.register-profile-complete")),s.a.createElement("button",{className:"btn btn-primary",type:"button",onClick:function(){return p.cancelRegistration()},title:o.a.t("profile.register-profile-cancel")},o.a.t("profile.register-profile-cancel")))),"no"!==this.state.registerConfig["set-password"]&&(l="",!this.state.modifyPassword&&this.state.registerProfile.password_set&&(l=s.a.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm btn-icon-right",onClick:this.updatePassword},s.a.createElement("i",{className:"fas fa-edit"}))),t=s.a.createElement("div",null,s.a.createElement("hr",null),s.a.createElement("label",{htmlFor:"password-input"},o.a.t("profile.register-password-label"),l),s.a.createElement("div",{className:"input-group"},s.a.createElement("input",{type:"password",className:"form-control",id:"password-input",placeholder:!this.state.modifyPassword&&this.state.registerProfile.password_set?o.a.t("profile.register-password-set-ph"):o.a.t("profile.register-password-ph",{car:this.state.config.PasswordMinLength||8}),disabled:!this.state.modifyPassword&&this.state.registerProfile.password_set,onChange:function(e){return p.changePassword(e)},value:this.state.password})),s.a.createElement("label",{htmlFor:"confirm-password-input"},o.a.t("profile.register-confirm-password-label")),s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("input",{type:"password",className:"form-control",id:"confirm-password-input",disabled:!this.state.modifyPassword&&this.state.registerProfile.password_set,placeholder:o.a.t(!this.state.modifyPassword&&this.state.registerProfile.password_set?"profile.register-password-set-ph":"profile.register-confirm-password-ph"),onChange:function(e){return p.changeConfirmPassword(e)},value:this.state.passwordConfirm}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("button",{className:"btn btn-secondary btn-icon",type:"button",onClick:function(e){return p.savePassword(e)},disabled:this.state.invalidPassword||!this.state.modifyPassword&&this.state.registerProfile.password_set,title:o.a.t("save")},o.a.t("save")))),this.state.invalidPassword?s.a.createElement("span",{className:"badge badge-danger"},this.state.invalidPassword):"")),this.state.registerConfig["verify-email"]&&(a=s.a.createElement("div",null,s.a.createElement("hr",null),s.a.createElement("label",{htmlFor:"email-input"},o.a.t("profile.register-email-label")),s.a.createElement("div",{className:"input-group"},s.a.createElement("input",{type:"text",className:"form-control",id:"email-input",disabled:!0,value:this.state.registerProfile.email||""})))),d=s.a.createElement("form",{className:"needs-validation",noValidate:!0,onSubmit:function(e){return p.noSubmit(e)}},s.a.createElement("label",{htmlFor:"username-input"},o.a.t("profile.register-profile-username-label")),s.a.createElement("div",{className:"input-group"},s.a.createElement("input",{type:"text",className:"form-control",value:this.state.registerProfile.username,disabled:!0})),a,s.a.createElement("hr",null),s.a.createElement("label",{htmlFor:"name-input"},o.a.t("profile.register-name-label")),s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("input",{type:"text",className:"form-control",id:"name-input",placeholder:o.a.t("profile.register-name-ph"),onChange:function(e){return p.changeName(e)},value:this.state.registerProfile.name||""}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("button",{className:"btn btn-secondary btn-icon",type:"button",onClick:function(e){return p.saveName(e)},title:o.a.t("save")},o.a.t("save")))),t)):this.state.registerProfile||(d=this.state.registerConfig["verify-email"]?(this.state.registerDefaultLang&&1<this.state.registerConfig.languages.length&&(f=[],this.state.registerConfig.languages.forEach((function(e,t){f.push(s.a.createElement("a",{key:t,className:"dropdown-item"+(p.state.registerDefaultLang===e?" active":""),href:"#",onClick:function(t){return p.changeLang(t,e)}},e))})),m=s.a.createElement("div",{className:"btn-group dropup",role:"group"},s.a.createElement("button",{className:"btn btn-success dropdown-toggle",type:"button",id:"register-profile-lang","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",disabled:!this.state.usernameValid||!this.state.email||!this.state.registerValid},this.state.registerDefaultLang),s.a.createElement("div",{className:"dropdown-menu","aria-labelledby":"register-profile-lang"},f))),c=this.state.verificationSent?(u=s.a.createElement("div",null,s.a.createElement("hr",null),s.a.createElement("label",{htmlFor:"code-input"},o.a.t("profile.register-code-label")),s.a.createElement("div",{className:"input-group"},s.a.createElement("input",{type:"text",className:"form-control",id:"code-input",placeholder:o.a.t("profile.register-code-ph"),onChange:function(e){return p.changeCode(e)},value:this.state.code})),this.state.invalidCode?s.a.createElement("span",{className:"badge badge-danger"},o.a.t("profile.register-code-error")):""),s.a.createElement("div",null,s.a.createElement("button",{className:"btn btn-success btn-icon",type:"button",onClick:function(){return p.verifyCode()},title:o.a.t("profile.register-profile-verify-code")},o.a.t("profile.register-profile-verify-code")),s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{className:"btn btn-success",type:"button",onClick:function(){return p.sendVerificationEmail()},title:o.a.t("profile.register-profile-reverify-email")},o.a.t("profile.register-profile-reverify-email")),m))):s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{className:"btn btn-success",type:"button",onClick:function(){return p.sendVerificationEmail()},disabled:!this.state.usernameValid||!this.state.email||!this.state.registerValid,title:o.a.t("profile.register-profile-verify-email")},o.a.t("profile.register-profile-verify-email")),m),this.state.registerConfig["email-is-username"]?s.a.createElement("form",{className:"needs-validation",noValidate:!0},s.a.createElement("label",{htmlFor:"email-input"},o.a.t("profile.register-email-label")),s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("input",{type:"text",className:"form-control",id:"email-input",placeholder:o.a.t("profile.register-email-ph"),onChange:function(e){return p.changeEmailAsUsername(e)},disabled:this.state.verificationSent||!this.state.registerValid,value:this.state.email}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("span",{className:"input-group-text"},s.a.createElement("i",{className:this.state.checkingEmail?"fas fa-compass fa-spin":this.state.usernameValid?"fas fa-check":"fas fa-exclamation"})))),this.state.email?"":s.a.createElement("span",{className:"badge badge-danger"},o.a.t("profile.register-email-error")),!this.state.usernameValid&&this.state.email?s.a.createElement("span",{className:"badge badge-danger"},o.a.t("profile.register-username-error")):"",this.state.validMessage?s.a.createElement("span",{className:"badge badge-success"},o.a.t("profile.register-username-valid")):"",this.state.checkingEmail?s.a.createElement("span",{className:"badge badge-info"},o.a.t("profile.register-username-checking")):"",u,s.a.createElement("hr",null),s.a.createElement("div",{className:"input-group-append"},c)):s.a.createElement("form",{className:"needs-validation",noValidate:!0},s.a.createElement("label",{htmlFor:"username-input"},o.a.t("profile.register-username-label")),s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("input",{type:"text",className:"form-control",id:"username-input",placeholder:o.a.t("profile.register-username-ph"),onChange:function(e){return p.changeUsername(e)},disabled:!this.state.registerValid,value:this.state.username}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("span",{className:"input-group-text"},s.a.createElement("i",{className:this.state.checkingUsername?"fas fa-compass fa-spin":this.state.invalidMessage?"fas fa-exclamation":"fas fa-check"})))),this.state.invalidMessage?s.a.createElement("span",{className:"badge badge-danger"},o.a.t("profile.register-username-error")):"",this.state.validMessage?s.a.createElement("span",{className:"badge badge-success"},o.a.t("profile.register-username-valid")):"",this.state.validMessage||this.state.invalidMessage?"":s.a.createElement("span",{className:"badge badge-info"},o.a.t("profile.register-username-empty")),s.a.createElement("hr",null),s.a.createElement("label",{htmlFor:"email-input"},o.a.t("profile.register-email-label")),s.a.createElement("div",{className:"input-group"},s.a.createElement("input",{type:"text",className:"form-control",id:"email-input",placeholder:o.a.t("profile.register-email-ph"),onChange:function(e){return p.changeEmailVerification(e)},disabled:this.state.verificationSent||!this.state.registerValid,value:this.state.email})),this.state.invalidEmailMessage?s.a.createElement("span",{className:"badge badge-danger"},o.a.t("profile.register-email-error")):"",u,s.a.createElement("hr",null),s.a.createElement("div",{className:"input-group-append"},c))):s.a.createElement("form",{className:"needs-validation",noValidate:!0},s.a.createElement("label",{htmlFor:"username-input"},o.a.t("profile.register-username-label")),s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("input",{type:"text",className:"form-control",id:"username-input",placeholder:o.a.t("profile.register-username-ph"),onChange:function(e){return p.changeUsername(e)},disabled:!this.state.registerValid,value:this.state.username}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("span",{className:"input-group-text"},s.a.createElement("i",{className:this.state.checkingUsername?"fas fa-compass fa-spin":this.state.invalidMessage?"fas fa-exclamation":"fas fa-check"})))),this.state.invalidMessage?s.a.createElement("span",{className:"badge badge-danger"},o.a.t("profile.register-username-error")):"",this.state.validMessage?s.a.createElement("span",{className:"badge badge-success"},o.a.t("profile.register-username-valid")):"",this.state.validMessage||this.state.invalidMessage?"":s.a.createElement("span",{className:"badge badge-info"},o.a.t("profile.register-username-empty")),s.a.createElement("hr",null),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("button",{className:"btn btn-success",type:"button",onClick:function(){return p.registerUsername()},disabled:!this.state.usernameValid||!this.state.registerValid,title:o.a.t("profile.register-username-create")},o.a.t("profile.register-profile-create"))))),s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.register-title")))),e,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-6"},d)),s.a.createElement("hr",null),i)}}])&&q(e.prototype,t),r}();function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function W(e,t){return(W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Q=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}(r,n.Component);var e,t,a=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n,s,r=J(e);return n=this,!(s=t?(a=J(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments))||"object"!==G(s)&&"function"!=typeof s?z(n):s}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=a.call(this,e)).state={config:e.config,sessionList:e.sessionList,plugins:e.plugins,disableObject:!1},t.getTable=t.getTable.bind(z(t)),t.disableSession=t.disableSession.bind(z(t)),t.disableSessionConfirm=t.disableSessionConfirm.bind(z(t)),t.disableToken=t.disableToken.bind(z(t)),t.disableTokenConfirm=t.disableTokenConfirm.bind(z(t)),t}return e=r,(t=[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,plugins:e.plugins,sessionList:e.sessionList})}},{key:"getTable",value:function(e,t){return s.a.createElement("table",{className:"table table-responsive table-striped"},s.a.createElement("thead",null,e),s.a.createElement("tbody",null,t))}},{key:"disableSession",value:function(e){var t=this;this.setState({disableObject:e},(function(){m.a.sendMessage("App",{type:"confirm",title:o.a.t("profile.session-disable-title"),message:o.a.t("profile.session-disable-message"),callback:t.disableSessionConfirm})}))}},{key:"disableSessionConfirm",value:function(e){var t=this;e&&this.state.disableObject&&u.a.glewlwydRequest("/profile/session/"+this.state.disableObject.session_hash,"DELETE").then((function(e){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.session-disabled")})})).fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){m.a.sendMessage("App",{type:"refreshSession"}),t.setState({disableObject:!1})})),m.a.sendMessage("App",{type:"closeConfirm"})}},{key:"disableToken",value:function(e,t,a){var n=this;this.setState({disableObject:{type:e,key:t,token:a}},(function(){m.a.sendMessage("App",{type:"confirm",title:o.a.t("profile.session-disable-token-title"),message:o.a.t("profile.session-disable-token-message"),callback:n.disableTokenConfirm})}))}},{key:"disableTokenConfirm",value:function(e){var t=this;e&&this.state.disableObject&&("oauth2"===this.state.disableObject.type?u.a.glewlwydRequestSub("/"+this.state.disableObject.key+"/profile/token/"+this.state.disableObject.token.token_hash+(this.state.config.params.delegate?"?impersonate="+this.state.config.params.delegate:""),"DELETE").then((function(e){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.token-disabled")})})).fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){m.a.sendMessage("App",{type:"refreshSession"}),t.setState({disableObject:!1}),m.a.sendMessage("App",{type:"closeConfirm"})})):"oidc"===this.state.disableObject.type&&u.a.glewlwydRequestSub("/"+this.state.disableObject.key+"/token/"+this.state.disableObject.token.token_hash+(this.state.config.params.delegate?"?impersonate="+this.state.config.params.delegate:""),"DELETE").then((function(e){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.token-disabled")})})).fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){m.a.sendMessage("App",{type:"refreshSession"}),t.setState({disableObject:!1})}))),m.a.sendMessage("App",{type:"closeConfirm"})}},{key:"render",value:function(){var e=this,t=s.a.createElement("tr",null,s.a.createElement("th",null,o.a.t("profile.session-table-last-login")),s.a.createElement("th",null,o.a.t("profile.session-table-expiration")),s.a.createElement("th",null,o.a.t("profile.session-table-issued-for")),s.a.createElement("th",null,o.a.t("profile.session-table-user-agent")),s.a.createElement("th",null,o.a.t("admin.enabled")),s.a.createElement("th",null)),a=[],n=[];this.state.sessionList.forEach((function(t,n){var r=new Date(1e3*t.last_login),i=new Date(1e3*t.expiration);a.push(s.a.createElement("tr",{key:n},s.a.createElement("td",null,r.toLocaleString()),s.a.createElement("td",null,i.toLocaleString()),s.a.createElement("td",null,t.issued_for),s.a.createElement("td",null,t.user_agent),s.a.createElement("td",null,t.enabled?o.a.t("profile.session-enabled-true"):o.a.t("profile.session-enabled-false")),s.a.createElement("td",null,s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(){return e.disableSession(t)},title:o.a.t("admin.delete"),disabled:!t.enabled},s.a.createElement("i",{className:"fas fa-trash"})))))}));var r=0;n=[];for(var i in this.state.plugins.oauth2){var l=this.state.plugins.oauth2[i],c=s.a.createElement("tr",null,s.a.createElement("th",null,o.a.t("profile.session-table-last-login")),s.a.createElement("th",null,o.a.t("profile.session-table-expiration")),s.a.createElement("th",null,o.a.t("profile.session-table-client")),s.a.createElement("th",null,o.a.t("profile.session-table-issued-for")),s.a.createElement("th",null,o.a.t("profile.session-table-user-agent")),s.a.createElement("th",null,o.a.t("admin.enabled")),s.a.createElement("th",null)),u=[];l.forEach((function(t,a){var n=new Date(1e3*t.last_seen),r=new Date(1e3*t.expires_at);u.push(s.a.createElement("tr",{key:a},s.a.createElement("td",null,n.toLocaleString()),s.a.createElement("td",null,r.toLocaleString()),s.a.createElement("td",null,t.client_id),s.a.createElement("td",null,t.issued_for),s.a.createElement("td",null,t.user_agent),s.a.createElement("td",null,t.enabled?o.a.t("profile.session-enabled-true"):o.a.t("profile.session-enabled-false")),s.a.createElement("td",null,s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(){return e.disableToken("oauth2",i,t)},title:o.a.t("admin.delete"),disabled:!t.enabled},s.a.createElement("i",{className:"fas fa-trash"})))))})),n.push(s.a.createElement("div",{className:"card",key:++r},s.a.createElement("div",{className:"card-header",id:"dataFormatCard"},s.a.createElement("h2",{className:"mb-0"},s.a.createElement("button",{className:"btn btn-link",type:"button","data-toggle":"collapse","data-target":"#collapseOauth2-"+i,"aria-expanded":"true","aria-controls":"collapseOauth2-"+i},o.a.t("profile.session-token-oauth2-table",{name:i})))),s.a.createElement("div",{id:"collapseOauth2-"+i,className:"collapse","aria-labelledby":"dataFormatCard","data-parent":"#accordionParams"},s.a.createElement("div",{className:"card-body"},this.getTable(c,u)))))}for(var i in r=n.length,this.state.plugins.oidc){var m=this.state.plugins.oidc[i],f=s.a.createElement("tr",null,s.a.createElement("th",null,o.a.t("profile.session-table-last-login")),s.a.createElement("th",null,o.a.t("profile.session-table-expiration")),s.a.createElement("th",null,o.a.t("profile.session-table-client")),s.a.createElement("th",null,o.a.t("profile.session-table-issued-for")),s.a.createElement("th",null,o.a.t("profile.session-table-user-agent")),s.a.createElement("th",null,o.a.t("admin.enabled")),s.a.createElement("th",null));u=[];m.forEach((function(t,a){var n=new Date(1e3*t.last_seen),r=new Date(1e3*t.expires_at);u.push(s.a.createElement("tr",{key:a},s.a.createElement("td",null,n.toLocaleString()),s.a.createElement("td",null,r.toLocaleString()),s.a.createElement("td",null,t.client_id),s.a.createElement("td",null,t.issued_for),s.a.createElement("td",null,t.user_agent),s.a.createElement("td",null,t.enabled?o.a.t("profile.session-enabled-true"):o.a.t("profile.session-enabled-false")),s.a.createElement("td",null,s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(){return e.disableToken("oidc",i,t)},title:o.a.t("admin.delete"),disabled:!t.enabled},s.a.createElement("i",{className:"fas fa-trash"})))))})),n.push(s.a.createElement("div",{className:"card",key:++r},s.a.createElement("div",{className:"card-header",id:"dataFormatCard"},s.a.createElement("h2",{className:"mb-0"},s.a.createElement("button",{className:"btn btn-link",type:"button","data-toggle":"collapse","data-target":"#collapseOauth2-"+i,"aria-expanded":"true","aria-controls":"collapseOauth2-"+i},o.a.t("profile.session-token-oidc-table",{name:i})))),s.a.createElement("div",{id:"collapseOauth2-"+i,className:"collapse","aria-labelledby":"dataFormatCard","data-parent":"#accordionParams"},s.a.createElement("div",{className:"card-body"},this.getTable(f,u)))))}return s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.session-title")))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"accordion",id:"accordionParams"},s.a.createElement("div",{className:"card"},s.a.createElement("div",{className:"card-header",id:"dataFormatCard"},s.a.createElement("h2",{className:"mb-0"},s.a.createElement("button",{className:"btn btn-link",type:"button","data-toggle":"collapse","data-target":"#collapseSession","aria-expanded":"true","aria-controls":"collapseSession"},o.a.t("profile.session-table")))),s.a.createElement("div",{id:"collapseSession",className:"collapse","aria-labelledby":"dataFormatCard","data-parent":"#accordionParams"},s.a.createElement("div",{className:"card-body"},this.getTable(t,a)))),n))))}}])&&B(e.prototype,t),r}();function K(e){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Y(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function X(e,t){return(X=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ee(e){return(ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var te=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&X(e,t)}(r,n.Component);var e,t,a=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n,s,r=ee(e);return n=this,!(s=t?(a=ee(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments))||"object"!==K(s)&&"function"!=typeof s?Z(n):s}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=a.call(this,e)).state={config:e.config,passwordMinLength:e.config.PasswordMinLength||8,callback:e.callback,loggedIn:e.loggedIn,registerPlugin:e.registerPlugin,old_password:"",password:"",password_confirm:"",oldPasswordInvalid:!1,passwordInvalid:!1,passwordConfirmInvalid:!1},t.passwordButtonHandler=t.passwordButtonHandler.bind(Z(t)),t.changeOldPassword=t.changeOldPassword.bind(Z(t)),t.changeNewPassword=t.changeNewPassword.bind(Z(t)),t.changeNewPasswordConfirm=t.changeNewPasswordConfirm.bind(Z(t)),t.checkPassword=t.checkPassword.bind(Z(t)),t.resetCredentialsCodeReset=t.resetCredentialsCodeReset.bind(Z(t)),t}return e=r,(t=[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({config:e.config,passwordMinLength:e.config.PasswordMinLength||8,callback:e.callback,loggedIn:e.loggedIn,registerPlugin:e.registerPlugin},(function(){t.state.loggedIn||t.setState({password:"",old_password:"",password_confirm:"",passwordMinLength:0})}))}},{key:"passwordButtonHandler",value:function(e,t){var a=this;t?this.checkPassword()&&u.a.glewlwydRequest("/profile/password","PUT",{old_password:this.state.old_password,password:this.state.password}).then((function(){a.setState({old_password:"",password:"",password_confirm:"",oldPasswordInvalid:!1,oldPasswordInvalidMessage:"",passwordInvalid:!1,passwordInvalidMessage:"",passwordConfirmInvalid:!1,passwordConfirmInvalidMessage:""},(function(){a.state.callback(t)}))})).fail((function(e){400==e.status?a.setState({oldPasswordInvalid:!0,oldPasswordInvalidMessage:o.a.t("profile.password-invalid")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})):this.state.callback(t)}},{key:"changeOldPassword",value:function(e){this.setState({old_password:e.target.value})}},{key:"changeNewPassword",value:function(e){this.setState({password:e.target.value})}},{key:"changeNewPasswordConfirm",value:function(e){this.setState({password_confirm:e.target.value})}},{key:"checkPassword",value:function(){var e=!1,t=!1,a="",n="";return this.state.password.length<this.state.passwordMinLength&&(e=!0,a=o.a.t("profile.password-min-characters",{minLength:this.state.passwordMinLength})),this.state.password!==this.state.password_confirm&&(t=!0,n=o.a.t("profile.password-not-match")),this.setState({passwordInvalid:e,passwordConfirmInvalid:t,passwordInvalidMessage:a,passwordConfirmInvalidMessage:n}),!e&&!t}},{key:"resetCredentialsCodeReset",value:function(e){u.a.glewlwydRequest("/"+e+"/reset-credentials-code","PUT").then((function(e){m.a.sendMessage("App",{type:"message",title:o.a.t("profile.reset-credentials-code-reset-title"),label:o.a.t("profile.reset-credentials-code-reset-label-modal"),message:e})})).fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"render",value:function(){var e=this,t=[];return this.state.registerPlugin.forEach((function(a,n){a["reset-credentials"].code&&t.push(s.a.createElement("div",{className:"card",key:n},s.a.createElement("div",{className:"card-header",id:"headingResetCredCode"+a.name},s.a.createElement("h2",{className:"mb-0"},s.a.createElement("button",{className:"btn btn-link btn-block text-left collapsed",type:"button","data-toggle":"collapse","data-target":"#collapseResetCredCode"+a.name,"aria-expanded":"false","aria-controls":"collapseResetCredCode"+a.name},o.a.t("profile.reset-credentials-code-reset-title")))),s.a.createElement("div",{id:"collapseResetCredCode"+a.name,className:"collapse","aria-labelledby":"headingResetCredCode"+a.name,"data-parent":"#accordionResetCredCode"},s.a.createElement("div",{className:"card-body"},s.a.createElement("p",null,o.a.t("profile.reset-credentials-code-reset-label")),s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(){return e.resetCredentialsCodeReset(a.name)}},o.a.t("profile.reset-credentials-code-reset-button"))))))})),s.a.createElement("div",null,s.a.createElement("div",{className:"row",id:"password"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.password-title")))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("form",{className:"needs-validation",noValidate:!0},s.a.createElement("div",{className:"form-group"},s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("div",{className:"input-group-prepend"},s.a.createElement("label",{className:"input-group-text",htmlFor:"mod-old-password"},o.a.t("profile.password-old-password"))),s.a.createElement("input",{type:"password",autoComplete:"current-password",className:"form-control"+(this.state.oldPasswordInvalid?" is-invalid":""),id:"oldPassword",placeholder:o.a.t("profile.password-old-password-ph"),value:this.state.old_password,onChange:function(t){return e.changeOldPassword(t)}})),s.a.createElement("span",{className:"error-input"+(this.state.oldPasswordInvalid?"":" hidden")},this.state.oldPasswordInvalidMessage)),s.a.createElement("div",{className:"form-group"},s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("div",{className:"input-group-prepend"},s.a.createElement("label",{className:"input-group-text",htmlFor:"mod-new-password"},o.a.t("profile.password-new-password"))),s.a.createElement("input",{type:"password",autoComplete:"new-password",className:"form-control"+(this.state.passwordInvalid?" is-invalid":""),id:"newPassword",placeholder:o.a.t("profile.password-new-password-ph",{minLength:this.state.passwordMinLength}),value:this.state.password,onChange:function(t){return e.changeNewPassword(t)}})),s.a.createElement("span",{className:"error-input"+(this.state.passwordInvalid?"":" hidden")},this.state.passwordInvalidMessage)),s.a.createElement("div",{className:"form-group"},s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("div",{className:"input-group-prepend"},s.a.createElement("label",{className:"input-group-text",htmlFor:"mod-new-password-confirm"},o.a.t("profile.password-new-password-confirm"))),s.a.createElement("input",{type:"password",autoComplete:"new-password",className:"form-control"+(this.state.passwordConfirmInvalid?" is-invalid":""),id:"retypeNewPassword",placeholder:o.a.t("profile.password-new-password-confirm-ph",{minLength:this.state.passwordMinLength}),value:this.state.password_confirm,onChange:function(t){return e.changeNewPasswordConfirm(t)}})),s.a.createElement("span",{className:"error-input"+(this.state.passwordConfirmInvalid?"":" hidden")},this.state.passwordConfirmInvalidMessage))))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12 text-right"},s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(t){return e.passwordButtonHandler(t,!0)}},o.a.t("profile.save")))),s.a.createElement("hr",null),s.a.createElement("div",{className:"accordion",id:"accordionResetCredCode"},t))}}])&&Y(e.prototype,t),r}();function ae(e){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ne(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function se(e,t){return(se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ie(e){return(ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var oe=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&se(e,t)}(r,n.Component);var e,t,a=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n,s,r=ie(e);return n=this,!(s=t?(a=ie(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments))||"object"!==ae(s)&&"function"!=typeof s?re(n):s}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=a.call(this,e)).state={config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix,registered:!1,registration:!1},t.getRegister=t.getRegister.bind(re(t)),t.register=t.register.bind(re(t)),t.getRegister(),t}return e=r,(t=[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix,registered:!1,registration:!1},(function(){t.getRegister()}))}},{key:"getRegister",value:function(){var e=this;this.state.profile&&u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","PUT",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name},!0).then((function(t){e.setState({registration:o.a.t("profile.scheme-mock-register-status-registered"),registered:!0})})).fail((function(t){400===t.status?e.setState({registration:o.a.t("profile.scheme-mock-register-status-not-registered"),registered:!1}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"register",value:function(){var e=this;u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:!this.state.registered}}).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){m.a.sendMessage("App",{type:"registration"}),e.getRegister()}))}},{key:"render",value:function(){var e,t=this;return this.state.registration&&(e=s.a.createElement("div",null,s.a.createElement("h4",null,o.a.t("profile.scheme-mock-register-status")),s.a.createElement("span",{className:"badge badge-primary"},this.state.registration))),s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.scheme-mock-title",{module:this.state.module,name:this.state.name})))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},e)),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("hr",null))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.register(e)}},this.state.registered?o.a.t("profile.scheme-mock-deregister"):o.a.t("profile.scheme-mock-register"))))))}}])&&ne(e.prototype,t),r}();function le(e){return(le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ce(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ue(e,t){return(ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function me(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fe(e){return(fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var de=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ue(e,t)}(r,n.Component);var e,t,a=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n,s,r=fe(e);return n=this,!(s=t?(a=fe(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments))||"object"!==le(s)&&"function"!=typeof s?me(n):s}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=a.call(this,e)).state={config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix,registered:!1,registration:!1,credentialList:[],credentialAvailable:!1,editIndex:-1,editValue:"",removeIndex:-1,credAssertion:!1,webauthnEnabled:!!window.PublicKeyCredential},t.getCredentials=t.getCredentials.bind(me(t)),t.createCredential=t.createCredential.bind(me(t)),t.testAssertion=t.testAssertion.bind(me(t)),t.editNameCred=t.editNameCred.bind(me(t)),t.changeName=t.changeName.bind(me(t)),t.saveName=t.saveName.bind(me(t)),t.cancelSaveName=t.cancelSaveName.bind(me(t)),t.switchCred=t.switchCred.bind(me(t)),t.removeCred=t.removeCred.bind(me(t)),t.confirmRemoveCred=t.confirmRemoveCred.bind(me(t)),t.getCredentials(),t}return e=r,(t=[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix,registered:!1,registration:!1},(function(){t.getCredentials()}))}},{key:"strToBin",value:function(e){return Uint8Array.from(atob(e),(function(e){return e.charCodeAt(0)}))}},{key:"binToStr",value:function(e){return btoa(new Uint8Array(e).reduce((function(e,t){return e+String.fromCharCode(t)}),""))}},{key:"getCredentials",value:function(){var e=this;this.state.profile&&u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","PUT",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name},!0).then((function(t){var a=!1;t.forEach((function(e){"registered"==e.status&&(a=!0)})),e.setState({credentialList:t,credentialAvailable:a,credAssertion:!1})})).fail((function(t){401===t.status?e.setState({registration:o.a.t("profile.scheme-webauthn-register-status-not-registered"),registered:!1,credentialList:[],credAssertion:!1}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"createCredential",value:function(){var e=this;u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"new-credential"}}).then((function(t){var a=[];e.state.credentialList.forEach((function(t){a.push({id:e.strToBin(t.credential_id),type:"public-key"})}));var n={authenticatorSelection:{requireResidentKey:!1},rp:{name:t.rpId.split("://")[1]},user:{id:Uint8Array.from(atob(t.user.id),(function(e){return e.charCodeAt(0)})),name:t.user.name,displayName:e.state.profile.name||t.user.name},pubKeyCredParams:t["pubKey-cred-params"],challenge:e.strToBin(t.challenge),excludeCredentials:a};t["attestation-required"]&&(n.attestation=t["attestation-required"]),t.timeout&&(n.timeout=t.timeout),navigator.credentials.create({publicKey:n}).then((function(a){var n={};"id"in a&&(n.id=a.id),"type"in a&&(n.type=a.type),"rawId"in a&&(n.rawId=e.binToStr(a.rawId));var s={};s.clientDataJSON=e.binToStr(a.response.clientDataJSON),s.attestationObject=e.binToStr(a.response.attestationObject),a.response.getTransports&&(s.transports=a.response.getTransports()),n.response=s,u.a.glewlwydRequest(e.state.schemePrefix+"/scheme/register/","POST",{username:e.state.profile.username,scheme_type:e.state.module,scheme_name:e.state.name,value:{register:"register-credential",session:t.session,credential:n}}).then((function(){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.scheme-webauthn-register-credential-success")}),e.getCredentials(),e.state.config.params.register&&m.a.sendMessage("App",{type:"registration"})})).fail((function(e,t){400===e.status?(m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.scheme-webauthn-register-credential-error")}),m.a.sendMessage("App",{type:"message",title:o.a.t("profile.scheme-webauthn-register-credential-error"),message:e.responseJSON})):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))})).catch((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.scheme-webauthn-error-registration")}),m.a.sendMessage("App",{type:"message",title:o.a.t("profile.scheme-webauthn-register-credential-error"),message:[e.toString()]})}))})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"testAssertion",value:function(){var e=this;u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"trigger-assertion"}}).then((function(t){var a=[];t.allowCredentials.forEach((function(t){a.push({id:e.strToBin(t.credential_id),type:"public-key"})}));var n={allowCredentials:a,challenge:e.strToBin(t.challenge)};navigator.credentials.get({publicKey:n}).then((function(a){var n={};"id"in a&&(n.id=a.id),"type"in a&&(n.type=a.type),"rawId"in a&&(n.rawId=e.binToStr(a.rawId)),e.setState({credAssertion:n.rawId}),n.response={clientDataJSON:e.binToStr(a.response.clientDataJSON),authenticatorData:e.binToStr(a.response.authenticatorData),signature:e.binToStr(a.response.signature),userHandle:e.binToStr(a.response.userHandle)},a.response.getTransports&&(response.transports=a.response.getTransports()),u.a.glewlwydRequest(e.state.schemePrefix+"/scheme/register/","POST",{username:e.state.profile.username,scheme_type:e.state.module,scheme_name:e.state.name,value:{register:"validate-assertion",session:t.session,credential:n}},!0).then((function(){e.state.config.params.register&&m.a.sendMessage("App",{type:"registration"}),m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.scheme-webauthn-assertion-success")})})).fail((function(e){401===e.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.scheme-webauthn-assertion-error")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))})).catch((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.scheme-webauthn-error-assertion")}),m.a.sendMessage("App",{type:"message",title:o.a.t("profile.scheme-webauthn-register-credential-error"),message:[e.toString()]})}))})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"editNameCred",value:function(e){this.setState({editIndex:e,editValue:this.state.credentialList[e].name,credAssertion:!1})}},{key:"changeName",value:function(e){this.setState({editValue:e.target.value,credAssertion:!1})}},{key:"saveName",value:function(e,t){var a=this;e.preventDefault(),u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"edit-credential",credential_id:this.state.credentialList[t].credential_id,name:this.state.editValue}}).then((function(e){a.setState({editIndex:-1,editValue:""},(function(){a.getCredentials()}))})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"cancelSaveName",value:function(){this.setState({editIndex:-1,editValue:""})}},{key:"switchCred",value:function(e){var t=this;u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"registered"===this.state.credentialList[e].status?"disable-credential":"enable-credential",credential_id:this.state.credentialList[e].credential_id}}).then((function(e){t.state.config.params.register&&m.a.sendMessage("App",{type:"registration"}),t.getCredentials()})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"removeCred",value:function(e){var t=this;this.setState({removeIndex:e},(function(){m.a.sendMessage("App",{type:"confirm",title:o.a.t("profile.scheme-webauthn-confirm-title"),message:o.a.t("profile.scheme-webauthn-confirm-message"),callback:t.confirmRemoveCred})}))}},{key:"confirmRemoveCred",value:function(e){var t=this;e?u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"remove-credential",credential_id:this.state.credentialList[this.state.removeIndex].credential_id}}).then((function(e){t.getCredentials(),m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.scheme-webauthn-removed")}),t.state.config.params.register&&m.a.sendMessage("App",{type:"registration"})})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){m.a.sendMessage("App",{type:"closeConfirm"})})):m.a.sendMessage("App",{type:"closeConfirm"})}},{key:"render",value:function(){var e,t=this,a=[];return this.state.credentialList.forEach((function(e,n){var r,i=new Date(1e3*e.created_at);t.state.editIndex===n?a.push(s.a.createElement("tr",{key:n},s.a.createElement("td",{className:"d-none d-md-block"},i.toLocaleString()),s.a.createElement("td",null,s.a.createElement("form",{className:"needs-validation",noValidate:!0,onSubmit:function(e){return t.saveName(e,n)}},s.a.createElement("input",{type:"text",className:"form-control",value:t.state.editValue,onChange:function(e){return t.changeName(e,n)},placeholder:o.a.t("profile.webauthn-edit-placeholder")}))),s.a.createElement("td",{className:"d-none d-md-block"},o.a.t("admin.yes")),s.a.createElement("td",null,s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.saveName(e,n)},title:o.a.t("modal.ok")},s.a.createElement("i",{className:"fas fa-save"})),s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(){return t.cancelSaveName()},title:o.a.t("modal.close")},s.a.createElement("i",{className:"fas fa-times"})))))):"registered"===e.status?(r="",e.credential_id===t.state.credAssertion&&(r=s.a.createElement("i",{className:"far fa-check-circle btn-icon-right text-success"})),a.push(s.a.createElement("tr",{key:n},s.a.createElement("td",{className:"d-none d-md-block"},i.toLocaleString()),s.a.createElement("td",null,s.a.createElement("span",{className:"badge badge-success"},e.name),r),s.a.createElement("td",{className:"d-none d-md-block"},o.a.t("admin.yes")),s.a.createElement("td",null,s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(){return t.switchCred(n)},title:o.a.t("profile.scheme-webauthn-btn-switch-off")},s.a.createElement("i",{className:"fas fa-toggle-on"})),s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(){return t.editNameCred(n)},title:o.a.t("profile.scheme-webauthn-btn-edit")},s.a.createElement("i",{className:"fas fa-edit"})),s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(){return t.removeCred(n)},title:o.a.t("profile.scheme-webauthn-btn-remove")},s.a.createElement("i",{className:"fas fa-trash"}))))))):a.push(s.a.createElement("tr",{key:n},s.a.createElement("td",{className:"d-none d-md-block"},i.toLocaleString()),s.a.createElement("td",null,s.a.createElement("span",{className:"badge badge-danger"},e.name)),s.a.createElement("td",{className:"d-none d-md-block"},o.a.t("admin.no")),s.a.createElement("td",null,s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(){return t.switchCred(n)},title:o.a.t("profile.scheme-webauthn-btn-switch-on")},s.a.createElement("i",{className:"fas fa-toggle-off"})),s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(){return t.editNameCred(n)},title:o.a.t("profile.scheme-webauthn-btn-edit")},s.a.createElement("i",{className:"fas fa-edit"})),s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(){return t.removeCred(n)},title:o.a.t("profile.scheme-webauthn-btn-remove")},s.a.createElement("i",{className:"fas fa-trash"}))))))})),this.state.webauthnEnabled||(e=s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"alert alert-danger",role:"alert"},o.a.t("profile.scheme-webauthn-disabled"))))),s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.scheme-webauthn-title",{module:this.state.module,name:this.state.name})))),e,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.getCredentials(e)}},o.a.t("login.btn-reload")))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("table",{className:"table table-responsive table-striped"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",{className:"d-none d-md-block"},o.a.t("profile.scheme-webauthn-table-created_at")),s.a.createElement("th",null,o.a.t("profile.scheme-webauthn-table-name")),s.a.createElement("th",{className:"d-none d-md-block"},o.a.t("profile.scheme-webauthn-table-enabled")),s.a.createElement("th",null))),s.a.createElement("tbody",null,a)))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("hr",null))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{type:"button",disabled:!this.state.webauthnEnabled,className:"btn btn-primary",onClick:function(e){return t.createCredential(e)},title:o.a.t("profile.scheme-webauthn-register-title")},o.a.t("profile.scheme-webauthn-register")),s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.testAssertion(e)},disabled:!this.state.credentialAvailable||!this.state.webauthnEnabled,title:o.a.t("profile.scheme-webauthn-test-registration-title")},o.a.t("profile.scheme-webauthn-test-registration"))))))}}])&&ce(e.prototype,t),r}(),pe=a(16),ge=a.n(pe);function he(e){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function be(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ye(e,t){return(ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ve(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ee(e){return(Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var we=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ye(e,t)}(r,n.Component);var e,t,a=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n,s,r=Ee(e);return n=this,!(s=t?(a=Ee(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments))||"object"!==he(s)&&"function"!=typeof s?ve(n):s}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=a.call(this,e)).state={config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix,myOtp:!1,errorList:{},otpUrl:!1,qrcode:"",allowHotp:!1,allowTotp:!1},t.getRegister=t.getRegister.bind(ve(t)),t.register=t.register.bind(ve(t)),t.changeParam=t.changeParam.bind(ve(t)),t.changeType=t.changeType.bind(ve(t)),t.generateSecret=t.generateSecret.bind(ve(t)),t.showQRCode=t.showQRCode.bind(ve(t)),t.getRegister(),t}return e=r,(t=[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix},(function(){t.getRegister()}))}},{key:"getRegister",value:function(){var e=this;this.state.profile&&u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","PUT",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name}).then((function(t){var a="NONE"!==t.type&&t.type?t:{type:"NONE",secret:"",moving_factor:0,time_step_size:t["totp-window"]};e.setState({myOtp:a,allowHotp:t["hotp-allow"],allowTotp:t["totp-allow"]})})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){e.showQRCode()}))}},{key:"showQRCode",value:function(){var e,t=!1;this.state.myOtp.issuer&&this.state.profile.username&&this.state.myOtp.secret&&this.state.myOtp.digits&&("HOTP"===this.state.myOtp.type&&void 0!==this.state.myOtp.moving_factor?t="otpauth://hotp/"+encodeURIComponent(this.state.myOtp.issuer)+":"+encodeURIComponent(this.state.profile.username)+"?issuer="+encodeURIComponent([location.protocol,"//",location.host].join(""))+"&secret="+encodeURIComponent(this.state.myOtp.secret)+"&digits="+this.state.myOtp.digits+"&algorithm=SHA1&counter="+this.state.myOtp.moving_factor:"TOTP"===this.state.myOtp.type&&this.state.myOtp.time_step_size&&(t="otpauth://totp/"+encodeURIComponent(this.state.myOtp.issuer)+":"+encodeURIComponent(this.state.profile.username)+"?issuer="+encodeURIComponent([location.protocol,"//",location.host].join(""))+"&secret="+encodeURIComponent(this.state.myOtp.secret)+"&digits="+this.state.myOtp.digits+"&algorithm=SHA1&period="+this.state.myOtp.time_step_size)),t?((e=ge()(0,"L")).addData(t),e.make(),this.setState({otpUrl:t,qrcode:e.createSvgTag(4)})):this.setState({otpUrl:!1,qrcode:""})}},{key:"changeParam",value:function(e,t,a){var n=this,s=this.state.myOtp;s[t]=a?parseInt(e.target.value):e.target.value,this.setState({myOtp:s},(function(){n.showQRCode()}))}},{key:"changeType",value:function(e,t){var a=this;e.preventDefault();var n=this.state.myOtp;n.type=t,this.setState({myOtp:n},(function(){a.showQRCode()}))}},{key:"generateSecret",value:function(){var e=this;u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{"generate-secret":!0}}).then((function(t){var a=e.state.myOtp;a.secret=t.secret,e.setState({myOtp:a},(function(){e.showQRCode()}))})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"register",value:function(){var e=this,t={},a=!1;"NONE"!==this.state.myOtp.type&&(this.state.myOtp.secret||(t.secret=o.a.t("profile.scheme-otp-secret-error"),a=!0),"HOTP"===this.state.myOtp.type?""!==this.state.myOtp.moving_factor&&void 0!==this.state.myOtp.moving_factor||(t.moving_factor=o.a.t("profile.scheme-otp-moving_factor-error"),a=!0):"TOTP"===this.state.myOtp.type&&(""!==this.state.myOtp.time_step_size&&void 0!==this.state.myOtp.time_step_size||(t.time_step_size=o.a.t("profile.scheme-otp-time_step_size-error"),a=!0),""===this.state.myOtp.start_offset&&(t.start_offset=o.a.t("profile.scheme-otp-start_offset-error"),a=!0))),this.setState({errorList:t},(function(){a||u.a.glewlwydRequest(e.state.schemePrefix+"/scheme/register/","POST",{username:e.state.profile.username,scheme_type:e.state.module,scheme_name:e.state.name,value:e.state.myOtp}).then((function(t){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.scheme-otp-save-ok")}),e.getRegister(),e.state.config.params.register&&m.a.sendMessage("App",{type:"registration"})})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.scheme-otp-save-error")})}))}))}},{key:"render",value:function(){var e,t,a,n,r,i=this,l=s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"input-group input-group-sm mb-3"},s.a.createElement("div",{className:"input-group-prepend"},s.a.createElement("span",{className:"input-group-text"},o.a.t("profile.scheme-otp-secret"))),s.a.createElement("input",{type:"text",maxLength:"128",className:this.state.errorList.secret?"form-control is-invalid":"form-control",id:"scheme-otp-secret",onChange:function(e){return i.changeParam(e,"secret")},value:this.state.myOtp.secret,placeholder:o.a.t("profile.scheme-otp-secret-ph")}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("button",{className:"btn btn-outline-secondary",type:"button",onClick:this.generateSecret},o.a.t("profile.scheme-otp-generate-secret"))),this.state.errorList.secret?s.a.createElement("span",{className:"error-input"},this.state.errorList.secret):"")));return"HOTP"===this.state.myOtp.type?e=s.a.createElement("div",null,l,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"input-group input-group-sm mb-3"},s.a.createElement("div",{className:"input-group-prepend"},s.a.createElement("span",{className:"input-group-text"},o.a.t("profile.scheme-otp-moving_factor"))),s.a.createElement("input",{type:"number",min:"0",step:"1",className:this.state.errorList.moving_factor?"form-control is-invalid":"form-control",id:"scheme-otp-moving_factor",onChange:function(e){return i.changeParam(e,"moving_factor",1)},value:this.state.myOtp.moving_factor,placeholder:o.a.t("profile.scheme-otp-moving_factor-ph")}),this.state.errorList.moving_factor?s.a.createElement("span",{className:"error-input"},this.state.errorList.moving_factor):"")))):"TOTP"===this.state.myOtp.type&&(t=s.a.createElement("div",null,l,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"input-group input-group-sm mb-3"},s.a.createElement("div",{className:"input-group-prepend"},s.a.createElement("span",{className:"input-group-text"},o.a.t("profile.scheme-otp-time_step_size"))),s.a.createElement("input",{type:"number",min:"0",step:"1",className:this.state.errorList.time_step_size?"form-control is-invalid":"form-control",id:"scheme-otp-time_step_size",onChange:function(e){return i.changeParam(e,"time_step_size",1)},value:this.state.myOtp.time_step_size,placeholder:o.a.t("profile.scheme-otp-time_step_size-ph")}),this.state.errorList.time_step_size?s.a.createElement("span",{className:"error-input"},this.state.errorList.time_step_size):""))))),this.state.allowHotp&&(a=s.a.createElement("a",{className:"dropdown-item"+("HOTP"===this.state.myOtp.type?" active":""),href:"#",onClick:function(e){return i.changeType(e,"HOTP")}},o.a.t("profile.scheme-otp-type-HOTP"))),this.state.allowTotp&&(n=s.a.createElement("a",{className:"dropdown-item"+("TOTP"===this.state.myOtp.type?" active":""),href:"#",onClick:function(e){return i.changeType(e,"TOTP")}},o.a.t("profile.scheme-otp-type-TOTP"))),this.state.otpUrl&&(r=s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-4"},s.a.createElement("a",{href:this.state.otpUrl,title:this.state.otpUrl},s.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.state.qrcode}}))),s.a.createElement("div",{className:"col-md-8 v-center"},s.a.createElement("h4",null,o.a.t("profile.scheme-otp-scan-qrcode-message"))))),s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.scheme-otp-title")))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"input-group input-group-sm mb-3"},s.a.createElement("div",{className:"input-group-prepend"},s.a.createElement("span",{className:"input-group-text"},o.a.t("profile.scheme-otp-type"))),s.a.createElement("div",{className:"dropdown"},s.a.createElement("button",{className:"btn btn-secondary dropdown-toggle",type:"button",id:"scheme-otp-type","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},o.a.t("profile.scheme-otp-type-"+this.state.myOtp.type)),s.a.createElement("div",{className:"dropdown-menu","aria-labelledby":"scheme-otp-type"},n,a,s.a.createElement("a",{className:"dropdown-item"+("NONE"===this.state.myOtp.type?" active":""),href:"#",onClick:function(e){return i.changeType(e,"NONE")}},o.a.t("profile.scheme-otp-type-NONE"))))))),e,t,r,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("hr",null))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return i.register(e)}},o.a.t("profile.scheme-otp-save"))))))}}])&&be(e.prototype,t),r}();function Ne(e){return(Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ce(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ke(e,t){return(ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Se(e){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _e=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ke(e,t)}(r,n.Component);var e,t,a=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n,s,r=Se(e);return n=this,!(s=t?(a=Se(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments))||"object"!==Ne(s)&&"function"!=typeof s?Pe(n):s}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=a.call(this,e)).state={config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix,registered:!1,registration:!1,certificateList:[],addModal:!1,certFile:!1,curCert:!1,fileName:!1,activeCert:!1,downloadCert:!1,showPassword:!1,canAddCert:!1,canRequestCert:!1},t.getRegister=t.getRegister.bind(Pe(t)),t.selectCertFile=t.selectCertFile.bind(Pe(t)),t.addCertificateFile=t.addCertificateFile.bind(Pe(t)),t.addCertificateFromRequest=t.addCertificateFromRequest.bind(Pe(t)),t.requestNewCertificate=t.requestNewCertificate.bind(Pe(t)),t.switchCertStatus=t.switchCertStatus.bind(Pe(t)),t.deleteCert=t.deleteCert.bind(Pe(t)),t.confirmDeleteCert=t.confirmDeleteCert.bind(Pe(t)),t.testCertificate=t.testCertificate.bind(Pe(t)),t.showPassword=t.showPassword.bind(Pe(t)),t.copyPassword=t.copyPassword.bind(Pe(t)),t.getRegister(),t}return e=r,(t=[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix,registered:!1,registration:!1,certificateList:[],addModal:!1,certFile:!1,fileName:!1,activeCert:!1,downloadCert:!1,showPassword:!1,canAddCert:!1,canRequestCert:!1})}},{key:"getRegister",value:function(){var e=this;return this.state.profile?u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","PUT",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name}).then((function(t){e.setState({certificateList:t.certificate,canAddCert:t["add-certificate"],certFile:!1,canRequestCert:t["request-certificate"],fileName:!1,activeCert:!1,downloadCert:!1})})).fail((function(t){e.setState({certificateList:[],canAddCert:!1,canRequestCert:!1,certFile:!1,fileName:!1,downloadCert:!1},(function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))})):Promise.reject(new Error("fail"))}},{key:"selectCertFile",value:function(e){var t=this,a=(this.state.profile,e.target.files[0]),n=new FileReader;n.onload=function(e){t.setState({certFile:e.target.result,fileName:a.name})},n.readAsText(a)}},{key:"addCertificateFile",value:function(){var e=this;this.state.certFile&&u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"upload-certificate",x509:this.state.certFile}}).then((function(t){e.getRegister(),e.state.config.params.register&&(m.a.sendMessage("App",{type:"registration"}),m.a.sendMessage("App",{type:"nav",page:"profile"}))})).fail((function(e){400===e.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.scheme-certificate-invalid")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"addCertificateFromRequest",value:function(){var e=this;u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"use-certificate"}}).then((function(t){e.getRegister(),e.state.config.params.register&&m.a.sendMessage("App",{type:"registration"})})).fail((function(e){400===e.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.scheme-certificate-invalid")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"requestNewCertificate",value:function(){var e=this;u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"request-certificate"}}).then((function(t){e.getRegister().then((function(){e.state.config.params.register&&m.a.sendMessage("App",{type:"registration"}),e.setState({downloadCert:t,showPassword:!1})}))})).fail((function(e){400===e.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.scheme-certificate-invalid")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"switchCertStatus",value:function(e){var t=this;u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"toggle-certificate",certificate_id:e.certificate_id,enabled:!e.enabled}}).then((function(a){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.scheme-certificate-"+(e.enabled?"disabled":"enabled"))}),t.getRegister(),t.state.config.params.register&&m.a.sendMessage("App",{type:"registration"})})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"deleteCert",value:function(e,t){var a=this;e.preventDefault(),this.setState({curCert:t,certFile:!1,fileName:!1},(function(){m.a.sendMessage("App",{type:"confirm",title:o.a.t("profile.scheme-certificate-confirm-title"),message:o.a.t("profile.scheme-certificate-confirm-message"),callback:a.confirmDeleteCert})}))}},{key:"confirmDeleteCert",value:function(e){var t=this;e?u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"delete-certificate",certificate_id:this.state.curCert.certificate_id}}).then((function(e){t.getRegister(),t.state.config.params.register&&m.a.sendMessage("App",{type:"registration"})})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){m.a.sendMessage("App",{type:"closeConfirm"})})):m.a.sendMessage("App",{type:"closeConfirm"})}},{key:"testCertificate",value:function(){var e=this;u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"test-certificate"}}).then((function(t){e.setState({activeCert:t}),m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.scheme-certificate-test-valid")})})).fail((function(e){400===e.status||401===e.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.scheme-certificate-invalid")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"showPassword",value:function(){this.setState({showPassword:!this.state.showPassword})}},{key:"copyPassword",value:function(){navigator.clipboard.writeText(this.state.downloadCert.password).then((function(){m.a.sendMessage("Notification",{type:"info",message:o.a.t("profile.scheme-certificate-p12-file-copy-password-success")})}),(function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.scheme-certificate-p12-file-copy-password-error")})}))}},{key:"render",value:function(){var e,t,a=this,n=[];return this.state.certificateList.forEach((function(e,t){var r,i,l=new Date(1e3*e.expiration),c=new Date(1e3*e.last_used);a.state.activeCert&&e.certificate_id===a.state.activeCert.certificate_id&&(i=s.a.createElement("i",{className:"far fa-check-circle btn-icon-right text-success"})),r=!0===e.enabled?s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(){return a.switchCertStatus(e)},title:o.a.t("admin.switch-off")},s.a.createElement("i",{className:"fas fa-toggle-on"})),s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return a.deleteCert(t,e)},title:o.a.t("admin.delete")},s.a.createElement("i",{className:"fas fa-trash"}))):!1===e.enabled?s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(){return a.switchCertStatus(e)},title:o.a.t("admin.switch-on")},s.a.createElement("i",{className:"fas fa-toggle-off"})),s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return a.deleteCert(t,e)},title:o.a.t("admin.delete")},s.a.createElement("i",{className:"fas fa-trash"}))):s.a.createElement("div",{className:"btn-group",role:"group"},s.a.createElement("button",{type:"button",disabled:!0,className:"btn btn-secondary",title:o.a.t("admin.switch-off")},s.a.createElement("i",{className:"fas fa-toggle-on"})),s.a.createElement("button",{type:"button",disabled:!0,className:"btn btn-secondary",title:o.a.t("admin.delete")},s.a.createElement("i",{className:"fas fa-trash"}))),n.push(s.a.createElement("tr",{key:t},s.a.createElement("td",null,s.a.createElement("span",{className:"d-inline-block",tabIndex:"0","data-toggle":"tooltip",title:e.certificate_dn},e.certificate_dn.substring(0,8),"[...]"),i),s.a.createElement("td",{className:"d-none d-lg-table-cell"},s.a.createElement("span",{className:"d-inline-block",tabIndex:"1","data-toggle":"tooltip",title:e.certificate_issuer_dn},e.certificate_issuer_dn.substring(0,8),"[...]")),s.a.createElement("td",{className:"d-none d-lg-table-cell"},l.toLocaleString()),s.a.createElement("td",{className:"d-none d-lg-table-cell"},c.toLocaleString()),s.a.createElement("td",null,r)))})),this.state.downloadCert&&(t="********",this.state.showPassword&&(t=this.state.downloadCert.password),e=s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-3"},s.a.createElement("a",{className:"btn btn-primary",download:"cert.p12",href:"data:application/x-pkcs12;base64,"+this.state.downloadCert.p12,target:"_blank"},o.a.t("profile.scheme-certificate-p12-file-save"))),s.a.createElement("div",{className:"col-md-4"},s.a.createElement("h5",null,o.a.t("profile.scheme-certificate-p12-file-password"),s.a.createElement("code",{className:"btn-icon-right"},t))),s.a.createElement("div",{className:"col-md-2"},s.a.createElement("div",{className:"btn-group",role:"group","aria-label":"current-certificate"},s.a.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:this.showPassword,title:o.a.t("profile.scheme-certificate-p12-file-"+(this.state.showPassword?"hide-password":"show-password"))},s.a.createElement("i",{className:"fas "+(this.state.showPassword?"fa-eye-slash":"fa-eye")})),s.a.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:this.copyPassword,title:o.a.t("profile.scheme-certificate-p12-file-copy-password")},s.a.createElement("i",{className:"fas fa-copy"}))))))),s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.scheme-certificate-title",{module:this.state.module,name:this.state.name})))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-6"},s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("div",{className:"input-group-prepend"},s.a.createElement("button",{className:"btn btn-outline-secondary",type:"button",disabled:!this.state.canAddCert,id:"addCertificateFromFile",title:o.a.t("profile.scheme-certificate-add-from-file"),onClick:this.addCertificateFile},o.a.t("upload"))),s.a.createElement("div",{className:"custom-file"},s.a.createElement("input",{type:"file",disabled:!this.state.canAddCert,className:"custom-file-input",id:"addCertificateFromFileInput","aria-describedby":"addCertificateFromFile",onChange:function(e){return a.selectCertFile(e)}}),s.a.createElement("label",{className:"custom-file-label",htmlFor:"addCertificateFromFile"},this.state.fileName||o.a.t("browse"))))),s.a.createElement("div",{className:"col-md-6"},s.a.createElement("div",{className:"btn-group",role:"group","aria-label":"current-certificate"},s.a.createElement("button",{type:"button",className:"btn btn-outline-secondary",disabled:!this.state.canAddCert,onClick:this.addCertificateFromRequest,title:o.a.t("profile.scheme-certificate-add-from-request")},s.a.createElement("i",{className:"fas fa-file-contract"})),s.a.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:this.testCertificate,title:o.a.t("profile.scheme-certificate-test")},s.a.createElement("i",{className:"fas fa-question-circle"})),s.a.createElement("button",{type:"button",className:"btn btn-outline-secondary",disabled:!this.state.canRequestCert,onClick:this.requestNewCertificate,title:o.a.t("profile.scheme-certificate-request-new")},s.a.createElement("i",{className:"fas fa-external-link-alt"})),s.a.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:this.getRegister,title:o.a.t("profile.scheme-certificate-refresh")},s.a.createElement("i",{className:"fas fa-sync"}))))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("table",{className:"table table-responsive table-striped"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,o.a.t("profile.scheme-certificate-table-certificate_dn")),s.a.createElement("th",{className:"d-none d-lg-table-cell"},o.a.t("profile.scheme-certificate-table-certificate_issuer_dn")),s.a.createElement("th",{className:"d-none d-lg-table-cell"},o.a.t("profile.scheme-certificate-table-expiration")),s.a.createElement("th",{className:"d-none d-lg-table-cell"},o.a.t("profile.scheme-certificate-table-last_used")),s.a.createElement("th",null))),s.a.createElement("tbody",null,n)))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("hr",null))),e)}}])&&Ce(e.prototype,t),r}();function Oe(e){return(Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Re(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function xe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Le(e){return(Le=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var je=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}(r,n.Component);var e,t,a=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n,s,r=Le(e);return n=this,!(s=t?(a=Le(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments))||"object"!==Oe(s)&&"function"!=typeof s?xe(n):s}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=a.call(this,e)).state={config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix,registerList:[],removeProvdier:!1},t.getRegister=t.getRegister.bind(xe(t)),t.confirmRemoveRegistration=t.confirmRemoveRegistration.bind(xe(t)),t.getRegister(),t}return e=r,(t=[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix},(function(){t.getRegister()}))}},{key:"getRegister",value:function(){var e=this;this.state.profile&&u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","PUT",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name},!0).then((function(t){e.setState({registerList:t})})).fail((function(e){400===e.status||m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"addRegistration",value:function(e){this.state.profile&&u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{provider:e,action:"new",register_url:this.state.config.params.register?u.a.getConfig()+"/"+this.state.config.params.register:u.a.getConfig(),complete_url:window.location.href}},!0).then((function(e){document.location=e.redirect_to})).fail((function(e){400===e.status||m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"removeRegistration",value:function(e){var t=this;this.setState({removeProvdier:e},(function(){m.a.sendMessage("App",{type:"confirm",title:o.a.t("profile.scheme-oauth2-confirm-title"),message:o.a.t("profile.scheme-oauth2-confirm-message",{provider:e}),callback:t.confirmRemoveRegistration})}))}},{key:"confirmRemoveRegistration",value:function(){var e=this;this.state.profile?u.a.glewlwydRequest(this.state.schemePrefix+"/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{provider:this.state.removeProvdier,action:"delete"}},!0).then((function(t){e.getRegister()})).fail((function(e){400===e.status||m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})).always((function(){m.a.sendMessage("App",{type:"closeConfirm"})})):m.a.sendMessage("App",{type:"closeConfirm"})}},{key:"render",value:function(){var e=this,t=[];return this.state.registerList.forEach((function(a,n){var r,i,l,c;a.logo_uri?r=s.a.createElement("img",{src:a.logo_uri,alt:a.provider,className:"img-fluid logo-img"}):a.logo_fa&&(r=s.a.createElement("i",{className:a.logo_fa})),c=null!==a.created_at?(i=new Date(1e3*a.created_at).toLocaleString(),l=a.last_session?new Date(1e3*a.last_session).toLocaleString():o.a.t("profile.scheme-oauth2-registration-invalid"),s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(){return e.removeRegistration(a.provider)},title:o.a.t("profile.scheme-oauth2-btn-remove")},s.a.createElement("i",{className:"fas fa-trash"}))):s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(){return e.addRegistration(a.provider)},title:o.a.t("profile.scheme-oauth2-btn-add")},s.a.createElement("i",{className:"fas fa-plus"})),t.push(s.a.createElement("tr",{key:n},s.a.createElement("td",null,r),s.a.createElement("td",null,s.a.createElement("span",{className:"badge badge-success"},a.provider)),s.a.createElement("td",null,i),s.a.createElement("td",null,l),s.a.createElement("td",null,c)))})),s.a.createElement("div",null,s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("h4",null,o.a.t("profile.scheme-oauth2-title")))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("table",{className:"table table-responsive table-striped"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null),s.a.createElement("th",null,o.a.t("profile.scheme-oauth2-table-name")),s.a.createElement("th",null,o.a.t("profile.scheme-oauth2-table-created_at")),s.a.createElement("th",null,o.a.t("profile.scheme-oauth2-table-last_session")),s.a.createElement("th",null))),s.a.createElement("tbody",null,t)))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("hr",null))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"btn-group",role:"group"}))))}}])&&Re(e.prototype,t),r}();function Te(e){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ae(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ie(e,t){return(Ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function De(e){return(De=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var qe=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ie(e,t)}(r,n.Component);var e,t,a=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n,s,r=De(e);return n=this,!(s=t?(a=De(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments))||"object"!==Te(s)&&"function"!=typeof s?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(n):s}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=a.call(this,e)).state={config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix},t}return e=r,(t=[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,module:e.module,name:e.name,profile:e.profile,schemePrefix:e.schemePrefix})}},{key:"render",value:function(){return"mock"===this.state.module?s.a.createElement(oe,{config:this.state.config,module:this.state.module,name:this.state.name,profile:this.state.profile,schemePrefix:this.state.schemePrefix}):"webauthn"===this.state.module?s.a.createElement(de,{config:this.state.config,module:this.state.module,name:this.state.name,profile:this.state.profile,schemePrefix:this.state.schemePrefix}):"otp"===this.state.module?s.a.createElement(we,{config:this.state.config,module:this.state.module,name:this.state.name,profile:this.state.profile,schemePrefix:this.state.schemePrefix}):"certificate"===this.state.module?s.a.createElement(_e,{config:this.state.config,module:this.state.module,name:this.state.name,profile:this.state.profile,schemePrefix:this.state.schemePrefix}):"oauth2"===this.state.module?s.a.createElement(je,{config:this.state.config,module:this.state.module,name:this.state.name,profile:this.state.profile,schemePrefix:this.state.schemePrefix}):s.a.createElement("div",null,s.a.createElement("h4",null,o.a.t("profile.scheme-not-found",{module:this.state.module})))}}])&&Ae(e.prototype,t),r}(),Ue=a(12),Ve=a(13);function Fe(e){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function He(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ge(e,t){return(Ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Be(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function We(e){return(We=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ze=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ge(e,t)}(r,n.Component);var e,t,a=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n,s,r=We(e);return n=this,!(s=t?(a=We(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments))||"object"!==Fe(s)&&"function"!=typeof s?Be(n):s}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=a.call(this,e)).state={title:e.title,message:e.message,value:e.value,placeHolder:e.placeHolder,cb:e.callback},t.closeModal=t.closeModal.bind(Be(t)),t.changeValue=t.changeValue.bind(Be(t)),t}return e=r,(t=[{key:"componentWillReceiveProps",value:function(e){this.setState({title:e.title,message:e.message,value:e.value,placeHolder:e.placeHolder,cb:e.callback})}},{key:"closeModal",value:function(e,t){this.state.cb&&this.state.cb(t,this.state.value)}},{key:"changeValue",value:function(e){this.setState({value:e.target.value})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"modal fade on-top",id:"editModal",tabIndex:"-1",role:"dialog","aria-labelledby":"editModalLabel","aria-hidden":"true"},s.a.createElement("div",{className:"modal-dialog modal-lg",role:"document"},s.a.createElement("div",{className:"modal-content"},s.a.createElement("div",{className:"modal-header"},s.a.createElement("h5",{className:"modal-title",id:"editModalLabel"},this.state.title),s.a.createElement("button",{type:"button",className:"close","aria-label":o.a.t("modal.close"),onClick:function(t){return e.closeModal(t,!1)}},s.a.createElement("span",{"aria-hidden":"true"},"×"))),s.a.createElement("div",{className:"modal-body"},this.state.message,s.a.createElement("form",{className:"needs-validation",noValidate:!0},s.a.createElement("div",{className:"form-group"},s.a.createElement("input",{type:"text",className:"form-control",id:"editModalInput",placeholder:this.state.placeHolder||"",value:this.state.value,onChange:function(t){return e.changeValue(t)}})))),s.a.createElement("div",{className:"modal-footer"},s.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return e.closeModal(t,!1)}},o.a.t("modal.close")),s.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(t){return e.closeModal(t,!0)}},o.a.t("modal.ok"))))))}}])&&He(e.prototype,t),r}();function $e(e){return($e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Je(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Qe(e,t){return(Qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ke(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ye(e){return(Ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Xe(e,t){t=t||window.location.href,e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}var Ze=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qe(e,t)}(r,n.Component);var e,t,a=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n,s,r=Ye(e);return n=this,!(s=t?(a=Ye(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments))||"object"!==$e(s)&&"function"!=typeof s?Ke(n):s}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=a.call(this,e)).state={lang:o.a.language,config:e.config,registerPlugin:[],registerConfig:!1,registerProfile:!1,registerSchemes:{},schemeHighlight:{},registering:!1,registerValid:!0,curNav:"profile",profileList:!1,profileUpdate:!1,schemeList:[],loggedIn:!1,confirmModal:{title:"",message:"",callback:!1},messageModal:{title:"",label:"",message:""},editModal:{title:"",message:"",value:"",placeHolder:"",callback:!1},plugins:{oauth2:{},oidc:{}},sessionList:[],invalidCredentialMessage:!1,invalidDelegateMessage:!1,tokenParsed:!1,registerDefaultLang:!1,updateEmail:[],updateEmailModule:!1,register:!1,schemePrefix:e.config&&e.config.params.register?"/"+e.config.params.register+"/profile":"/profile",resetCredentials:0},t.fetchProfile=t.fetchProfile.bind(Ke(t)),t.updateEmailCallback=t.updateEmailCallback.bind(Ke(t)),t.refreshSession=t.refreshSession.bind(Ke(t)),m.a.subscribe("App",(function(e){var a,n,s,r;"nav"===e.type?"password"===e.page?t.setState({curNav:"password"}):"session"===e.page?t.setState({curNav:"session"}):"profile"===e.page?t.setState({curNav:"profile"}):"resetCredentialsCode"===e.page?t.setState({curNav:"resetCredentialsCode"}):t.setState({curNav:e.module,module:e.page}):"loggedIn"===e.type?t.setState({loggedIn:e.loggedIn},(function(){t.fetchProfile()})):"lang"===e.type?t.setState({lang:o.a.language},(function(){t.state.config.params.register&&t.state.registerConfig.languages.length&&t.state.registerConfig.languages.forEach((function(e){e===t.state.lang&&t.setState({registerDefaultLang:e})}))})):"profile"===e.type?t.fetchProfile():"confirm"===e.type?((a=t.state.confirmModal).title=e.title,a.message=e.message,a.callback=e.callback,t.setState({confirmModal:a},(function(){$("#confirmModal").modal({keyboard:!1,show:!0})}))):"message"===e.type?((n=t.state.messageModal).title=e.title,n.label=e.label,n.message=e.message,t.setState({messageModal:n},(function(){$("#messageModal").modal({keyboard:!1,show:!0})}))):"closeConfirm"===e.type?$("#confirmModal").modal("hide"):"registration"===e.type?t.state.config.params.register&&t.setState({registerProfile:!1,schemeList:[],profileList:!1},(function(){t.fetchRegistration()})):"registrationComplete"===e.type?t.state.config.params.register?t.setState({registerProfile:!1,schemeList:[],profileList:!1,registering:!1}):t.setState({registerProfile:!1,schemeList:[],profileList:!1,registering:!1},(function(){t.fetchRegistration()})):"updateEmailAvailable"===e.type?(s=t.state.updateEmail,e.module&&s.push(e.module),t.setState({updateEmail:s,register:!0})):"updateEmail"===e.type?e.module&&(r={title:o.a.t("profile.update-email-modal-title"),message:o.a.t("profile.update-email-modal-message"),value:"",placeHolder:o.a.t("profile.update-email-modal-ph"),callback:t.updateEmailCallback},t.setState({editModal:r,updateEmailModule:e.module},(function(){$("#editModal").modal({keyboard:!1,show:!0})}))):"refreshSession"===e.type&&t.refreshSession()})),t.state.config&&(t.getRegisterConfig(),t.state.config.params.updateEmail?t.updateEmailVerifyToken(t.state.config.params.updateEmail,t.state.config.params.token).then((function(){m.a.sendMessage("Notification",{type:"success",message:o.a.t("profile.update-email-success")}),t.fetchProfile()})):t.state.config.params.resetCredentials?t.state.config.register&&(t.state.config.params.token?u.a.glewlwydRequest("/"+t.state.config.params.resetCredentials+"/reset-credentials-email/"+encodeURI(t.state.config.params.token),"PUT").then((function(){t.getResetCredentialsConfig()})).fail((function(e){403===e.status?(t.setState({resetCredentials:-1}),m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.reset-credentials-email-token-error")})):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})):t.getResetCredentialsConfig()):t.state.config.params.register||t.fetchProfile()),t}return e=r,(t=[{key:"getRegisterConfig",value:function(){var e=this;this.state.config.register&&this.state.config.register.forEach((function(t,a){u.a.glewlwydRequest("/"+t.name+"/config").then((function(a){var n=e.state.registerPlugin;a.name=t.name,n.push(a),e.setState({registerPlugin:n},(function(){var n;e.state.config.params.register&&e.fetchRegistration(),a["update-email"]&&((n=e.state.updateEmail).push(t.name),e.setState({updateEmail:n}))}))})).fail((function(t){e.setState({registerValid:!1,registering:!1},(function(){404===t.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.register-invalid-url")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}))}))}},{key:"getResetCredentialsConfig",value:function(){var e=this;u.a.glewlwydRequest("/"+this.state.config.params.resetCredentials+"/reset-credentials/profile/").then((function(t){e.setState({profileList:[t.user],loggedIn:!0,schemeList:t.scheme,schemePrefix:"/"+e.state.config.params.resetCredentials+"/reset-credentials/profile",resetCredentials:1})})).fail((function(t){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")}),e.setState({resetCredentials:-1})}))}},{key:"fetchProfile",value:function(){var e=this;this.state.config.params.delegate?u.a.glewlwydRequest("/profile/scheme").then((function(t){e.setState({loggedIn:!0,profileList:[{username:e.state.config.params.delegate}],schemeList:t,invalidCredentialMessage:!1,invalidDelegateMessage:!1},(function(){e.state.config.params.scheme_name&&t.forEach((function(t){t.name===e.state.config.params.scheme_name&&m.a.sendMessage("Nav",{type:t.module,page:t.name})}))}))})).fail((function(t){e.setState({invalidCredentialMessage:!1,invalidDelegateMessage:!0},(function(){401===t.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.requires-profile-scope")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))})):u.a.glewlwydRequest("/profile_list").then((function(t){e.setState({profileList:t},(function(){!t[0]||t[0].scope.indexOf(e.state.config.profile_scope)<0?e.setState({loggedIn:!1,schemeList:[],invalidDelegateMessage:!1,invalidCredentialMessage:!0,profileUpdate:!1},(function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.requires-profile-scope")})})):u.a.glewlwydRequest("/profile/scheme").then((function(t){e.setState({loggedIn:!0,schemeList:t,invalidDelegateMessage:!1,invalidCredentialMessage:!1,profileUpdate:!0},(function(){e.state.config.params.scheme_name&&t.forEach((function(t){t.name===e.state.config.params.scheme_name&&m.a.sendMessage("Nav",{type:t.module,page:t.name})}))})),e.refreshSession()})).fail((function(t){e.setState({loggedIn:!1,schemeList:[],invalidDelegateMessage:!1,invalidCredentialMessage:!0,profileUpdate:!1},(function(){401===t.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.requires-profile-scope")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}))}))})).fail((function(t){e.setState({loggedIn:!1,profileList:!1,schemeList:[],invalidDelegateMessage:!1,invalidCredentialMessage:!0},(function(){401===t.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.requires-profile-scope")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}))}},{key:"refreshSession",value:function(){var e=this;u.a.glewlwydRequest("/profile/session").then((function(t){e.setState({sessionList:t})})).fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})),u.a.glewlwydRequest("/profile/plugin").then((function(t){t.forEach((function(t){"oauth2-glewlwyd"===t.module?u.a.glewlwydRequestSub("/"+t.name+"/profile/token"+(e.state.config.params.delegate?"?impersonate="+e.state.config.params.delegate:"")).then((function(a){var n=e.state.plugins;n.oauth2[t.name]=a,e.setState({plugins:n})})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})})):"oidc"===t.module&&u.a.glewlwydRequestSub("/"+t.name+"/token"+(e.state.config.params.delegate?"?impersonate="+e.state.config.params.delegate:"")).then((function(a){var n=e.state.plugins;n.oidc[t.name]=a,e.setState({plugins:n})})).fail((function(e){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))})),m.a.sendMessage("App",{type:"sessionComplete"})})).fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"fetchRegistration",value:function(){var e=this;this.state.registerPlugin.forEach((function(t){var a,n;t.registration&&(a=!1,e.state.lang&&t.registration.languages.length&&t.registration.languages.forEach((function(t){t===e.state.lang&&(a=e.state.lang)})),!a&&t.registration.languages.length&&(a=t.registration.languages[0]),e.setState({registerValid:!0,registerConfig:t.registration,registerDefaultLang:a},(function(){!e.state.config.params.token||e.state.tokenParsed?u.a.glewlwydRequest("/"+e.state.config.params.register+"/profile").then((function(a){e.setState({registerProfile:a,schemeList:t.registration.schemes,profile:a,profileList:[a],registering:!0},(function(){t.registration.schemes.forEach((function(t){u.a.glewlwydRequest("/"+e.state.config.params.register+"/profile/scheme/register/canuse","PUT",{username:a.username,scheme_type:t.module,scheme_name:t.name}).then((function(){var a=e.state.registerSchemes,n=e.state.schemeHighlight;n[t.name]=!1,a[t.name]=!0,e.setState({registerSchemes:a,schemeHighlight:n})})).fail((function(){var a=e.state.registerSchemes,n=e.state.schemeHighlight;a[t.name]=!1,"always"==t.register&&(n[t.name]=!0),e.setState({registerSchemes:a,schemeHighlight:n})}))}))}))})).fail((function(t){401!=t.status&&m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")}),e.setState({registerProfile:!1,registering:!1})})):u.a.glewlwydRequest("/"+e.state.config.params.register+"/verify","POST",{token:e.state.config.params.token}).then((function(){u.a.glewlwydRequest("/"+e.state.config.params.register+"/profile").then((function(a){e.setState({tokenParsed:!0,registerProfile:a,schemeList:t.schemes,profile:a,profileList:[a],registering:!0},(function(){t.registration.schemes.forEach((function(t){u.a.glewlwydRequest("/"+e.state.config.params.register+"/profile/scheme/register/canuse","PUT",{username:a.username,scheme_type:t.module,scheme_name:t.name}).then((function(){var a=e.state.registerSchemes;a[t.name]=!0,e.setState({registerSchemes:a})})).fail((function(){var a=e.state.registerSchemes;a[t.name]=!1,e.setState({registerSchemes:a})}))}))}))})).fail((function(t){401!=t.status&&m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")}),e.setState({registerProfile:!1,registering:!1})}))})).fail((function(t){401!=t.status?m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")}):m.a.sendMessage("Notification",{type:"danger",message:o.a.t("profile.register-token-invalid")}),e.setState({registerProfile:!1,registering:!1})}))}))),t["update-email"]&&((n=e.state.updateEmail).push(e.state.config.params.register),e.setState({updateEmail:n}))}))}},{key:"updateEmailVerifyToken",value:function(e,t){return u.a.glewlwydRequest("/"+e+"/update-email/"+encodeURIComponent(t),"PUT").fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"showPasswordChangeNotification",value:function(e){e&&m.a.sendMessage("Notification",{type:"success",message:o.a.t("profile.password-change-success")})}},{key:"updateEmailCallback",value:function(e,t){var a=this;$("#editModal").modal("hide"),e&&u.a.glewlwydRequest("/"+this.state.updateEmailModule+"/update-email","POST",{email:t}).then((function(e){var n={title:o.a.t("profile.update-email-modal-title"),message:[o.a.t("profile.update-email-modal-complete-message",{email:t})]};a.setState({messageModal:n},(function(){$("#messageModal").modal({keyboard:!1,show:!0})}))})).fail((function(){m.a.sendMessage("Notification",{type:"danger",message:o.a.t("error-api-connect")})}))}},{key:"render",value:function(){if(this.state.config){var e,t;return this.state.invalidCredentialMessage?e=s.a.createElement("div",{className:"alert alert-danger",role:"alert"},o.a.t("profile.error-credential-message")):this.state.invalidDelegateMessage&&(e=s.a.createElement("div",{className:"alert alert-danger",role:"alert"},o.a.t("admin.error-credential-message"))),t=this.state.config.params.delegate?s.a.createElement(M,{config:this.state.config,profile:!!this.state.profileList&&this.state.profileList[0]}):this.state.config.params.register?s.a.createElement(H,{config:this.state.config,registerConfig:this.state.registerConfig,registerProfile:this.state.registerProfile,registerSchemes:this.state.registerSchemes,registerValid:this.state.registerValid,registerDefaultLang:this.state.registerDefaultLang}):this.state.config.params.resetCredentials?s.a.createElement(I,{config:this.state.config,profile:!!this.state.profileList&&this.state.profileList[0],status:this.state.resetCredentials}):s.a.createElement(P,{config:this.state.config,profile:!!this.state.profileList&&this.state.profileList[0],pattern:!!this.state.config&&this.state.config.pattern.user,profileUpdate:this.state.profileUpdate,loggedIn:this.state.loggedIn,updateEmail:this.state.updateEmail}),s.a.createElement("div",{"aria-live":"polite","aria-atomic":"true",className:"glwd-container"},s.a.createElement("div",{className:"card center glwd-card",id:"userCard",tabIndex:"-1",role:"dialog"},s.a.createElement("div",{className:"card-header"},s.a.createElement(v,{active:this.state.curNav,config:this.state.config,loggedIn:this.state.loggedIn,schemeList:this.state.schemeList,profileList:this.state.profileList,dataHighlight:!this.state.registerProfile.password_set,schemeHighlight:this.state.schemeHighlight,registering:this.state.registering})),e,s.a.createElement("div",{className:"card-body"},s.a.createElement("div",{id:"carouselBody",className:"carousel slide","data-ride":"carousel"},s.a.createElement("div",{className:"carousel-inner"},s.a.createElement("div",{className:"carousel-item"+("profile"===this.state.curNav?" active":"")},t),s.a.createElement("div",{className:"carousel-item"+("session"===this.state.curNav?" active":"")},s.a.createElement(Q,{config:this.state.config,plugins:this.state.plugins,sessionList:this.state.sessionList})),s.a.createElement("div",{className:"carousel-item"+("password"===this.state.curNav?" active":"")},s.a.createElement(te,{config:this.state.config,profile:!!this.state.profileList&&this.state.profileList[0],loggedIn:this.state.loggedIn,callback:this.showPasswordChangeNotification,registerPlugin:this.state.registerPlugin})),s.a.createElement("div",{className:"carousel-item"+("profile"!==this.state.curNav&&"session"!==this.state.curNav&&"password"!==this.state.curNav?" active":"")},s.a.createElement(qe,{config:this.state.config,module:this.state.curNav,name:this.state.module,profile:!!this.state.profileList&&this.state.profileList[0],schemePrefix:this.state.schemePrefix})))))),s.a.createElement(f.a,{loggedIn:this.state.loggedIn||this.state.config.params.register}),s.a.createElement(Ue.a,{title:this.state.confirmModal.title,message:this.state.confirmModal.message,callback:this.state.confirmModal.callback}),s.a.createElement(Ve.a,{title:this.state.messageModal.title,label:this.state.messageModal.label,message:this.state.messageModal.message}),s.a.createElement(ze,{title:this.state.editModal.title,message:this.state.editModal.message,value:this.state.editModal.value,placeHolder:this.state.editModal.placeHolder,callback:this.state.editModal.callback}))}return s.a.createElement("div",{"aria-live":"polite","aria-atomic":"true",className:"glwd-container"},s.a.createElement("div",{className:"card center glwd-card",id:"userCard",tabIndex:"-1",role:"dialog"},s.a.createElement("div",{className:"card-header"},s.a.createElement("h4",null,s.a.createElement("span",{className:"badge badge-danger"},o.a.t("error-api-connect"))))))}}])&&Je(e.prototype,t),r}(),et=a(8);try{o.a.use(l.a).use(c.a).init({fallbackLng:"en",ns:["translations"],defaultNS:"translations",backend:{loadPath:"locales/{{lng}}/{{ns}}.json"}}).then((function(){u.a.request("config.json").then((function(e){e.lang||(e.lang=["en","fr","nl"]),u.a.request(e.GlewlwydUrl+"config/").then((function(t){Xe("delegate")?u.a.setConfig(e.GlewlwydUrl+t.api_prefix+"/delegate/"+Xe("delegate")):u.a.setConfig(e.GlewlwydUrl+t.api_prefix),u.a.setConfigSub(e.GlewlwydUrl+t.api_prefix);var a=Object.assign({params:{scope:Xe("scope"),client_id:Xe("client_id"),callback_url:Xe("callback_url"),delegate:Xe("delegate")||!1,register:Xe("register")||!1,updateEmail:Xe("updateEmail")||!1,token:Xe("token")||!1,scheme_name:Xe("scheme_name")||!1,provider:Xe("provider")||!1,resetCredentials:Xe("resetCredentials")||!1}},e,t);i.a.render(s.a.createElement(Ze,{config:a}),document.getElementById("root"))})).fail((function(e){i.a.render(s.a.createElement(Ze,{config:!1}),document.getElementById("root"))}))})).fail((function(e){i.a.render(s.a.createElement(et.a,null),document.getElementById("root"))}))}))}catch(e){$("#root").html('<div class="alert alert-danger" role="alert"><i class="fas fa-exclamation-triangle"></i><span class="btn-icon-right">You must use a browser compatible with Glewlwyd SSO</span></div>')}},3:function(e,t,a){"use strict";var n=a(2);function s(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.GlewlwydApiPrefix="",this.GlewlwydApiPrefixSub=""}var t,a;return t=e,(a=[{key:"setConfig",value:function(e){this.GlewlwydApiPrefix=e}},{key:"getConfig",value:function(){return this.GlewlwydApiPrefix}},{key:"setConfigSub",value:function(e){this.GlewlwydApiPrefixSub=e}},{key:"getConfigSub",value:function(){return this.GlewlwydApiPrefixSub}},{key:"request",value:function(e,t,a){var n=1<arguments.length&&void 0!==t?t:"GET",s=2<arguments.length&&void 0!==a&&a;return s&&"GET"!==n?$.ajax({method:n,url:e,data:JSON.stringify(s),contentType:"application/json; charset=utf-8"}):$.ajax({method:n,url:e})}},{key:"glewlwydRequest",value:function(e,t,a,s){var r=1<arguments.length&&void 0!==t?t:"GET",i=2<arguments.length&&void 0!==a&&a,o=3<arguments.length&&void 0!==s&&s;return this.request(this.GlewlwydApiPrefix+e,r,i).fail((function(e){o&&401===e.status&&n.a.sendMessage("App",{type:"loggedIn",message:!1})}))}},{key:"glewlwydRequestSub",value:function(e,t,a){var n=1<arguments.length&&void 0!==t?t:"GET",s=2<arguments.length&&void 0!==a&&a;return this.request(this.GlewlwydApiPrefixSub+e,n,s)}}])&&s(t.prototype,a),e}());t.a=r},4:function(e,t,a){"use strict";var n=a(0),s=a.n(n),r=a(2);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var m=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(m,n.Component);var e,t,a=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n,s,r=u(e);return n=this,!(s=t?(a=u(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments))||"object"!==i(s)&&"function"!=typeof s?c(n):s}}(m);function m(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m),(t=a.call(this,e)).state={message:[],counter:0,loggedIn:e.loggedIn},r.a.subscribe("Notification",(function(e){var a;e.type&&((a=t.state.message).push({type:e.type,message:e.message,id:t.state.counter}),t.setState({message:a,counter:t.state.counter+1},(function(){t.timeoutClose(t.state.counter-1)})))})),t.close=t.close.bind(c(t)),t.timeoutClose=t.timeoutClose.bind(c(t)),t}return e=m,(t=[{key:"componentWillReceiveProps",value:function(e){this.setState({loggedIn:e.loggedIn})}},{key:"timeoutClose",value:function(e){var t=this;setTimeout((function(){t.close(e)}),5e3)}},{key:"close",value:function(e){var t=this,a=this.state.message;a.forEach((function(n,s){n.id===e&&(a.splice(s,1),t.setState({message:a}))}))}},{key:"render",value:function(){var e=this,t=[];return this.state.loggedIn&&this.state.message.forEach((function(a,n){var r="success"===a.type?s.a.createElement("strong",{className:"mr-auto"},s.a.createElement("span",{className:"badge badge-success btn-icon"},s.a.createElement("i",{className:"fas fa-check-circle"})),"Glewlwyd"):"danger"===a.type?s.a.createElement("strong",{className:"mr-auto"},s.a.createElement("span",{className:"badge badge-danger btn-icon"},s.a.createElement("i",{className:"fas fa-exclamation-circle"})),"Glewlwyd"):"warning"===a.type?s.a.createElement("strong",{className:"mr-auto"},s.a.createElement("span",{className:"badge badge-warning btn-icon"},s.a.createElement("i",{className:"fas fa-exclamation-circle"})),"Glewlwyd"):s.a.createElement("strong",{className:"mr-auto"},s.a.createElement("span",{className:"badge badge-info btn-icon"},s.a.createElement("i",{className:"fas fa-info-circle"})),"Glewlwyd");t.push(s.a.createElement("div",{className:"toast-container",style:{top:95+90*n,right:5},key:n},s.a.createElement("div",{className:"toast glwd-toast",role:"alert","aria-live":"assertive","aria-atomic":"true"},s.a.createElement("div",{className:"toast-header"},r,s.a.createElement("button",{type:"button",className:"ml-2 mb-1 close","data-dismiss":"toast","aria-label":"Close",onClick:function(){return e.close(a.id)}},s.a.createElement("span",{"aria-hidden":"true"},"×"))),s.a.createElement("div",{className:"toast-body"},a.message))))})),s.a.createElement("div",null,t)}}])&&o(e.prototype,t),m}();t.a=m},8:function(e,t,a){"use strict";var n=a(0),s=a.n(n),r=a(1);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(u,n.Component);var e,t,a=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n,s,r=c(e);return n=this,!(s=t?(a=c(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments))||"object"!==i(s)&&"function"!=typeof s?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(n):s}}(u);function u(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),a.call(this,e)}return e=u,(t=[{key:"render",value:function(){return s.a.createElement("div",{className:"alert alert-danger perfect-centering",role:"alert"},r.a.t("error-config"))}}])&&o(e.prototype,t),u}();t.a=u}})}));